{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"factoryName": {
			"type": "string",
			"metadata": "Data Factory name",
			"defaultValue": "Dev-ADF-WhsStockReplenish"
		}
	},
	"variables": {
		"factoryId": "[concat('Microsoft.DataFactory/factories/', parameters('factoryName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('factoryName'), '/CreatePurchaseOrderLines_copy1')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"folder": {
					"name": "OL/General"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "Inventsum"
						},
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "EcoResProduct"
						},
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "EcoResProductTranslation"
						},
						{
							"linkedService": {
								"referenceName": "powerappdataverse",
								"type": "LinkedServiceReference"
							},
							"name": "UOWarehouse"
						},
						{
							"dataset": {
								"referenceName": "DataImportExecution",
								"type": "DatasetReference"
							},
							"name": "DataImportExecutions"
						},
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "InventItemGroupItem"
						},
						{
							"linkedService": {
								"referenceName": "powerappdataverse",
								"type": "LinkedServiceReference"
							},
							"name": "RecommendedOrderQty"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "powerappdataverse",
								"type": "LinkedServiceReference"
							},
							"name": "DataExecutionsTO"
						},
						{
							"linkedService": {
								"referenceName": "storageaccount",
								"type": "LinkedServiceReference"
							},
							"name": "PurchaseOrdersSink"
						},
						{
							"linkedService": {
								"referenceName": "storageaccount",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						},
						{
							"linkedService": {
								"referenceName": "storageaccount",
								"type": "LinkedServiceReference"
							},
							"name": "sink2"
						},
						{
							"linkedService": {
								"referenceName": "storageaccount",
								"type": "LinkedServiceReference"
							},
							"name": "sink3"
						},
						{
							"linkedService": {
								"referenceName": "storageaccount",
								"type": "LinkedServiceReference"
							},
							"name": "sink4"
						}
					],
					"transformations": [
						{
							"name": "ItemSize"
						},
						{
							"name": "selectInventSum"
						},
						{
							"name": "joinInventSumRecorderQty"
						},
						{
							"name": "filterJoinInventSum"
						},
						{
							"name": "selectEcoResProduct"
						},
						{
							"name": "filterEcoResProductTranslation"
						},
						{
							"name": "selectEcoResProductTranslation"
						},
						{
							"name": "join1"
						},
						{
							"name": "selectProductDescription"
						},
						{
							"name": "StockLessThanMinimum"
						},
						{
							"name": "joinWhs"
						},
						{
							"name": "join2"
						},
						{
							"name": "selectSTKWhs"
						},
						{
							"name": "selectCols"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "selectWarehouse"
						},
						{
							"name": "filterWarehouse"
						},
						{
							"name": "join3"
						},
						{
							"name": "selectSourceWarehouse"
						},
						{
							"name": "selectWarehouseCombined"
						},
						{
							"name": "selectMinOrderQty"
						},
						{
							"name": "filterMinOrderQty"
						},
						{
							"name": "WhsUpperDataArea"
						},
						{
							"name": "MinOrderUpperDataArea"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select2"
						},
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn3"
						},
						{
							"name": "filter2"
						},
						{
							"name": "filteronStoreParameter"
						},
						{
							"name": "filteronWarehouseParameter"
						},
						{
							"name": "join4"
						},
						{
							"name": "derivedColumn4"
						},
						{
							"name": "SelectWarehouseOnParameters"
						},
						{
							"name": "filter3"
						},
						{
							"name": "union1"
						},
						{
							"name": "Warehouses"
						},
						{
							"name": "triggersource"
						},
						{
							"name": "crd3cstoreavailqtyzero"
						},
						{
							"name": "derivedColumn5"
						},
						{
							"name": "selectPOBoolean"
						},
						{
							"name": "select4"
						},
						{
							"name": "join5"
						},
						{
							"name": "filter4"
						},
						{
							"name": "union2"
						},
						{
							"name": "lookup1"
						},
						{
							"name": "derivedColumn6"
						},
						{
							"name": "select5"
						},
						{
							"name": "derivedColumn7"
						},
						{
							"name": "selectInvItemGrpCols"
						},
						{
							"name": "lookupInventItemGrp"
						},
						{
							"name": "select6"
						}
					],
					"scriptLines": [
						"parameters{",
						"     Company as string ('ONUK'),",
						"     Store as string ('SOU-PF-STK'),",
						"     Warehouse as string ('LUX-KN-STK'),",
						"     filename as string (\"cbb0e0c0-3ccc-417a-8c39-8831faf6d3a5\"),",
						"     TriggerSource as string ('Manual'),",
						"     Container as string ('dataverse-ontest-unqccd0037834be4cec846b41a3ea290'),",
						"     OrderType as string ('PURCHASE ORDER')",
						"}",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          closed as long,",
						"          closedqty as long,",
						"          isexcludedfrominventoryvalue as long,",
						"          sysdatastatecode as long,",
						"          arrived as decimal(38,6),",
						"          availordered as decimal(38,6),",
						"          availphysical as decimal(38,6),",
						"          deducted as decimal(38,6),",
						"          inventdimid as string,",
						"          itemid as string,",
						"          lastupddateexpected as timestamp,",
						"          lastupddatephysical as timestamp,",
						"          onorder as decimal(38,6),",
						"          ordered as decimal(38,6),",
						"          pdscwarrived as decimal(38,6),",
						"          pdscwavailordered as decimal(38,6),",
						"          pdscwavailphysical as decimal(38,6),",
						"          pdscwdeducted as decimal(38,6),",
						"          pdscwonorder as decimal(38,6),",
						"          pdscwordered as decimal(38,6),",
						"          pdscwphysicalinvent as decimal(38,6),",
						"          pdscwpicked as decimal(38,6),",
						"          pdscwpostedqty as decimal(38,6),",
						"          pdscwquotationissue as decimal(38,6),",
						"          pdscwquotationreceipt as decimal(38,6),",
						"          pdscwreceived as decimal(38,6),",
						"          pdscwregistered as decimal(38,6),",
						"          pdscwreservordered as decimal(38,6),",
						"          pdscwreservphysical as decimal(38,6),",
						"          physicalinvent as decimal(38,6),",
						"          physicalvalue as decimal(38,6),",
						"          physicalvalueseccur_ru as decimal(38,6),",
						"          picked as decimal(38,6),",
						"          postedqty as decimal(38,6),",
						"          postedvalue as decimal(38,6),",
						"          postedvalueseccur_ru as decimal(38,6),",
						"          quotationissue as decimal(38,6),",
						"          quotationreceipt as decimal(38,6),",
						"          received as decimal(38,6),",
						"          registered as decimal(38,6),",
						"          reservordered as decimal(38,6),",
						"          reservphysical as decimal(38,6),",
						"          configid as string,",
						"          inventbatchid as string,",
						"          inventcolorid as string,",
						"          inventgtdid_ru as string,",
						"          inventlocationid as string,",
						"          inventownerid_ru as string,",
						"          inventprofileid_ru as string,",
						"          inventserialid as string,",
						"          inventsiteid as string,",
						"          inventsizeid as string,",
						"          inventstatusid as string,",
						"          inventstyleid as string,",
						"          inventversionid as string,",
						"          licenseplateid as string,",
						"          wmslocationid as string,",
						"          wmspalletid as string,",
						"          inventdimension1 as string,",
						"          inventdimension2 as string,",
						"          inventdimension3 as string,",
						"          inventdimension4 as string,",
						"          inventdimension5 as string,",
						"          inventdimension6 as string,",
						"          inventdimension7 as string,",
						"          inventdimension8 as string,",
						"          inventdimension9 as timestamp,",
						"          inventdimension10 as decimal(38,6),",
						"          inventdimension11 as string,",
						"          inventdimension12 as string,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/inventsum_partitioned',",
						"     manifestType: 'manifest') ~> Inventsum",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          pdscwproduct as long,",
						"          producttype as long,",
						"          servicetype as long,",
						"          sunplmsyncwithplm as long,",
						"          sysdatastatecode as long,",
						"          displayproductnumber as string,",
						"          instancerelationtype as long,",
						"          searchname as string,",
						"          engchgproductownerid as string,",
						"          engchgproductcategorydetails as long,",
						"          engchgproductreleasepolicy as long,",
						"          engchgproductreadinesspolicy as long,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/ecoresproduct_partitioned',",
						"     manifestType: 'manifest') ~> EcoResProduct",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          sysdatastatecode as long,",
						"          description as string,",
						"          languageid as string,",
						"          name as string,",
						"          product as long,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/ecoresproducttranslation_partitioned',",
						"     manifestType: 'manifest') ~> EcoResProductTranslation",
						"source(output(",
						"          crd3c_automatictocreation as boolean,",
						"          crd3c_automatictocreationname as string,",
						"          crd3c_dataarea as string,",
						"          crd3c_datastatus as integer,",
						"          crd3c_datastatusname as string,",
						"          crd3c_deliveryterms as string,",
						"          crd3c_modeofdelivery as string,",
						"          crd3c_name as string,",
						"          crd3c_refreshday as string,",
						"          crd3c_refreshdayname as string,",
						"          crd3c_refreshfrequency as integer,",
						"          crd3c_refreshtime as timestamp,",
						"          crd3c_site as string,",
						"          crd3c_sourcewhname as string,",
						"          crd3c_uowarehousesid as string,",
						"          crd3c_warehousename as string,",
						"          crd3c_warehousetype as string,",
						"          createdbyname as string,",
						"          createdbyyominame as string,",
						"          createdon as timestamp,",
						"          createdonbehalfbyname as string,",
						"          createdonbehalfbyyominame as string,",
						"          hso_automaticpocreation as boolean,",
						"          hso_automaticpocreationname as string,",
						"          hso_companyicwarehouse as string,",
						"          hso_companylocalwarehouse as string,",
						"          hso_icwarehousename as string,",
						"          hso_ordertypesplit as integer,",
						"          hso_ordertypesplitname as string,",
						"          hso_sourceicwarehouse as string,",
						"          hso_vendorname as string,",
						"          importsequencenumber as integer,",
						"          modifiedbyname as string,",
						"          modifiedbyyominame as string,",
						"          modifiedon as timestamp,",
						"          modifiedonbehalfbyname as string,",
						"          modifiedonbehalfbyyominame as string,",
						"          overriddencreatedon as timestamp,",
						"          owneridname as string,",
						"          owneridtype as string,",
						"          owneridyominame as string,",
						"          owningbusinessunitname as string,",
						"          statecode as integer,",
						"          statecodename as string,",
						"          statuscode as integer,",
						"          statuscodename as string,",
						"          timezoneruleversionnumber as integer,",
						"          utcconversiontimezonecode as integer,",
						"          versionnumber as long,",
						"          createdonbehalfby as string,",
						"          hso_vendor as string,",
						"          hso_icwarehouse as string,",
						"          owninguser as string,",
						"          modifiedby as string,",
						"          modifiedonbehalfby as string,",
						"          ownerid as string,",
						"          {@odata.etag} as string,",
						"          crd3c_sourcewh as string,",
						"          createdby as string,",
						"          owningbusinessunit as string,",
						"          owningteam as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     store: 'dynamics',",
						"     format: 'dynamicsformat',",
						"     entity: 'crd3c_uowarehouses',",
						"     timeout: 30) ~> UOWarehouse",
						"source(output(",
						"          crd3c_company as string,",
						"          crd3c_dataimportexecutionid as string,",
						"          crd3c_name as string,",
						"          crd3c_store as string,",
						"          crd3c_triggersource as string,",
						"          crd3c_warehouse as string,",
						"          createdbyname as string,",
						"          createdbyyominame as string,",
						"          createdon as timestamp,",
						"          createdonbehalfbyname as string,",
						"          createdonbehalfbyyominame as string,",
						"          hso_companywarehouse as string,",
						"          hso_purchaseorder as boolean,",
						"          hso_purchaseordername as string,",
						"          importsequencenumber as integer,",
						"          modifiedbyname as string,",
						"          modifiedbyyominame as string,",
						"          modifiedon as timestamp,",
						"          modifiedonbehalfbyname as string,",
						"          modifiedonbehalfbyyominame as string,",
						"          overriddencreatedon as timestamp,",
						"          owneridname as string,",
						"          owneridtype as string,",
						"          owneridyominame as string,",
						"          owningbusinessunitname as string,",
						"          statecode as integer,",
						"          statecodename as string,",
						"          statuscode as integer,",
						"          statuscodename as string,",
						"          timezoneruleversionnumber as integer,",
						"          utcconversiontimezonecode as integer,",
						"          versionnumber as long,",
						"          createdonbehalfby as string,",
						"          owninguser as string,",
						"          modifiedby as string,",
						"          modifiedonbehalfby as string,",
						"          ownerid as string,",
						"          {@odata.etag} as string,",
						"          createdby as string,",
						"          owningbusinessunit as string,",
						"          owningteam as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false) ~> DataImportExecutions",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          sysdatastatecode as long,",
						"          itemdataareaid as string,",
						"          itemgroupdataareaid as string,",
						"          itemgroupid as string,",
						"          itemid as string,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/inventitemgroupitem_partitioned') ~> InventItemGroupItem",
						"source(output(",
						"          crd3c_availqty as integer,",
						"          crd3c_barcode as string,",
						"          crd3c_dataarea as string,",
						"          crd3c_itemvariant as string,",
						"          crd3c_itemvariantlookupname as string,",
						"          crd3c_name as string,",
						"          crd3c_orderqtiesid as string,",
						"          crd3c_quantity as integer,",
						"          crd3c_reqorderqty as integer,",
						"          crd3c_site as string,",
						"          crd3c_variantname as string,",
						"          crd3c_warehouselookupname as string,",
						"          createdbyname as string,",
						"          createdbyyominame as string,",
						"          createdon as timestamp,",
						"          createdonbehalfbyname as string,",
						"          createdonbehalfbyyominame as string,",
						"          hso_dualpurpose as boolean,",
						"          hso_dualpurposename as string,",
						"          hso_fts as integer,",
						"          hso_maxquantity as integer,",
						"          hso_minquantity as integer,",
						"          hso_size as string,",
						"          hso_teststring as string,",
						"          importsequencenumber as integer,",
						"          modifiedbyname as string,",
						"          modifiedbyyominame as string,",
						"          modifiedon as timestamp,",
						"          modifiedonbehalfbyname as string,",
						"          modifiedonbehalfbyyominame as string,",
						"          overriddencreatedon as timestamp,",
						"          owneridname as string,",
						"          owneridtype as string,",
						"          owneridyominame as string,",
						"          owningbusinessunitname as string,",
						"          statecode as integer,",
						"          statecodename as string,",
						"          statuscode as integer,",
						"          statuscodename as string,",
						"          timezoneruleversionnumber as integer,",
						"          utcconversiontimezonecode as integer,",
						"          versionnumber as long,",
						"          crd3c_warehouselookup as string,",
						"          createdonbehalfby as string,",
						"          owninguser as string,",
						"          modifiedby as string,",
						"          modifiedonbehalfby as string,",
						"          ownerid as string,",
						"          {@odata.etag} as string,",
						"          createdby as string,",
						"          owningbusinessunit as string,",
						"          crd3c_itemvariantlookup as string,",
						"          owningteam as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     store: 'dynamics',",
						"     format: 'dynamicsformat',",
						"     entity: 'crd3c_orderqties',",
						"     timeout: 30,",
						"     query: (concat('<fetch version=\"1.0\" output-format=\"xml-platform\" mapping=\"logical\" distinct=\"false\"><entity name=\"crd3c_orderqties\"><attribute name=\"crd3c_orderqtiesid\" /><attribute name=\"crd3c_dataarea\" /><attribute name=\"crd3c_site\" /><attribute name=\"crd3c_name\" /><attribute name=\"crd3c_itemvariant\" /><attribute name=\"crd3c_quantity\" /><attribute name=\"crd3c_barcode\" /><attribute name=\"createdon\" /><order attribute=\"crd3c_name\" descending=\"false\" /><filter type=\"and\"><condition attribute=\"crd3c_site\" operator=\"eq\" value=\"',$Store,'\" /></filter></entity></fetch>'))) ~> RecommendedOrderQty",
						"Inventsum derive(ItemSize = concat(itemid,coalesce( concat( '_',inventsizeid),'')),",
						"          DATAAREAID = upper(dataareaid),",
						"          INVENTLOCATIONID = upper(inventlocationid)) ~> ItemSize",
						"filter1 select(mapColumn(",
						"          DATAAREAID = ItemSize@DATAAREAID,",
						"          ITEMID = itemid,",
						"          INVENTSIZEID = inventsizeid,",
						"          INVENTLOCATIONID = ItemSize@INVENTLOCATIONID,",
						"          INVENTSITEID = inventsiteid,",
						"          AVAILPHYSICAL = availphysical,",
						"          ItemSize,",
						"          ORDERED = ordered",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectInventSum",
						"selectInventSum, filterMinOrderQty join(lower(DATAAREAID) == lower(dataarea)",
						"     && lower(ItemSize) == lower(itemvariant)",
						"     && lower(INVENTLOCATIONID) == lower(crd3c_site),",
						"     joinType:'right',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> joinInventSumRecorderQty",
						"derivedColumn5 filter((coalesce(AVAILPHYSICAL,0) + coalesce(ORDERED,0)) < MinOrderQty) ~> filterJoinInventSum",
						"EcoResProduct select(mapColumn(",
						"          DISPLAYPRODUCTNUMBER = displayproductnumber,",
						"          SEARCHNAME = searchname,",
						"          RECID = recid,",
						"          PARTITION = partition",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectEcoResProduct",
						"EcoResProductTranslation filter(equals(languageid, 'en-US')) ~> filterEcoResProductTranslation",
						"filterEcoResProductTranslation select(mapColumn(",
						"          DESCRIPTION = description,",
						"          PRODUCT = product,",
						"          PARTITION = partition",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectEcoResProductTranslation",
						"selectEcoResProduct, selectEcoResProductTranslation join(RECID == PRODUCT,",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"join1 select(mapColumn(",
						"          ITEMID = DISPLAYPRODUCTNUMBER,",
						"          DESCRIPTION,",
						"          SEARCHNAME",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectProductDescription",
						"filterJoinInventSum, selectProductDescription join(lower(Item) == lower(selectProductDescription@ITEMID),",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> StockLessThanMinimum",
						"StockLessThanMinimum, Warehouses join(lower(crd3c_site) == lower(Warehouses@INVENTLOCATIONID),",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> joinWhs",
						"joinWhs, selectSTKWhs join(lower(itemvariant) == lower(STKItemSize)",
						"     && lower(FromWhs) == lower(STKINVENTLOCATIONID)",
						"     && source_dataarea == STKDATAAREAID,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join2",
						"selectInventSum select(mapColumn(",
						"          STKDATAAREAID = DATAAREAID,",
						"          STKITEMID = ITEMID,",
						"          STKINVENTSIZEID = INVENTSIZEID,",
						"          STKINVENTLOCATIONID = INVENTLOCATIONID,",
						"          STKAVAILPHYSICAL = AVAILPHYSICAL,",
						"          STKItemSize = ItemSize",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectSTKWhs",
						"lookupInventItemGrp select(mapColumn(",
						"          cr5b1_dataarea = dataarea,",
						"          cr5b1_item = Item,",
						"          cr5b1_size = STKINVENTSIZEID,",
						"          cr5b1_site = Warehouses@INVENTSITEID,",
						"          crd3c_storeavailqty = AVAILPHYSICAL,",
						"          cr5b1_itemvariant = itemvariant,",
						"          crd3c_storeminqty = MinOrderQty,",
						"          cr5b1_itemdescription = DESCRIPTION,",
						"          cr5b1_towhs = Warehouses@INVENTLOCATIONID,",
						"          cr5b1_fromwhs = FromWhs,",
						"          crd3c_fromwhsstockqty = STKAVAILPHYSICAL,",
						"          crd3c_inboundorderqty = ORDERED,",
						"          crd3c_batchid,",
						"          hso_barcode = crd3c_barcode,",
						"          hso_purchaseorder = SEARCHNAME,",
						"          hso_itemgroupid = itemgroupid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectCols",
						"crd3cstoreavailqtyzero derive(crd3c_name = uuid(),",
						"          crd3c_toqty = iif((crd3c_storeminqty-(crd3c_storeavailqtyzero +crd3c_inboundorderqty )) > crd3c_fromwhsstockqty, crd3c_fromwhsstockqty, (crd3c_storeminqty-(crd3c_storeavailqtyzero +crd3c_inboundorderqty ))),",
						"          cr5b1_createddate = currentTimestamp(),",
						"          crd3c_transferorderid = '00000000-0000-0000-0000-000000000000',",
						"          hso_purchaseorder = iif($OrderType == 'TRANSFER ORDER', false(), true()),",
						"          hso_batchnumber = 1) ~> derivedColumn2",
						"WhsUpperDataArea select(mapColumn(",
						"          crd3c_uowarehousesid,",
						"          crd3c_dataarea,",
						"          crd3c_site,",
						"          crd3c_warehousename,",
						"          crd3c_name,",
						"          crd3c_sourcewh,",
						"          hso_ordertypesplitname,",
						"          hso_ordertypesplit,",
						"          hso_sourceicwarehouse",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectWarehouse",
						"selectWarehouse filter(!isNull(hso_sourceicwarehouse) && !equals(hso_sourceicwarehouse, '')) ~> filterWarehouse",
						"filterWarehouse, selectSourceWarehouse join(crd3c_sourcewh == source_crd3c_uowarehousesid,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join3",
						"selectWarehouse select(mapColumn(",
						"          source_crd3c_uowarehousesid = crd3c_uowarehousesid,",
						"          source_crd3c_dataarea = crd3c_dataarea,",
						"          source_crd3c_site = crd3c_site,",
						"          source_crd3c_warehousename = crd3c_warehousename,",
						"          source_crd3c_name = crd3c_name,",
						"          source_crd3c_sourcewh = crd3c_sourcewh,",
						"          source_hso_sourceicwarehouse = hso_sourceicwarehouse",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectSourceWarehouse",
						"derivedColumn3 select(mapColumn(",
						"          INVENTLOCATIONID = crd3c_name,",
						"          DATAAREAID = crd3c_dataarea,",
						"          INVENTSITEID = crd3c_site,",
						"          FromWhs = source_crd3c_name,",
						"          warehousename = crd3c_warehousename,",
						"          source_dataarea = source_crd3c_dataarea,",
						"          source_site = source_crd3c_site,",
						"          source_warehousename = source_crd3c_warehousename,",
						"          crd3c_batchid,",
						"          hso_ordertypesplitname,",
						"          hso_ordertypesplit,",
						"          source_hso_sourceicwarehouse",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectWarehouseCombined",
						"RecommendedOrderQty select(mapColumn(",
						"          crd3c_name,",
						"          crd3c_site,",
						"          itemvariant = crd3c_itemvariant,",
						"          MinOrderQty = crd3c_quantity,",
						"          dataarea = crd3c_dataarea,",
						"          crd3c_barcode",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectMinOrderQty",
						"MinOrderUpperDataArea filter((MinOrderQty > 0) && (equals(upper(dataarea) , upper($Company)) || equals(upper($Company) , \"ALL\") ) && (equals(crd3c_site , upper($Store))  ||  equals(upper($Store) , \"ALL\"))) ~> filterMinOrderQty",
						"UOWarehouse derive(crd3c_dataarea = upper(crd3c_dataarea),",
						"          crd3c_site = upper(crd3c_site),",
						"          crd3c_name = upper(crd3c_name)) ~> WhsUpperDataArea",
						"selectMinOrderQty derive(dataarea = upper(dataarea),",
						"          crd3c_site = upper(crd3c_site),",
						"          Item = substringIndex(crd3c_name, '_', 1)) ~> MinOrderUpperDataArea",
						"derivedColumn2 aggregate(groupBy(cr5b1_dataarea,",
						"          cr5b1_towhs,",
						"          cr5b1_fromwhs,",
						"          hso_purchaseorder,",
						"          crd3c_batchid),",
						"     each(match((name!=\"cr5b1_dataarea\")&&(name!=\"cr5b1_towhs\")&&(name!=\"cr5b1_fromwhs\")&&(name!=\"hso_purchaseorder\")&&(name!=\"crd3c_batchid\")), $$ = first($$))) ~> aggregate1",
						"aggregate1 select(mapColumn(",
						"          crd3c_company = cr5b1_dataarea,",
						"          crd3c_store = cr5b1_towhs,",
						"          crd3c_warehouse = cr5b1_fromwhs,",
						"          crd3c_name = crd3c_batchid,",
						"          hso_purchaseorder",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"ItemSize filter(((equals(ItemSize@INVENTLOCATIONID , upper($Store))  ||  equals(upper($Store) , \"ALL\")) || (equals(ItemSize@INVENTLOCATIONID , upper($Warehouse))  ||  equals(upper($Warehouse) , \"ALL\"))) && itemid == '2UE30800553') ~> filter1",
						"union2 derive(crd3c_batchid = uuid()) ~> derivedColumn3",
						"derivedColumn2 filter(crd3c_toqty > 0) ~> filter2",
						"selectWarehouse filter(equals(crd3c_name,$Store) && equalsIgnoreCase(crd3c_dataarea,$Company)) ~> filteronStoreParameter",
						"selectSourceWarehouse filter(equals(source_crd3c_name,$Warehouse)) ~> filteronWarehouseParameter",
						"filteronStoreParameter, filteronWarehouseParameter join(equals(crd3c_name,$Store) && equals(source_crd3c_name,$Warehouse),",
						"     joinType:'cross',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join4",
						"join4 derive(crd3c_batchid = uuid()) ~> derivedColumn4",
						"derivedColumn4 select(mapColumn(",
						"          INVENTLOCATIONID = crd3c_name,",
						"          DATAAREAID = crd3c_dataarea,",
						"          INVENTSITEID = crd3c_site,",
						"          FromWhs = source_crd3c_name,",
						"          warehousename = crd3c_warehousename,",
						"          source_dataarea = source_crd3c_dataarea,",
						"          source_site = source_crd3c_site,",
						"          source_warehousename = source_crd3c_warehousename,",
						"          crd3c_batchid,",
						"          hso_ordertypesplitname,",
						"          hso_ordertypesplit,",
						"          source_icwarehouse = source_hso_sourceicwarehouse",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectWarehouseOnParameters",
						"join3 filter((equals(crd3c_dataarea , upper($Company)) || equals(upper($Company) , \"ALL\") ) ",
						"&& (equals(crd3c_name , upper($Store))  ||  equals(upper($Store) , \"ALL\")) ",
						"&& (equals(source_crd3c_name , upper($Warehouse))  ||  equals(upper($Warehouse) , \"ALL\"))) ~> filter3",
						"derivedColumn7, SelectWarehouseOnParameters union(byName: true)~> union1",
						"union1 aggregate(groupBy(INVENTLOCATIONID,",
						"          DATAAREAID,",
						"          FromWhs,",
						"          INVENTSITEID,",
						"          source_dataarea),",
						"     crd3c_batchid = max(crd3c_batchid)) ~> Warehouses",
						"select2 derive(crd3c_triggersource = $TriggerSource) ~> triggersource",
						"selectCols derive(crd3c_storeavailqtyzero = iif(crd3c_storeavailqty <0 ,crd3c_storeavailqty*0 ,crd3c_storeavailqty  )) ~> crd3cstoreavailqtyzero",
						"joinInventSumRecorderQty derive(AVAILPHYSICAL = coalesce(AVAILPHYSICAL,0),",
						"          ORDERED = coalesce(ORDERED,0)) ~> derivedColumn5",
						"DataImportExecutions select(mapColumn(",
						"          hso_purchaseorder",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectPOBoolean",
						"filter2 select(mapColumn(",
						"          hso_dataarea = cr5b1_dataarea,",
						"          hso_item = cr5b1_item,",
						"          hso_size = cr5b1_size,",
						"          hso_site = cr5b1_site,",
						"          hso_storequantity = crd3c_storeavailqty,",
						"          hso_itemvariant = cr5b1_itemvariant,",
						"          hso_storeminquantity = crd3c_storeminqty,",
						"          hso_itemdescription = cr5b1_itemdescription,",
						"          hso_store = cr5b1_towhs,",
						"          hso_sourceicwarehouse = cr5b1_fromwhs,",
						"          hso_fromwhsqty = crd3c_fromwhsstockqty,",
						"          hso_inboundorderqty = crd3c_inboundorderqty,",
						"          hso_batchid = crd3c_batchid,",
						"          hso_barcode,",
						"          hso_name = crd3c_name,",
						"          hso_orderquantity = crd3c_toqty,",
						"          hso_createddate = cr5b1_createddate,",
						"          hso_purchaseorderlinesid = crd3c_transferorderid,",
						"          hso_batchnumber,",
						"          hso_itemgroupid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select4",
						"filterWarehouse, selectSourceWarehouse join(hso_sourceicwarehouse == source_hso_sourceicwarehouse,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join5",
						"derivedColumn6 filter((equals(selectWarehouse@crd3c_dataarea , upper($Company)) || equals(upper($Company) , \"ALL\") ) ",
						"&& (equals(selectWarehouse@crd3c_name , upper($Store))  ||  equals(upper($Store) , \"ALL\")) ",
						"&& (equals(source_hso_sourceicwarehouse , upper($Warehouse))  ||  equals(upper($Warehouse) , \"ALL\"))) ~> filter4",
						"filter3, select5 union(byName: true)~> union2",
						"join5, UOWarehouse lookup(selectWarehouse@hso_sourceicwarehouse == UOWarehouse@crd3c_name,",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> lookup1",
						"lookup1 derive(source_crd3c_dataarea = UOWarehouse@crd3c_dataarea) ~> derivedColumn6",
						"filter4 select(mapColumn(",
						"          source_crd3c_dataarea,",
						"          source_hso_sourceicwarehouse,",
						"          crd3c_name = selectWarehouse@crd3c_name,",
						"          crd3c_dataarea = selectWarehouse@crd3c_dataarea",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select5",
						"selectWarehouseCombined derive(FromWhs = source_hso_sourceicwarehouse) ~> derivedColumn7",
						"InventItemGroupItem select(mapColumn(",
						"          itemid,",
						"          itemgroupid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectInvItemGrpCols",
						"join2, selectInvItemGrpCols lookup(lower(Item) == lower(selectInvItemGrpCols@itemid),",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> lookupInventItemGrp",
						"filter1 select(mapColumn(",
						"          itemid,",
						"          each(match(/* All input columns */true()),",
						"               /* Input name */$$ = $$)",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select6",
						"triggersource sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     store: 'dynamics',",
						"     format: 'dynamicsformat',",
						"     entity: 'crd3c_dataimportexecution',",
						"     timeout: 30,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     saveOrder: 0,",
						"     mapColumn(",
						"          crd3c_company,",
						"          crd3c_store,",
						"          crd3c_warehouse,",
						"          crd3c_name,",
						"          crd3c_triggersource,",
						"          hso_purchaseorder",
						"     ),",
						"     partitionBy('hash', 1)) ~> DataExecutionsTO",
						"select4 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delimited',",
						"     container: 'whsstockreplenish',",
						"     columnDelimiter: ';',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true,",
						"     partitionFileNames:[(concat($filename, '.csv'))],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     partitionBy('hash', 1)) ~> PurchaseOrdersSink",
						"select6 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delimited',",
						"     container: 'whsstockreplenish',",
						"     folderPath: 'OL',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true,",
						"     partitionFileNames:['sink1.csv'],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     partitionBy('hash', 1)) ~> sink1",
						"filterMinOrderQty sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delimited',",
						"     container: 'whsstockreplenish',",
						"     folderPath: 'OL',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true,",
						"     partitionFileNames:['RecOrderQty_Test_1.csv'],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     partitionBy('hash', 1)) ~> sink2",
						"join2 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delimited',",
						"     container: 'whsstockreplenish',",
						"     folderPath: 'OL',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true,",
						"     partitionFileNames:['sink2.csv'],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     partitionBy('hash', 1)) ~> sink3",
						"select4 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delimited',",
						"     container: 'whsstockreplenish',",
						"     folderPath: 'OL',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true,",
						"     partitionFileNames:['sink3.csv'],",
						"     partitionBy('hash', 1)) ~> sink4"
					]
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/CreatePurchaseOrderLines_v1_0_0')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "Including virtual/web stores",
				"folder": {
					"name": "OL/Create POs - Dual Purpose"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "Inventsum"
						},
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "EcoResProduct"
						},
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "EcoResProductTranslation"
						},
						{
							"linkedService": {
								"referenceName": "powerappdataverse",
								"type": "LinkedServiceReference"
							},
							"name": "RecommendedOrderQty"
						},
						{
							"dataset": {
								"referenceName": "DataImportExecution",
								"type": "DatasetReference"
							},
							"name": "DataImportExecutions"
						},
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "InventItemGroupItem"
						},
						{
							"linkedService": {
								"referenceName": "powerappdataverse",
								"type": "LinkedServiceReference"
							},
							"name": "UOWarehouse"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "powerappdataverse",
								"type": "LinkedServiceReference"
							},
							"name": "DataExecutionsTO"
						},
						{
							"linkedService": {
								"referenceName": "storageaccount",
								"type": "LinkedServiceReference"
							},
							"name": "PurchaseOrdersSink"
						}
					],
					"transformations": [
						{
							"name": "ItemSize"
						},
						{
							"name": "selectInventSum"
						},
						{
							"name": "joinInventSumRecorderQty"
						},
						{
							"name": "filterJoinInventSum",
							"description": "Filtering rows using expressions on columns 'AVAILPHYSICAL, ORDERED, MinOrderQty' + hso_FTS"
						},
						{
							"name": "selectEcoResProduct"
						},
						{
							"name": "filterEcoResProductTranslation"
						},
						{
							"name": "selectEcoResProductTranslation"
						},
						{
							"name": "join1"
						},
						{
							"name": "selectProductDescription"
						},
						{
							"name": "StockLessThanMinimum"
						},
						{
							"name": "joinWhs"
						},
						{
							"name": "join2"
						},
						{
							"name": "selectSTKWhs"
						},
						{
							"name": "selectCols"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "selectWarehouse"
						},
						{
							"name": "filterWarehouse"
						},
						{
							"name": "join3"
						},
						{
							"name": "selectSourceWarehouse"
						},
						{
							"name": "selectWarehouseCombined"
						},
						{
							"name": "selectMinOrderQty"
						},
						{
							"name": "filterMinOrderQty"
						},
						{
							"name": "WhsUpperDataArea"
						},
						{
							"name": "MinOrderUpperDataArea"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select2"
						},
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn3"
						},
						{
							"name": "filter2"
						},
						{
							"name": "filteronStoreParameter"
						},
						{
							"name": "filteronWarehouseParameter"
						},
						{
							"name": "join4"
						},
						{
							"name": "derivedColumn4"
						},
						{
							"name": "SelectWarehouseOnParameters"
						},
						{
							"name": "filter3"
						},
						{
							"name": "union1"
						},
						{
							"name": "Warehouses"
						},
						{
							"name": "triggersource"
						},
						{
							"name": "crd3cstoreavailqtyzero"
						},
						{
							"name": "derivedColumn5"
						},
						{
							"name": "selectPOBoolean"
						},
						{
							"name": "select4"
						},
						{
							"name": "join5"
						},
						{
							"name": "filter4"
						},
						{
							"name": "union2"
						},
						{
							"name": "lookup1"
						},
						{
							"name": "derivedColumn6"
						},
						{
							"name": "select5"
						},
						{
							"name": "derivedColumn7"
						},
						{
							"name": "selectInvItemGrpCols"
						},
						{
							"name": "lookupInventItemGrp"
						}
					],
					"scriptLines": [
						"parameters{",
						"     Company as string,",
						"     Store as string,",
						"     Warehouse as string,",
						"     filename as string,",
						"     TriggerSource as string,",
						"     Container as string,",
						"     OrderType as string,",
						"     isDualPurposeStore as boolean,",
						"     isItemGroupingEnabled as boolean",
						"}",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          closed as long,",
						"          closedqty as long,",
						"          isexcludedfrominventoryvalue as long,",
						"          sysdatastatecode as long,",
						"          arrived as decimal(38,6),",
						"          availordered as decimal(38,6),",
						"          availphysical as decimal(38,6),",
						"          deducted as decimal(38,6),",
						"          inventdimid as string,",
						"          itemid as string,",
						"          lastupddateexpected as timestamp,",
						"          lastupddatephysical as timestamp,",
						"          onorder as decimal(38,6),",
						"          ordered as decimal(38,6),",
						"          pdscwarrived as decimal(38,6),",
						"          pdscwavailordered as decimal(38,6),",
						"          pdscwavailphysical as decimal(38,6),",
						"          pdscwdeducted as decimal(38,6),",
						"          pdscwonorder as decimal(38,6),",
						"          pdscwordered as decimal(38,6),",
						"          pdscwphysicalinvent as decimal(38,6),",
						"          pdscwpicked as decimal(38,6),",
						"          pdscwpostedqty as decimal(38,6),",
						"          pdscwquotationissue as decimal(38,6),",
						"          pdscwquotationreceipt as decimal(38,6),",
						"          pdscwreceived as decimal(38,6),",
						"          pdscwregistered as decimal(38,6),",
						"          pdscwreservordered as decimal(38,6),",
						"          pdscwreservphysical as decimal(38,6),",
						"          physicalinvent as decimal(38,6),",
						"          physicalvalue as decimal(38,6),",
						"          physicalvalueseccur_ru as decimal(38,6),",
						"          picked as decimal(38,6),",
						"          postedqty as decimal(38,6),",
						"          postedvalue as decimal(38,6),",
						"          postedvalueseccur_ru as decimal(38,6),",
						"          quotationissue as decimal(38,6),",
						"          quotationreceipt as decimal(38,6),",
						"          received as decimal(38,6),",
						"          registered as decimal(38,6),",
						"          reservordered as decimal(38,6),",
						"          reservphysical as decimal(38,6),",
						"          configid as string,",
						"          inventbatchid as string,",
						"          inventcolorid as string,",
						"          inventgtdid_ru as string,",
						"          inventlocationid as string,",
						"          inventownerid_ru as string,",
						"          inventprofileid_ru as string,",
						"          inventserialid as string,",
						"          inventsiteid as string,",
						"          inventsizeid as string,",
						"          inventstatusid as string,",
						"          inventstyleid as string,",
						"          inventversionid as string,",
						"          licenseplateid as string,",
						"          wmslocationid as string,",
						"          wmspalletid as string,",
						"          inventdimension1 as string,",
						"          inventdimension2 as string,",
						"          inventdimension3 as string,",
						"          inventdimension4 as string,",
						"          inventdimension5 as string,",
						"          inventdimension6 as string,",
						"          inventdimension7 as string,",
						"          inventdimension8 as string,",
						"          inventdimension9 as timestamp,",
						"          inventdimension10 as decimal(38,6),",
						"          inventdimension11 as string,",
						"          inventdimension12 as string,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/inventsum_partitioned',",
						"     manifestType: 'manifest') ~> Inventsum",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          pdscwproduct as long,",
						"          producttype as long,",
						"          servicetype as long,",
						"          sunplmsyncwithplm as long,",
						"          sysdatastatecode as long,",
						"          displayproductnumber as string,",
						"          instancerelationtype as long,",
						"          searchname as string,",
						"          engchgproductownerid as string,",
						"          engchgproductcategorydetails as long,",
						"          engchgproductreleasepolicy as long,",
						"          engchgproductreadinesspolicy as long,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/ecoresproduct_partitioned',",
						"     manifestType: 'manifest') ~> EcoResProduct",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          sysdatastatecode as long,",
						"          description as string,",
						"          languageid as string,",
						"          name as string,",
						"          product as long,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/ecoresproducttranslation_partitioned',",
						"     manifestType: 'manifest') ~> EcoResProductTranslation",
						"source(output(",
						"          crd3c_availqty as integer,",
						"          crd3c_barcode as string,",
						"          crd3c_dataarea as string,",
						"          crd3c_itemvariant as string,",
						"          crd3c_itemvariantlookupname as string,",
						"          crd3c_name as string,",
						"          crd3c_orderqtiesid as string,",
						"          crd3c_quantity as integer,",
						"          crd3c_reqorderqty as integer,",
						"          crd3c_site as string,",
						"          crd3c_variantname as string,",
						"          crd3c_warehouselookupname as string,",
						"          createdbyname as string,",
						"          createdbyyominame as string,",
						"          createdon as timestamp,",
						"          createdonbehalfbyname as string,",
						"          createdonbehalfbyyominame as string,",
						"          hso_fts as integer,",
						"          hso_maxquantity as integer,",
						"          hso_minquantity as integer,",
						"          hso_size as string,",
						"          hso_teststring as string,",
						"          importsequencenumber as integer,",
						"          modifiedbyname as string,",
						"          modifiedbyyominame as string,",
						"          modifiedon as timestamp,",
						"          modifiedonbehalfbyname as string,",
						"          modifiedonbehalfbyyominame as string,",
						"          overriddencreatedon as timestamp,",
						"          owneridname as string,",
						"          owneridtype as string,",
						"          owneridyominame as string,",
						"          owningbusinessunitname as string,",
						"          statecode as integer,",
						"          statecodename as string,",
						"          statuscode as integer,",
						"          statuscodename as string,",
						"          timezoneruleversionnumber as integer,",
						"          utcconversiontimezonecode as integer,",
						"          versionnumber as long,",
						"          crd3c_warehouselookup as string,",
						"          createdonbehalfby as string,",
						"          owninguser as string,",
						"          modifiedby as string,",
						"          modifiedonbehalfby as string,",
						"          ownerid as string,",
						"          {@odata.etag} as string,",
						"          createdby as string,",
						"          owningbusinessunit as string,",
						"          crd3c_itemvariantlookup as string,",
						"          owningteam as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     store: 'dynamics',",
						"     format: 'dynamicsformat',",
						"     entity: 'crd3c_orderqties',",
						"     timeout: 30,",
						"     query: (concat('<fetch version=\"1.0\" output-format=\"xml-platform\" mapping=\"logical\" distinct=\"false\"><entity name=\"crd3c_orderqties\"><attribute name=\"crd3c_orderqtiesid\"/><attribute name=\"crd3c_dataarea\"/><attribute name=\"crd3c_site\"/><attribute name=\"crd3c_name\"/><attribute name=\"crd3c_itemvariant\"/><attribute name=\"crd3c_quantity\"/><attribute name=\"crd3c_barcode\"/><attribute name=\"createdon\"/><attribute name=\"hso_fts\"/><order attribute=\"crd3c_name\" descending=\"false\"/><filter type=\"and\"><condition attribute=\"crd3c_site\" operator=\"eq\" value=\"',$Store,'\"/></filter></entity></fetch>'))) ~> RecommendedOrderQty",
						"source(output(",
						"          crd3c_company as string,",
						"          crd3c_dataimportexecutionid as string,",
						"          crd3c_name as string,",
						"          crd3c_store as string,",
						"          crd3c_triggersource as string,",
						"          crd3c_warehouse as string,",
						"          createdbyname as string,",
						"          createdbyyominame as string,",
						"          createdon as timestamp,",
						"          createdonbehalfbyname as string,",
						"          createdonbehalfbyyominame as string,",
						"          hso_companywarehouse as string,",
						"          hso_purchaseorder as boolean,",
						"          hso_purchaseordername as string,",
						"          importsequencenumber as integer,",
						"          modifiedbyname as string,",
						"          modifiedbyyominame as string,",
						"          modifiedon as timestamp,",
						"          modifiedonbehalfbyname as string,",
						"          modifiedonbehalfbyyominame as string,",
						"          overriddencreatedon as timestamp,",
						"          owneridname as string,",
						"          owneridtype as string,",
						"          owneridyominame as string,",
						"          owningbusinessunitname as string,",
						"          statecode as integer,",
						"          statecodename as string,",
						"          statuscode as integer,",
						"          statuscodename as string,",
						"          timezoneruleversionnumber as integer,",
						"          utcconversiontimezonecode as integer,",
						"          versionnumber as long,",
						"          createdonbehalfby as string,",
						"          owninguser as string,",
						"          modifiedby as string,",
						"          modifiedonbehalfby as string,",
						"          ownerid as string,",
						"          {@odata.etag} as string,",
						"          createdby as string,",
						"          owningbusinessunit as string,",
						"          owningteam as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false) ~> DataImportExecutions",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          sysdatastatecode as long,",
						"          itemdataareaid as string,",
						"          itemgroupdataareaid as string,",
						"          itemgroupid as string,",
						"          itemid as string,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/inventitemgroupitem_partitioned') ~> InventItemGroupItem",
						"source(output(",
						"          crd3c_automatictocreation as boolean,",
						"          crd3c_automatictocreationname as string,",
						"          crd3c_dataarea as string,",
						"          crd3c_datastatus as integer,",
						"          crd3c_datastatusname as string,",
						"          crd3c_deliveryterms as string,",
						"          crd3c_modeofdelivery as string,",
						"          crd3c_name as string,",
						"          crd3c_refreshday as string,",
						"          crd3c_refreshdayname as string,",
						"          crd3c_refreshfrequency as integer,",
						"          crd3c_refreshtime as timestamp,",
						"          crd3c_site as string,",
						"          crd3c_sourcewhname as string,",
						"          crd3c_uowarehousesid as string,",
						"          crd3c_warehousename as string,",
						"          crd3c_warehousetype as string,",
						"          createdbyname as string,",
						"          createdbyyominame as string,",
						"          createdon as timestamp,",
						"          createdonbehalfbyname as string,",
						"          createdonbehalfbyyominame as string,",
						"          hso_automaticpocreation as boolean,",
						"          hso_automaticpocreationname as string,",
						"          hso_autoreservation as boolean,",
						"          hso_autoreservationname as string,",
						"          hso_companyicwarehouse as string,",
						"          hso_companylocalwarehouse as string,",
						"          hso_dualpurpose as boolean,",
						"          hso_dualpurposename as string,",
						"          hso_icwarehousename as string,",
						"          hso_itemgroup as boolean,",
						"          hso_itemgroupname as string,",
						"          hso_maxtoqty as integer,",
						"          hso_ordertypesplit as integer,",
						"          hso_ordertypesplitname as string,",
						"          hso_sourceicwarehouse as string,",
						"          hso_storeleadername as string,",
						"          hso_storeleaderyominame as string,",
						"          hso_vendorname as string,",
						"          importsequencenumber as integer,",
						"          modifiedbyname as string,",
						"          modifiedbyyominame as string,",
						"          modifiedon as timestamp,",
						"          modifiedonbehalfbyname as string,",
						"          modifiedonbehalfbyyominame as string,",
						"          overriddencreatedon as timestamp,",
						"          owneridname as string,",
						"          owneridtype as string,",
						"          owneridyominame as string,",
						"          owningbusinessunitname as string,",
						"          statecode as integer,",
						"          statecodename as string,",
						"          statuscode as integer,",
						"          statuscodename as string,",
						"          timezoneruleversionnumber as integer,",
						"          utcconversiontimezonecode as integer,",
						"          versionnumber as long,",
						"          createdonbehalfby as string,",
						"          hso_vendor as string,",
						"          hso_icwarehouse as string,",
						"          owninguser as string,",
						"          modifiedby as string,",
						"          hso_storeleader as string,",
						"          modifiedonbehalfby as string,",
						"          ownerid as string,",
						"          {@odata.etag} as string,",
						"          crd3c_sourcewh as string,",
						"          createdby as string,",
						"          owningbusinessunit as string,",
						"          owningteam as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     store: 'dynamics',",
						"     format: 'dynamicsformat',",
						"     entity: 'crd3c_uowarehouses',",
						"     timeout: 30) ~> UOWarehouse",
						"Inventsum derive(ItemSize = concat(itemid,coalesce( concat( '_',inventsizeid),'')),",
						"          DATAAREAID = upper(dataareaid),",
						"          INVENTLOCATIONID = upper(inventlocationid)) ~> ItemSize",
						"filter1 select(mapColumn(",
						"          DATAAREAID = ItemSize@DATAAREAID,",
						"          ITEMID = itemid,",
						"          INVENTSIZEID = inventsizeid,",
						"          INVENTLOCATIONID = ItemSize@INVENTLOCATIONID,",
						"          INVENTSITEID = inventsiteid,",
						"          AVAILPHYSICAL = availphysical,",
						"          ItemSize,",
						"          ORDERED = ordered",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectInventSum",
						"selectInventSum, filterMinOrderQty join(lower(DATAAREAID) == lower(dataarea)",
						"     && lower(ItemSize) == lower(itemvariant)",
						"     && lower(INVENTLOCATIONID) == lower(crd3c_site),",
						"     joinType:'right',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> joinInventSumRecorderQty",
						"derivedColumn5 filter(iif($isDualPurposeStore, coalesce(AVAILPHYSICAL,0), coalesce(AVAILPHYSICAL,0) + coalesce(ORDERED,0)) < MSL + FreeToSell) ~> filterJoinInventSum",
						"EcoResProduct select(mapColumn(",
						"          DISPLAYPRODUCTNUMBER = displayproductnumber,",
						"          SEARCHNAME = searchname,",
						"          RECID = recid,",
						"          PARTITION = partition",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectEcoResProduct",
						"EcoResProductTranslation filter(equals(languageid, 'en-US')) ~> filterEcoResProductTranslation",
						"filterEcoResProductTranslation select(mapColumn(",
						"          DESCRIPTION = description,",
						"          PRODUCT = product,",
						"          PARTITION = partition",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectEcoResProductTranslation",
						"selectEcoResProduct, selectEcoResProductTranslation join(RECID == PRODUCT,",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"join1 select(mapColumn(",
						"          ITEMID = DISPLAYPRODUCTNUMBER,",
						"          DESCRIPTION,",
						"          SEARCHNAME",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectProductDescription",
						"filterJoinInventSum, selectProductDescription join(lower(Item) == lower(selectProductDescription@ITEMID),",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> StockLessThanMinimum",
						"StockLessThanMinimum, Warehouses join(lower(crd3c_site) == lower(Warehouses@INVENTLOCATIONID),",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> joinWhs",
						"joinWhs, selectSTKWhs join(lower(itemvariant) == lower(STKItemSize)",
						"     && lower(FromWhs) == lower(STKINVENTLOCATIONID)",
						"     && source_dataarea == STKDATAAREAID,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join2",
						"selectInventSum select(mapColumn(",
						"          STKDATAAREAID = DATAAREAID,",
						"          STKITEMID = ITEMID,",
						"          STKINVENTSIZEID = INVENTSIZEID,",
						"          STKINVENTLOCATIONID = INVENTLOCATIONID,",
						"          STKAVAILPHYSICAL = AVAILPHYSICAL,",
						"          STKItemSize = ItemSize",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectSTKWhs",
						"lookupInventItemGrp select(mapColumn(",
						"          crd3c_storeminqty = MSL,",
						"          cr5b1_dataarea = dataarea,",
						"          cr5b1_item = Item,",
						"          cr5b1_size = STKINVENTSIZEID,",
						"          cr5b1_site = Warehouses@INVENTSITEID,",
						"          crd3c_storeavailqty = AVAILPHYSICAL,",
						"          cr5b1_itemvariant = itemvariant,",
						"          cr5b1_itemdescription = DESCRIPTION,",
						"          cr5b1_towhs = Warehouses@INVENTLOCATIONID,",
						"          cr5b1_fromwhs = FromWhs,",
						"          crd3c_fromwhsstockqty = STKAVAILPHYSICAL,",
						"          crd3c_inboundorderqty = ORDERED,",
						"          crd3c_batchid,",
						"          hso_barcode = crd3c_barcode,",
						"          hso_purchaseorder = SEARCHNAME,",
						"          hso_itemgroupid = itemgroupid,",
						"          hso_fts = FreeToSell",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectCols",
						"crd3cstoreavailqtyzero derive(crd3c_name = uuid(),",
						"          crd3c_toqty = iif($isDualPurposeStore,\r",
						"    iif((crd3c_storeminqty + hso_fts-crd3c_storeavailqtyzero) > crd3c_fromwhsstockqty, crd3c_fromwhsstockqty, (crd3c_storeminqty+hso_fts-crd3c_storeavailqtyzero)),\r",
						"    iif((crd3c_storeminqty + hso_fts-(crd3c_storeavailqtyzero +crd3c_inboundorderqty )) > crd3c_fromwhsstockqty, crd3c_fromwhsstockqty, (crd3c_storeminqty+hso_fts-(crd3c_storeavailqtyzero +crd3c_inboundorderqty )))\r",
						"),",
						"          cr5b1_createddate = currentTimestamp(),",
						"          crd3c_transferorderid = '00000000-0000-0000-0000-000000000000',",
						"          hso_purchaseorder = iif($OrderType == 'TRANSFER ORDER', false(), true()),",
						"          hso_batchnumber = 1,",
						"          hso_itemgroupid = iif($isItemGroupingEnabled, hso_itemgroupid, '00')) ~> derivedColumn2",
						"WhsUpperDataArea select(mapColumn(",
						"          crd3c_uowarehousesid,",
						"          crd3c_dataarea,",
						"          crd3c_site,",
						"          crd3c_warehousename,",
						"          crd3c_name,",
						"          crd3c_sourcewh,",
						"          hso_ordertypesplitname,",
						"          hso_ordertypesplit,",
						"          hso_sourceicwarehouse",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectWarehouse",
						"selectWarehouse filter(!isNull(hso_sourceicwarehouse) && !equals(hso_sourceicwarehouse, '')) ~> filterWarehouse",
						"filterWarehouse, selectSourceWarehouse join(crd3c_sourcewh == source_crd3c_uowarehousesid,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join3",
						"selectWarehouse select(mapColumn(",
						"          source_crd3c_uowarehousesid = crd3c_uowarehousesid,",
						"          source_crd3c_dataarea = crd3c_dataarea,",
						"          source_crd3c_site = crd3c_site,",
						"          source_crd3c_warehousename = crd3c_warehousename,",
						"          source_crd3c_name = crd3c_name,",
						"          source_crd3c_sourcewh = crd3c_sourcewh,",
						"          source_hso_sourceicwarehouse = hso_sourceicwarehouse",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectSourceWarehouse",
						"derivedColumn3 select(mapColumn(",
						"          INVENTLOCATIONID = crd3c_name,",
						"          DATAAREAID = crd3c_dataarea,",
						"          INVENTSITEID = crd3c_site,",
						"          FromWhs = source_crd3c_name,",
						"          warehousename = crd3c_warehousename,",
						"          source_dataarea = source_crd3c_dataarea,",
						"          source_site = source_crd3c_site,",
						"          source_warehousename = source_crd3c_warehousename,",
						"          crd3c_batchid,",
						"          hso_ordertypesplitname,",
						"          hso_ordertypesplit,",
						"          source_hso_sourceicwarehouse",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectWarehouseCombined",
						"RecommendedOrderQty select(mapColumn(",
						"          crd3c_name,",
						"          FreeToSell = hso_fts,",
						"          crd3c_site,",
						"          itemvariant = crd3c_itemvariant,",
						"          MSL = crd3c_quantity,",
						"          dataarea = crd3c_dataarea,",
						"          crd3c_barcode",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectMinOrderQty",
						"MinOrderUpperDataArea filter((MSL > 0 || FreeToSell > 0) && (equals(upper(dataarea) , upper($Company)) || equals(upper($Company) , \"ALL\") ) && (equals(crd3c_site , upper($Store))  ||  equals(upper($Store) , \"ALL\"))) ~> filterMinOrderQty",
						"UOWarehouse derive(crd3c_dataarea = upper(crd3c_dataarea),",
						"          crd3c_site = upper(crd3c_site),",
						"          crd3c_name = upper(crd3c_name)) ~> WhsUpperDataArea",
						"selectMinOrderQty derive(dataarea = upper(dataarea),",
						"          MSL = coalesce(MSL,0),",
						"          FreeToSell = coalesce(FreeToSell,0),",
						"          crd3c_site = upper(crd3c_site),",
						"          Item = substringIndex(crd3c_name, '_', 1)) ~> MinOrderUpperDataArea",
						"derivedColumn2 aggregate(groupBy(cr5b1_dataarea,",
						"          cr5b1_towhs,",
						"          cr5b1_fromwhs,",
						"          hso_purchaseorder,",
						"          crd3c_batchid),",
						"     each(match((name!=\"cr5b1_dataarea\")&&(name!=\"cr5b1_towhs\")&&(name!=\"cr5b1_fromwhs\")&&(name!=\"hso_purchaseorder\")&&(name!=\"crd3c_batchid\")), $$ = first($$))) ~> aggregate1",
						"aggregate1 select(mapColumn(",
						"          crd3c_store = cr5b1_towhs,",
						"          crd3c_company = cr5b1_dataarea,",
						"          crd3c_warehouse = cr5b1_fromwhs,",
						"          crd3c_name = crd3c_batchid,",
						"          hso_purchaseorder",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"ItemSize filter(((equals(ItemSize@INVENTLOCATIONID , upper($Store))  ||  equals(upper($Store) , \"ALL\")) || (equals(ItemSize@INVENTLOCATIONID , upper($Warehouse))  ||  equals(upper($Warehouse) , \"ALL\")))) ~> filter1",
						"union2 derive(crd3c_batchid = uuid()) ~> derivedColumn3",
						"derivedColumn2 filter(crd3c_toqty > 0) ~> filter2",
						"selectWarehouse filter(equals(crd3c_name,$Store) && equalsIgnoreCase(crd3c_dataarea,$Company)) ~> filteronStoreParameter",
						"selectSourceWarehouse filter(equals(source_crd3c_name,$Warehouse)) ~> filteronWarehouseParameter",
						"filteronStoreParameter, filteronWarehouseParameter join(equals(crd3c_name,$Store) && equals(source_crd3c_name,$Warehouse),",
						"     joinType:'cross',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join4",
						"join4 derive(crd3c_batchid = uuid()) ~> derivedColumn4",
						"derivedColumn4 select(mapColumn(",
						"          INVENTLOCATIONID = crd3c_name,",
						"          DATAAREAID = crd3c_dataarea,",
						"          INVENTSITEID = crd3c_site,",
						"          FromWhs = source_crd3c_name,",
						"          warehousename = crd3c_warehousename,",
						"          source_dataarea = source_crd3c_dataarea,",
						"          source_site = source_crd3c_site,",
						"          source_warehousename = source_crd3c_warehousename,",
						"          crd3c_batchid,",
						"          hso_ordertypesplitname,",
						"          hso_ordertypesplit,",
						"          source_icwarehouse = source_hso_sourceicwarehouse",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectWarehouseOnParameters",
						"join3 filter((equals(crd3c_dataarea , upper($Company)) || equals(upper($Company) , \"ALL\") ) ",
						"&& (equals(crd3c_name , upper($Store))  ||  equals(upper($Store) , \"ALL\")) ",
						"&& (equals(source_crd3c_name , upper($Warehouse))  ||  equals(upper($Warehouse) , \"ALL\"))) ~> filter3",
						"derivedColumn7, SelectWarehouseOnParameters union(byName: true)~> union1",
						"union1 aggregate(groupBy(INVENTLOCATIONID,",
						"          DATAAREAID,",
						"          FromWhs,",
						"          INVENTSITEID,",
						"          source_dataarea),",
						"     crd3c_batchid = max(crd3c_batchid)) ~> Warehouses",
						"select2 derive(crd3c_triggersource = $TriggerSource) ~> triggersource",
						"selectCols derive(crd3c_storeavailqtyzero = iif(crd3c_storeavailqty <0 ,crd3c_storeavailqty*0 ,crd3c_storeavailqty  )) ~> crd3cstoreavailqtyzero",
						"joinInventSumRecorderQty derive(AVAILPHYSICAL = coalesce(AVAILPHYSICAL,0),",
						"          ORDERED = coalesce(ORDERED,0)) ~> derivedColumn5",
						"DataImportExecutions select(mapColumn(",
						"          hso_purchaseorder",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectPOBoolean",
						"filter2 select(mapColumn(",
						"          hso_storeminquantity = crd3c_storeminqty,",
						"          hso_dataarea = cr5b1_dataarea,",
						"          hso_item = cr5b1_item,",
						"          hso_size = cr5b1_size,",
						"          hso_site = cr5b1_site,",
						"          hso_storequantity = crd3c_storeavailqty,",
						"          hso_itemvariant = cr5b1_itemvariant,",
						"          hso_storeminquantity = crd3c_storeminqty,",
						"          hso_itemdescription = cr5b1_itemdescription,",
						"          hso_store = cr5b1_towhs,",
						"          hso_sourceicwarehouse = cr5b1_fromwhs,",
						"          hso_fromwhsqty = crd3c_fromwhsstockqty,",
						"          hso_inboundorderqty = crd3c_inboundorderqty,",
						"          hso_batchid = crd3c_batchid,",
						"          hso_barcode,",
						"          hso_name = crd3c_name,",
						"          hso_orderquantity = crd3c_toqty,",
						"          hso_createddate = cr5b1_createddate,",
						"          hso_purchaseorderlinesid = crd3c_transferorderid,",
						"          hso_batchnumber,",
						"          hso_itemgroupid,",
						"          hso_fts",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select4",
						"filterWarehouse, selectSourceWarehouse join(hso_sourceicwarehouse == source_hso_sourceicwarehouse,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join5",
						"derivedColumn6 filter((equals(selectWarehouse@crd3c_dataarea , upper($Company)) || equals(upper($Company) , \"ALL\") ) ",
						"&& (equals(selectWarehouse@crd3c_name , upper($Store))  ||  equals(upper($Store) , \"ALL\")) ",
						"&& (equals(source_hso_sourceicwarehouse , upper($Warehouse))  ||  equals(upper($Warehouse) , \"ALL\"))) ~> filter4",
						"filter3, select5 union(byName: true)~> union2",
						"join5, UOWarehouse lookup(selectWarehouse@hso_sourceicwarehouse == UOWarehouse@crd3c_name,",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> lookup1",
						"lookup1 derive(source_crd3c_dataarea = UOWarehouse@crd3c_dataarea) ~> derivedColumn6",
						"filter4 select(mapColumn(",
						"          source_crd3c_dataarea,",
						"          source_hso_sourceicwarehouse,",
						"          crd3c_name = selectWarehouse@crd3c_name,",
						"          crd3c_dataarea = selectWarehouse@crd3c_dataarea",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select5",
						"selectWarehouseCombined derive(FromWhs = source_hso_sourceicwarehouse) ~> derivedColumn7",
						"InventItemGroupItem select(mapColumn(",
						"          itemid,",
						"          itemgroupid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectInvItemGrpCols",
						"join2, selectInvItemGrpCols lookup(lower(Item) == lower(selectInvItemGrpCols@itemid),",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> lookupInventItemGrp",
						"triggersource sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     store: 'dynamics',",
						"     format: 'dynamicsformat',",
						"     entity: 'crd3c_dataimportexecution',",
						"     timeout: 30,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     saveOrder: 0,",
						"     mapColumn(",
						"          crd3c_company,",
						"          crd3c_store,",
						"          crd3c_warehouse,",
						"          crd3c_name,",
						"          crd3c_triggersource,",
						"          hso_purchaseorder",
						"     ),",
						"     partitionBy('hash', 1)) ~> DataExecutionsTO",
						"select4 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delimited',",
						"     container: 'whsstockreplenish',",
						"     columnDelimiter: ';',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true,",
						"     partitionFileNames:[(concat($filename, '.csv'))],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     partitionBy('hash', 1)) ~> PurchaseOrdersSink"
					]
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/CreatePurchaseOrderLines_v1_0_0_Optimization')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "Including virtual/web stores",
				"folder": {
					"name": "OL/Create POs - Dual Purpose"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "inventSum_Sample",
								"type": "DatasetReference"
							},
							"name": "Inventsum"
						},
						{
							"dataset": {
								"referenceName": "EcoResProductSample",
								"type": "DatasetReference"
							},
							"name": "EcoResProduct"
						},
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "EcoResProductTranslation"
						},
						{
							"linkedService": {
								"referenceName": "powerappdataverse",
								"type": "LinkedServiceReference"
							},
							"name": "RecommendedOrderQty"
						},
						{
							"dataset": {
								"referenceName": "InventItemGroupSample",
								"type": "DatasetReference"
							},
							"name": "InventItemGroupItem"
						},
						{
							"linkedService": {
								"referenceName": "powerappdataverse",
								"type": "LinkedServiceReference"
							},
							"name": "UOWarehouse"
						},
						{
							"linkedService": {
								"referenceName": "powerappdataverse",
								"type": "LinkedServiceReference"
							},
							"name": "UOWarehousesTest"
						},
						{
							"linkedService": {
								"referenceName": "powerappdataverse",
								"type": "LinkedServiceReference"
							},
							"name": "UOWarehousesSource"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "powerappdataverse",
								"type": "LinkedServiceReference"
							},
							"name": "DataExecutionsTO"
						},
						{
							"linkedService": {
								"referenceName": "storageaccount",
								"type": "LinkedServiceReference"
							},
							"name": "PurchaseOrdersSink"
						}
					],
					"transformations": [
						{
							"name": "ItemSize"
						},
						{
							"name": "selectInventSum"
						},
						{
							"name": "joinInventSumRecorderQty"
						},
						{
							"name": "filterJoinInventSum",
							"description": "Filtering rows using expressions on columns 'AVAILPHYSICAL, ORDERED, MinOrderQty' + hso_FTS"
						},
						{
							"name": "selectEcoResProduct"
						},
						{
							"name": "filterEcoResProductTranslation"
						},
						{
							"name": "selectEcoResProductTranslation"
						},
						{
							"name": "join1"
						},
						{
							"name": "selectProductDescription"
						},
						{
							"name": "StockLessThanMinimum"
						},
						{
							"name": "joinWhs"
						},
						{
							"name": "join2"
						},
						{
							"name": "selectSTKWhs"
						},
						{
							"name": "selectCols"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "selectWarehouse"
						},
						{
							"name": "filterWarehouse"
						},
						{
							"name": "join3"
						},
						{
							"name": "selectSourceWarehouse"
						},
						{
							"name": "selectWarehouseCombined"
						},
						{
							"name": "selectMinOrderQty"
						},
						{
							"name": "filterMinOrderQty"
						},
						{
							"name": "WhsUpperDataArea"
						},
						{
							"name": "MinOrderUpperDataArea"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select2"
						},
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn3"
						},
						{
							"name": "filter2"
						},
						{
							"name": "filteronStoreParameter"
						},
						{
							"name": "filteronWarehouseParameter"
						},
						{
							"name": "join4"
						},
						{
							"name": "derivedColumn4"
						},
						{
							"name": "SelectWarehouseOnParameters"
						},
						{
							"name": "filter3"
						},
						{
							"name": "union1"
						},
						{
							"name": "Warehouses"
						},
						{
							"name": "triggersource"
						},
						{
							"name": "crd3cstoreavailqtyzero"
						},
						{
							"name": "derivedColumn5"
						},
						{
							"name": "select4"
						},
						{
							"name": "join5"
						},
						{
							"name": "filter4"
						},
						{
							"name": "union2"
						},
						{
							"name": "lookup1"
						},
						{
							"name": "derivedColumn6"
						},
						{
							"name": "select5"
						},
						{
							"name": "derivedColumn7"
						},
						{
							"name": "selectInvItemGrpCols"
						},
						{
							"name": "lookupInventItemGrp"
						},
						{
							"name": "select6"
						},
						{
							"name": "split1"
						},
						{
							"name": "SelectSourcingWH"
						},
						{
							"name": "BatchId"
						},
						{
							"name": "filter5"
						},
						{
							"name": "FullOuterJoinWithSourceWH"
						},
						{
							"name": "SelectStoreAndSourceStore"
						}
					],
					"scriptLines": [
						"parameters{",
						"     Company as string ('onuk'),",
						"     Store as string ('SOU-PF-STK'),",
						"     Warehouse as string ('LUX-KN-STK'),",
						"     filename as string ('Test'),",
						"     TriggerSource as string ('Manual'),",
						"     Container as string ('dataverse-ontest-unqccd0037834be4cec846b41a3ea290'),",
						"     OrderType as string ('Purchase Order'),",
						"     isDualPurposeStore as boolean (true()),",
						"     isItemGroupingEnabled as boolean (true())",
						"}",
						"source(output(",
						"          dataareaid as string,",
						"          itemid as string,",
						"          inventsiteid as string,",
						"          inventlocationid as string,",
						"          availphysical as integer,",
						"          ordered as integer,",
						"          inventsizeid as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     manifestType: 'manifest') ~> Inventsum",
						"source(output(",
						"          displayproductnumber as string,",
						"          searchname as string,",
						"          recid as string,",
						"          partition as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     manifestType: 'manifest') ~> EcoResProduct",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          sysdatastatecode as long,",
						"          description as string,",
						"          languageid as string,",
						"          name as string,",
						"          product as string,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/ecoresproducttranslation_partitioned',",
						"     manifestType: 'manifest') ~> EcoResProductTranslation",
						"source(output(",
						"          crd3c_availqty as integer,",
						"          crd3c_barcode as string,",
						"          crd3c_dataarea as string,",
						"          crd3c_itemvariant as string,",
						"          crd3c_itemvariantlookupname as string,",
						"          crd3c_name as string,",
						"          crd3c_orderqtiesid as string,",
						"          crd3c_quantity as integer,",
						"          crd3c_reqorderqty as integer,",
						"          crd3c_site as string,",
						"          crd3c_variantname as string,",
						"          crd3c_warehouselookupname as string,",
						"          createdbyname as string,",
						"          createdbyyominame as string,",
						"          createdon as timestamp,",
						"          createdonbehalfbyname as string,",
						"          createdonbehalfbyyominame as string,",
						"          hso_fts as integer,",
						"          hso_maxquantity as integer,",
						"          hso_minquantity as integer,",
						"          hso_size as string,",
						"          hso_teststring as string,",
						"          importsequencenumber as integer,",
						"          modifiedbyname as string,",
						"          modifiedbyyominame as string,",
						"          modifiedon as timestamp,",
						"          modifiedonbehalfbyname as string,",
						"          modifiedonbehalfbyyominame as string,",
						"          overriddencreatedon as timestamp,",
						"          owneridname as string,",
						"          owneridtype as string,",
						"          owneridyominame as string,",
						"          owningbusinessunitname as string,",
						"          statecode as integer,",
						"          statecodename as string,",
						"          statuscode as integer,",
						"          statuscodename as string,",
						"          timezoneruleversionnumber as integer,",
						"          utcconversiontimezonecode as integer,",
						"          versionnumber as long,",
						"          crd3c_warehouselookup as string,",
						"          createdonbehalfby as string,",
						"          owninguser as string,",
						"          modifiedby as string,",
						"          modifiedonbehalfby as string,",
						"          ownerid as string,",
						"          {@odata.etag} as string,",
						"          createdby as string,",
						"          owningbusinessunit as string,",
						"          crd3c_itemvariantlookup as string,",
						"          owningteam as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     store: 'dynamics',",
						"     format: 'dynamicsformat',",
						"     entity: 'crd3c_orderqties',",
						"     timeout: 30,",
						"     query: (concat('<fetch version=\"1.0\" output-format=\"xml-platform\" mapping=\"logical\" distinct=\"false\"><entity name=\"crd3c_orderqties\"><attribute name=\"crd3c_orderqtiesid\"/><attribute name=\"crd3c_dataarea\"/><attribute name=\"crd3c_site\"/><attribute name=\"crd3c_name\"/><attribute name=\"crd3c_itemvariant\"/><attribute name=\"crd3c_quantity\"/><attribute name=\"crd3c_barcode\"/><attribute name=\"createdon\"/><attribute name=\"hso_fts\"/><order attribute=\"crd3c_name\" descending=\"false\"/><filter type=\"and\"><condition attribute=\"crd3c_site\" operator=\"eq\" value=\"',$Store,'\"/><condition attribute=\"crd3c_dataarea\" operator=\"eq\" value=\"',$Company,'\"/></filter></entity></fetch>'))) ~> RecommendedOrderQty",
						"source(output(",
						"          itemid as string,",
						"          itemgroupid as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false) ~> InventItemGroupItem",
						"source(output(",
						"          crd3c_automatictocreation as boolean,",
						"          crd3c_automatictocreationname as string,",
						"          crd3c_dataarea as string,",
						"          crd3c_datastatus as integer,",
						"          crd3c_datastatusname as string,",
						"          crd3c_deliveryterms as string,",
						"          crd3c_modeofdelivery as string,",
						"          crd3c_name as string,",
						"          crd3c_refreshday as string,",
						"          crd3c_refreshdayname as string,",
						"          crd3c_refreshfrequency as integer,",
						"          crd3c_refreshtime as timestamp,",
						"          crd3c_site as string,",
						"          crd3c_sourcewhname as string,",
						"          crd3c_uowarehousesid as string,",
						"          crd3c_warehousename as string,",
						"          crd3c_warehousetype as string,",
						"          createdbyname as string,",
						"          createdbyyominame as string,",
						"          createdon as timestamp,",
						"          createdonbehalfbyname as string,",
						"          createdonbehalfbyyominame as string,",
						"          hso_automaticpocreation as boolean,",
						"          hso_automaticpocreationname as string,",
						"          hso_autoreservation as boolean,",
						"          hso_autoreservationname as string,",
						"          hso_companyicwarehouse as string,",
						"          hso_companylocalwarehouse as string,",
						"          hso_dualpurpose as boolean,",
						"          hso_dualpurposename as string,",
						"          hso_icwarehousename as string,",
						"          hso_itemgroup as boolean,",
						"          hso_itemgroupname as string,",
						"          hso_maxtoqty as integer,",
						"          hso_ordertypesplit as integer,",
						"          hso_ordertypesplitname as string,",
						"          hso_sourceicwarehouse as string,",
						"          hso_storeleadername as string,",
						"          hso_storeleaderyominame as string,",
						"          hso_vendorname as string,",
						"          importsequencenumber as integer,",
						"          modifiedbyname as string,",
						"          modifiedbyyominame as string,",
						"          modifiedon as timestamp,",
						"          modifiedonbehalfbyname as string,",
						"          modifiedonbehalfbyyominame as string,",
						"          overriddencreatedon as timestamp,",
						"          owneridname as string,",
						"          owneridtype as string,",
						"          owneridyominame as string,",
						"          owningbusinessunitname as string,",
						"          statecode as integer,",
						"          statecodename as string,",
						"          statuscode as integer,",
						"          statuscodename as string,",
						"          timezoneruleversionnumber as integer,",
						"          utcconversiontimezonecode as integer,",
						"          versionnumber as long,",
						"          createdonbehalfby as string,",
						"          hso_vendor as string,",
						"          hso_icwarehouse as string,",
						"          owninguser as string,",
						"          modifiedby as string,",
						"          hso_storeleader as string,",
						"          modifiedonbehalfby as string,",
						"          ownerid as string,",
						"          {@odata.etag} as string,",
						"          crd3c_sourcewh as string,",
						"          createdby as string,",
						"          owningbusinessunit as string,",
						"          owningteam as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     store: 'dynamics',",
						"     format: 'dynamicsformat',",
						"     entity: 'crd3c_uowarehouses',",
						"     timeout: 30) ~> UOWarehouse",
						"source(output(",
						"          crd3c_automatictocreation as boolean,",
						"          crd3c_automatictocreationname as string,",
						"          crd3c_dataarea as string,",
						"          crd3c_datastatus as integer,",
						"          crd3c_datastatusname as string,",
						"          crd3c_deliveryterms as string,",
						"          crd3c_modeofdelivery as string,",
						"          crd3c_name as string,",
						"          crd3c_refreshday as string,",
						"          crd3c_refreshdayname as string,",
						"          crd3c_refreshfrequency as integer,",
						"          crd3c_refreshtime as timestamp,",
						"          crd3c_site as string,",
						"          crd3c_sourcewhname as string,",
						"          crd3c_uowarehousesid as string,",
						"          crd3c_warehousename as string,",
						"          crd3c_warehousetype as string,",
						"          createdbyname as string,",
						"          createdbyyominame as string,",
						"          createdon as timestamp,",
						"          createdonbehalfbyname as string,",
						"          createdonbehalfbyyominame as string,",
						"          hso_automaticpocreation as boolean,",
						"          hso_automaticpocreationname as string,",
						"          hso_autoreservation as boolean,",
						"          hso_autoreservationname as string,",
						"          hso_companyicwarehouse as string,",
						"          hso_companylocalwarehouse as string,",
						"          hso_dualpurpose as boolean,",
						"          hso_dualpurposename as string,",
						"          hso_icwarehousename as string,",
						"          hso_itemgroup as boolean,",
						"          hso_itemgroupname as string,",
						"          hso_maxtoqty as integer,",
						"          hso_ordertypesplit as integer,",
						"          hso_ordertypesplitname as string,",
						"          hso_resetfts as boolean,",
						"          hso_resetftsname as string,",
						"          hso_sourceicwarehouse as string,",
						"          hso_storeleadername as string,",
						"          hso_storeleaderyominame as string,",
						"          hso_vendorname as string,",
						"          importsequencenumber as integer,",
						"          modifiedbyname as string,",
						"          modifiedbyyominame as string,",
						"          modifiedon as timestamp,",
						"          modifiedonbehalfbyname as string,",
						"          modifiedonbehalfbyyominame as string,",
						"          overriddencreatedon as timestamp,",
						"          owneridname as string,",
						"          owneridtype as string,",
						"          owneridyominame as string,",
						"          owningbusinessunitname as string,",
						"          statecode as integer,",
						"          statecodename as string,",
						"          statuscode as integer,",
						"          statuscodename as string,",
						"          timezoneruleversionnumber as integer,",
						"          utcconversiontimezonecode as integer,",
						"          versionnumber as long,",
						"          createdonbehalfby as string,",
						"          hso_vendor as string,",
						"          hso_icwarehouse as string,",
						"          owninguser as string,",
						"          modifiedby as string,",
						"          hso_storeleader as string,",
						"          modifiedonbehalfby as string,",
						"          ownerid as string,",
						"          {@odata.etag} as string,",
						"          crd3c_sourcewh as string,",
						"          createdby as string,",
						"          owningbusinessunit as string,",
						"          owningteam as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     store: 'dynamics',",
						"     format: 'dynamicsformat',",
						"     entity: 'crd3c_uowarehouses',",
						"     timeout: 30,",
						"     query: (concat('<fetch version=\"1.0\" mapping=\"logical\" distinct=\"true\" savedqueryid=\"41c7362d-ac5a-ed11-9562-000d3aba35c5\" no-lock=\"false\"><entity name=\"crd3c_uowarehouses\"><attribute name=\"crd3c_uowarehousesid\"/><attribute name=\"crd3c_name\"/><attribute name=\"crd3c_dataarea\"/><attribute name=\"hso_sourceicwarehouse\"/><attribute name=\"crd3c_site\"/><attribute name=\"crd3c_warehousename\"/><order attribute=\"hso_ordertypesplit\" descending=\"true\"/><order attribute=\"crd3c_warehousename\" descending=\"false\"/><filter type=\"and\"><condition attribute=\"statecode\" operator=\"eq\" value=\"0\"/><condition attribute=\"crd3c_name\" operator=\"eq\" value=\"',$Store,'\"/><condition attribute=\"crd3c_dataarea\" operator=\"eq\" value=\"',$Company,'\"/><condition attribute=\"hso_ordertypesplit\" operator=\"eq\" value=\"1\"/></filter></entity></fetch>'))) ~> UOWarehousesTest",
						"source(output(",
						"          crd3c_automatictocreation as boolean,",
						"          crd3c_automatictocreationname as string,",
						"          crd3c_dataarea as string,",
						"          crd3c_datastatus as integer,",
						"          crd3c_datastatusname as string,",
						"          crd3c_deliveryterms as string,",
						"          crd3c_modeofdelivery as string,",
						"          crd3c_name as string,",
						"          crd3c_refreshday as string,",
						"          crd3c_refreshdayname as string,",
						"          crd3c_refreshfrequency as integer,",
						"          crd3c_refreshtime as timestamp,",
						"          crd3c_site as string,",
						"          crd3c_sourcewhname as string,",
						"          crd3c_uowarehousesid as string,",
						"          crd3c_warehousename as string,",
						"          crd3c_warehousetype as string,",
						"          createdbyname as string,",
						"          createdbyyominame as string,",
						"          createdon as timestamp,",
						"          createdonbehalfbyname as string,",
						"          createdonbehalfbyyominame as string,",
						"          hso_automaticpocreation as boolean,",
						"          hso_automaticpocreationname as string,",
						"          hso_autoreservation as boolean,",
						"          hso_autoreservationname as string,",
						"          hso_companyicwarehouse as string,",
						"          hso_companylocalwarehouse as string,",
						"          hso_dualpurpose as boolean,",
						"          hso_dualpurposename as string,",
						"          hso_icwarehousename as string,",
						"          hso_itemgroup as boolean,",
						"          hso_itemgroupname as string,",
						"          hso_maxtoqty as integer,",
						"          hso_ordertypesplit as integer,",
						"          hso_ordertypesplitname as string,",
						"          hso_resetfts as boolean,",
						"          hso_resetftsname as string,",
						"          hso_sourceicwarehouse as string,",
						"          hso_storeleadername as string,",
						"          hso_storeleaderyominame as string,",
						"          hso_vendorname as string,",
						"          importsequencenumber as integer,",
						"          modifiedbyname as string,",
						"          modifiedbyyominame as string,",
						"          modifiedon as timestamp,",
						"          modifiedonbehalfbyname as string,",
						"          modifiedonbehalfbyyominame as string,",
						"          overriddencreatedon as timestamp,",
						"          owneridname as string,",
						"          owneridtype as string,",
						"          owneridyominame as string,",
						"          owningbusinessunitname as string,",
						"          statecode as integer,",
						"          statecodename as string,",
						"          statuscode as integer,",
						"          statuscodename as string,",
						"          timezoneruleversionnumber as integer,",
						"          utcconversiontimezonecode as integer,",
						"          versionnumber as long,",
						"          createdonbehalfby as string,",
						"          hso_vendor as string,",
						"          hso_icwarehouse as string,",
						"          owninguser as string,",
						"          modifiedby as string,",
						"          hso_storeleader as string,",
						"          modifiedonbehalfby as string,",
						"          ownerid as string,",
						"          {@odata.etag} as string,",
						"          crd3c_sourcewh as string,",
						"          createdby as string,",
						"          owningbusinessunit as string,",
						"          owningteam as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     store: 'dynamics',",
						"     format: 'dynamicsformat',",
						"     entity: 'crd3c_uowarehouses',",
						"     timeout: 30,",
						"     query: (concat('<fetch version=\"1.0\" mapping=\"logical\" distinct=\"true\" savedqueryid=\"41c7362d-ac5a-ed11-9562-000d3aba35c5\" no-lock=\"false\"><entity name=\"crd3c_uowarehouses\"><attribute name=\"statecode\"/><attribute name=\"crd3c_uowarehousesid\"/><attribute name=\"crd3c_name\"/><attribute name=\"crd3c_dataarea\"/><attribute name=\"crd3c_site\"/><attribute name=\"hso_sourceicwarehouse\"/><filter type=\"and\"><condition attribute=\"statecode\" operator=\"eq\" value=\"0\"/><filter type=\"or\"><condition attribute=\"crd3c_name\" operator=\"eq\" value=\"',$Store,'\"/><condition attribute=\"crd3c_name\" operator=\"eq\" value=\"',$Warehouse,'\"/></filter></filter></entity></fetch>'))) ~> UOWarehousesSource",
						"Inventsum derive(ItemSize = concat(itemid,coalesce( concat( '_',inventsizeid),'')),",
						"          DATAAREAID = upper(dataareaid),",
						"          INVENTLOCATIONID = upper(inventlocationid)) ~> ItemSize",
						"filter1 select(mapColumn(",
						"          DATAAREAID = ItemSize@DATAAREAID,",
						"          ITEMID = itemid,",
						"          INVENTSIZEID = inventsizeid,",
						"          INVENTLOCATIONID = ItemSize@INVENTLOCATIONID,",
						"          INVENTSITEID = inventsiteid,",
						"          AVAILPHYSICAL = availphysical,",
						"          ItemSize,",
						"          ORDERED = ordered",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectInventSum",
						"selectInventSum, filterMinOrderQty join(lower(DATAAREAID) == lower(dataarea)",
						"     && lower(ItemSize) == lower(itemvariant)",
						"     && lower(INVENTLOCATIONID) == lower(crd3c_site),",
						"     joinType:'right',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> joinInventSumRecorderQty",
						"derivedColumn5 filter(iif($isDualPurposeStore, coalesce(AVAILPHYSICAL,0), coalesce(AVAILPHYSICAL,0) + coalesce(ORDERED,0)) < MSL + FreeToSell) ~> filterJoinInventSum",
						"EcoResProduct select(mapColumn(",
						"          DISPLAYPRODUCTNUMBER = displayproductnumber,",
						"          SEARCHNAME = searchname,",
						"          RECID = recid,",
						"          PARTITION = partition",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectEcoResProduct",
						"EcoResProductTranslation filter(equals(languageid, 'en-US')) ~> filterEcoResProductTranslation",
						"filterEcoResProductTranslation select(mapColumn(",
						"          DESCRIPTION = description,",
						"          PRODUCT = product,",
						"          PARTITION = partition",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectEcoResProductTranslation",
						"selectEcoResProduct, selectEcoResProductTranslation join(RECID == PRODUCT,",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"join1 select(mapColumn(",
						"          ITEMID = DISPLAYPRODUCTNUMBER,",
						"          DESCRIPTION,",
						"          SEARCHNAME",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectProductDescription",
						"filterJoinInventSum, selectProductDescription join(lower(Item) == lower(selectProductDescription@ITEMID),",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> StockLessThanMinimum",
						"StockLessThanMinimum, SelectStoreAndSourceStore join(lower(crd3c_site) == lower(SelectStoreAndSourceStore@INVENTLOCATIONID),",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> joinWhs",
						"joinWhs, selectSTKWhs join(lower(itemvariant) == lower(STKItemSize)",
						"     && lower(SOURCEINVENTLOCATIONID) == lower(STKINVENTLOCATIONID),",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join2",
						"filter5 select(mapColumn(",
						"          STKDATAAREAID = DATAAREAID,",
						"          STKITEMID = ITEMID,",
						"          STKINVENTSIZEID = INVENTSIZEID,",
						"          STKINVENTLOCATIONID = INVENTLOCATIONID,",
						"          STKAVAILPHYSICAL = AVAILPHYSICAL,",
						"          STKItemSize = ItemSize",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectSTKWhs",
						"lookupInventItemGrp select(mapColumn(",
						"          crd3c_storeminqty = MSL,",
						"          cr5b1_dataarea = dataarea,",
						"          cr5b1_item = Item,",
						"          cr5b1_size = STKINVENTSIZEID,",
						"          cr5b1_site = SelectStoreAndSourceStore@INVENTSITEID,",
						"          crd3c_storeavailqty = AVAILPHYSICAL,",
						"          cr5b1_itemvariant = itemvariant,",
						"          cr5b1_itemdescription = DESCRIPTION,",
						"          cr5b1_towhs = SelectStoreAndSourceStore@INVENTLOCATIONID,",
						"          cr5b1_fromwhs = SOURCEINVENTLOCATIONID,",
						"          crd3c_fromwhsstockqty = STKAVAILPHYSICAL,",
						"          crd3c_inboundorderqty = ORDERED,",
						"          crd3c_batchid,",
						"          hso_barcode = crd3c_barcode,",
						"          hso_purchaseorder = SEARCHNAME,",
						"          hso_itemgroupid = itemgroupid,",
						"          hso_fts = FreeToSell",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectCols",
						"crd3cstoreavailqtyzero derive(crd3c_name = uuid(),",
						"          crd3c_toqty = iif($isDualPurposeStore,\r",
						"    iif((crd3c_storeminqty + hso_fts-crd3c_storeavailqtyzero) > crd3c_fromwhsstockqty, crd3c_fromwhsstockqty, (crd3c_storeminqty+hso_fts-crd3c_storeavailqtyzero)),\r",
						"    iif((crd3c_storeminqty + hso_fts-(crd3c_storeavailqtyzero +crd3c_inboundorderqty )) > crd3c_fromwhsstockqty, crd3c_fromwhsstockqty, (crd3c_storeminqty+hso_fts-(crd3c_storeavailqtyzero +crd3c_inboundorderqty )))\r",
						"),",
						"          cr5b1_createddate = currentTimestamp(),",
						"          crd3c_transferorderid = '00000000-0000-0000-0000-000000000000',",
						"          hso_purchaseorder = iif($OrderType == 'TRANSFER ORDER', false(), true()),",
						"          hso_batchnumber = 1,",
						"          hso_itemgroupid = iif($isItemGroupingEnabled, hso_itemgroupid, '00')) ~> derivedColumn2",
						"WhsUpperDataArea select(mapColumn(",
						"          crd3c_uowarehousesid,",
						"          crd3c_dataarea,",
						"          crd3c_site,",
						"          crd3c_warehousename,",
						"          crd3c_name,",
						"          crd3c_sourcewh,",
						"          hso_ordertypesplitname,",
						"          hso_ordertypesplit,",
						"          hso_sourceicwarehouse",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectWarehouse",
						"selectWarehouse filter(!isNull(hso_sourceicwarehouse) && !equals(hso_sourceicwarehouse, '')) ~> filterWarehouse",
						"filterWarehouse, selectSourceWarehouse join(crd3c_sourcewh == source_crd3c_uowarehousesid,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join3",
						"selectWarehouse select(mapColumn(",
						"          source_crd3c_uowarehousesid = crd3c_uowarehousesid,",
						"          source_crd3c_dataarea = crd3c_dataarea,",
						"          source_crd3c_site = crd3c_site,",
						"          source_crd3c_warehousename = crd3c_warehousename,",
						"          source_crd3c_name = crd3c_name,",
						"          source_crd3c_sourcewh = crd3c_sourcewh,",
						"          source_hso_sourceicwarehouse = hso_sourceicwarehouse",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectSourceWarehouse",
						"derivedColumn3 select(mapColumn(",
						"          INVENTLOCATIONID = crd3c_name,",
						"          DATAAREAID = crd3c_dataarea,",
						"          INVENTSITEID = crd3c_site,",
						"          FromWhs = source_crd3c_name,",
						"          warehousename = crd3c_warehousename,",
						"          source_dataarea = source_crd3c_dataarea,",
						"          source_site = source_crd3c_site,",
						"          source_warehousename = source_crd3c_warehousename,",
						"          crd3c_batchid,",
						"          hso_ordertypesplitname,",
						"          hso_ordertypesplit,",
						"          source_hso_sourceicwarehouse",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectWarehouseCombined",
						"RecommendedOrderQty select(mapColumn(",
						"          crd3c_name,",
						"          FreeToSell = hso_fts,",
						"          crd3c_site,",
						"          itemvariant = crd3c_itemvariant,",
						"          MSL = crd3c_quantity,",
						"          dataarea = crd3c_dataarea,",
						"          crd3c_barcode",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectMinOrderQty",
						"MinOrderUpperDataArea filter((MSL > 0 || FreeToSell > 0) && (equals(upper(dataarea) , upper($Company)) || equals(upper($Company) , \"ALL\") ) && (equals(crd3c_site , upper($Store))  ||  equals(upper($Store) , \"ALL\"))) ~> filterMinOrderQty",
						"UOWarehouse derive(crd3c_dataarea = upper(crd3c_dataarea),",
						"          crd3c_site = upper(crd3c_site),",
						"          crd3c_name = upper(crd3c_name)) ~> WhsUpperDataArea",
						"selectMinOrderQty derive(dataarea = upper(dataarea),",
						"          MSL = coalesce(MSL,0),",
						"          FreeToSell = coalesce(FreeToSell,0),",
						"          crd3c_site = upper(crd3c_site),",
						"          Item = substringIndex(crd3c_name, '_', 1)) ~> MinOrderUpperDataArea",
						"derivedColumn2 aggregate(groupBy(cr5b1_dataarea,",
						"          cr5b1_towhs,",
						"          cr5b1_fromwhs,",
						"          hso_purchaseorder,",
						"          crd3c_batchid),",
						"     each(match((name!=\"cr5b1_dataarea\")&&(name!=\"cr5b1_towhs\")&&(name!=\"cr5b1_fromwhs\")&&(name!=\"hso_purchaseorder\")&&(name!=\"crd3c_batchid\")), $$ = first($$))) ~> aggregate1",
						"aggregate1 select(mapColumn(",
						"          crd3c_store = cr5b1_towhs,",
						"          crd3c_company = cr5b1_dataarea,",
						"          crd3c_warehouse = cr5b1_fromwhs,",
						"          crd3c_name = crd3c_batchid,",
						"          hso_purchaseorder",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"ItemSize filter(((equals(ItemSize@INVENTLOCATIONID , upper($Store))  ||  equals(upper($Store) , \"ALL\")) || (equals(ItemSize@INVENTLOCATIONID , upper($Warehouse))  ||  equals(upper($Warehouse) , \"ALL\")))) ~> filter1",
						"union2 derive(crd3c_batchid = uuid()) ~> derivedColumn3",
						"derivedColumn2 filter(crd3c_toqty > 0) ~> filter2",
						"selectWarehouse filter(equals(crd3c_name,$Store) && equalsIgnoreCase(crd3c_dataarea,$Company)) ~> filteronStoreParameter",
						"selectSourceWarehouse filter(equals(source_crd3c_name,$Warehouse)) ~> filteronWarehouseParameter",
						"filteronStoreParameter, filteronWarehouseParameter join(equals(crd3c_name,$Store) && equals(source_crd3c_name,$Warehouse),",
						"     joinType:'cross',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join4",
						"join4 derive(crd3c_batchid = uuid()) ~> derivedColumn4",
						"derivedColumn4 select(mapColumn(",
						"          INVENTLOCATIONID = crd3c_name,",
						"          DATAAREAID = crd3c_dataarea,",
						"          INVENTSITEID = crd3c_site,",
						"          FromWhs = source_crd3c_name,",
						"          warehousename = crd3c_warehousename,",
						"          source_dataarea = source_crd3c_dataarea,",
						"          source_site = source_crd3c_site,",
						"          source_warehousename = source_crd3c_warehousename,",
						"          crd3c_batchid,",
						"          hso_ordertypesplitname,",
						"          hso_ordertypesplit,",
						"          source_icwarehouse = source_hso_sourceicwarehouse",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectWarehouseOnParameters",
						"join3 filter((equals(crd3c_dataarea , upper($Company)) || equals(upper($Company) , \"ALL\") ) ",
						"&& (equals(crd3c_name , upper($Store))  ||  equals(upper($Store) , \"ALL\")) ",
						"&& (equals(source_crd3c_name , upper($Warehouse))  ||  equals(upper($Warehouse) , \"ALL\"))) ~> filter3",
						"derivedColumn7, SelectWarehouseOnParameters union(byName: true)~> union1",
						"union1 aggregate(groupBy(INVENTLOCATIONID,",
						"          DATAAREAID,",
						"          FromWhs,",
						"          INVENTSITEID,",
						"          source_dataarea),",
						"     crd3c_batchid = max(crd3c_batchid)) ~> Warehouses",
						"select2 derive(crd3c_triggersource = $TriggerSource) ~> triggersource",
						"selectCols derive(crd3c_storeavailqtyzero = iif(crd3c_storeavailqty <0 ,crd3c_storeavailqty*0 ,crd3c_storeavailqty  )) ~> crd3cstoreavailqtyzero",
						"joinInventSumRecorderQty derive(AVAILPHYSICAL = coalesce(AVAILPHYSICAL,0),",
						"          ORDERED = coalesce(ORDERED,0)) ~> derivedColumn5",
						"filter2 select(mapColumn(",
						"          hso_storeminquantity = crd3c_storeminqty,",
						"          hso_dataarea = cr5b1_dataarea,",
						"          hso_item = cr5b1_item,",
						"          hso_size = cr5b1_size,",
						"          hso_site = cr5b1_site,",
						"          hso_storequantity = crd3c_storeavailqty,",
						"          hso_itemvariant = cr5b1_itemvariant,",
						"          hso_storeminquantity = crd3c_storeminqty,",
						"          hso_itemdescription = cr5b1_itemdescription,",
						"          hso_store = cr5b1_towhs,",
						"          hso_sourceicwarehouse = cr5b1_fromwhs,",
						"          hso_fromwhsqty = crd3c_fromwhsstockqty,",
						"          hso_inboundorderqty = crd3c_inboundorderqty,",
						"          hso_batchid = crd3c_batchid,",
						"          hso_barcode,",
						"          hso_name = crd3c_name,",
						"          hso_orderquantity = crd3c_toqty,",
						"          hso_createddate = cr5b1_createddate,",
						"          hso_purchaseorderlinesid = crd3c_transferorderid,",
						"          hso_batchnumber,",
						"          hso_itemgroupid,",
						"          hso_fts",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select4",
						"filterWarehouse, selectSourceWarehouse join(hso_sourceicwarehouse == source_hso_sourceicwarehouse,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join5",
						"derivedColumn6 filter((equals(selectWarehouse@crd3c_dataarea , upper($Company)) || equals(upper($Company) , \"ALL\") ) ",
						"&& (equals(selectWarehouse@crd3c_name , upper($Store))  ||  equals(upper($Store) , \"ALL\")) ",
						"&& (equals(source_hso_sourceicwarehouse , upper($Warehouse))  ||  equals(upper($Warehouse) , \"ALL\"))) ~> filter4",
						"filter3, select5 union(byName: true)~> union2",
						"join5, UOWarehouse lookup(selectWarehouse@hso_sourceicwarehouse == UOWarehouse@crd3c_name,",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> lookup1",
						"lookup1 derive(source_crd3c_dataarea = UOWarehouse@crd3c_dataarea) ~> derivedColumn6",
						"filter4 select(mapColumn(",
						"          source_crd3c_dataarea,",
						"          source_hso_sourceicwarehouse,",
						"          crd3c_name = selectWarehouse@crd3c_name,",
						"          crd3c_dataarea = selectWarehouse@crd3c_dataarea",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select5",
						"selectWarehouseCombined derive(FromWhs = source_hso_sourceicwarehouse) ~> derivedColumn7",
						"InventItemGroupItem select(mapColumn(",
						"          itemid,",
						"          itemgroupid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectInvItemGrpCols",
						"join2, selectInvItemGrpCols lookup(lower(Item) == lower(selectInvItemGrpCols@itemid),",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> lookupInventItemGrp",
						"UOWarehousesSource select(mapColumn(",
						"          DATAAREAID = crd3c_dataarea,",
						"          INVENTLOCATIONID = crd3c_name,",
						"          INVENTSITEID = crd3c_site,",
						"          hso_sourceicwarehouse",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select6",
						"select6 split(DATAAREAID == $Company && $Store == INVENTLOCATIONID,",
						"     disjoint: false) ~> split1@(Store, SourcingWarehouse)",
						"split1@SourcingWarehouse select(mapColumn(",
						"          SOURCEDATAAREAID = DATAAREAID,",
						"          SOURCEINVENTLOCATIONID = INVENTLOCATIONID",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectSourcingWH",
						"FullOuterJoinWithSourceWH derive(crd3c_batchid = uuid()) ~> BatchId",
						"selectInventSum filter(ItemSize == '3ME10140264_7') ~> filter5",
						"split1@Store, SelectSourcingWH join(hso_sourceicwarehouse == SOURCEINVENTLOCATIONID,",
						"     joinType:'outer',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> FullOuterJoinWithSourceWH",
						"BatchId select(mapColumn(",
						"          DATAAREAID,",
						"          INVENTLOCATIONID,",
						"          INVENTSITEID,",
						"          SOURCEDATAAREAID,",
						"          SOURCEINVENTLOCATIONID,",
						"          crd3c_batchid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectStoreAndSourceStore",
						"triggersource sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     store: 'dynamics',",
						"     format: 'dynamicsformat',",
						"     entity: 'crd3c_dataimportexecution',",
						"     timeout: 30,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     saveOrder: 0,",
						"     mapColumn(",
						"          crd3c_company,",
						"          crd3c_store,",
						"          crd3c_warehouse,",
						"          crd3c_name,",
						"          crd3c_triggersource,",
						"          hso_purchaseorder",
						"     ),",
						"     partitionBy('hash', 1)) ~> DataExecutionsTO",
						"select4 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delimited',",
						"     container: 'whsstockreplenish',",
						"     columnDelimiter: ';',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true,",
						"     partitionFileNames:[(concat($filename, '.csv'))],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     partitionBy('hash', 1)) ~> PurchaseOrdersSink"
					]
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/CreatePurchaseOrderLines_v1_0_0_copy1')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "Including virtual/web stores",
				"folder": {
					"name": "OL/Create POs - Dual Purpose"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "Inventsum"
						},
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "EcoResProduct"
						},
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "EcoResProductTranslation"
						},
						{
							"linkedService": {
								"referenceName": "powerappdataverse",
								"type": "LinkedServiceReference"
							},
							"name": "RecommendedOrderQty"
						},
						{
							"dataset": {
								"referenceName": "DataImportExecution",
								"type": "DatasetReference"
							},
							"name": "DataImportExecutions"
						},
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "InventItemGroupItem"
						},
						{
							"linkedService": {
								"referenceName": "powerappdataverse",
								"type": "LinkedServiceReference"
							},
							"name": "UOWarehouse"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "powerappdataverse",
								"type": "LinkedServiceReference"
							},
							"name": "DataExecutionsTO"
						},
						{
							"linkedService": {
								"referenceName": "storageaccount",
								"type": "LinkedServiceReference"
							},
							"name": "PurchaseOrdersSink"
						}
					],
					"transformations": [
						{
							"name": "ItemSize"
						},
						{
							"name": "selectInventSum"
						},
						{
							"name": "joinInventSumRecorderQty"
						},
						{
							"name": "filterJoinInventSum",
							"description": "Filtering rows using expressions on columns 'AVAILPHYSICAL, ORDERED, MinOrderQty' + hso_FTS"
						},
						{
							"name": "selectEcoResProduct"
						},
						{
							"name": "filterEcoResProductTranslation"
						},
						{
							"name": "selectEcoResProductTranslation"
						},
						{
							"name": "join1"
						},
						{
							"name": "selectProductDescription"
						},
						{
							"name": "StockLessThanMinimum"
						},
						{
							"name": "joinWhs"
						},
						{
							"name": "join2"
						},
						{
							"name": "selectSTKWhs"
						},
						{
							"name": "selectCols"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "selectWarehouse"
						},
						{
							"name": "filterWarehouse"
						},
						{
							"name": "join3"
						},
						{
							"name": "selectSourceWarehouse"
						},
						{
							"name": "selectWarehouseCombined"
						},
						{
							"name": "selectMinOrderQty"
						},
						{
							"name": "filterMinOrderQty"
						},
						{
							"name": "WhsUpperDataArea"
						},
						{
							"name": "MinOrderUpperDataArea"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select2"
						},
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn3"
						},
						{
							"name": "filter2"
						},
						{
							"name": "filteronStoreParameter"
						},
						{
							"name": "filteronWarehouseParameter"
						},
						{
							"name": "join4"
						},
						{
							"name": "derivedColumn4"
						},
						{
							"name": "SelectWarehouseOnParameters"
						},
						{
							"name": "filter3"
						},
						{
							"name": "union1"
						},
						{
							"name": "Warehouses"
						},
						{
							"name": "triggersource"
						},
						{
							"name": "crd3cstoreavailqtyzero"
						},
						{
							"name": "derivedColumn5"
						},
						{
							"name": "selectPOBoolean"
						},
						{
							"name": "select4"
						},
						{
							"name": "join5"
						},
						{
							"name": "filter4"
						},
						{
							"name": "union2"
						},
						{
							"name": "lookup1"
						},
						{
							"name": "derivedColumn6"
						},
						{
							"name": "select5"
						},
						{
							"name": "derivedColumn7"
						},
						{
							"name": "selectInvItemGrpCols"
						},
						{
							"name": "lookupInventItemGrp"
						}
					],
					"scriptLines": [
						"parameters{",
						"     Company as string,",
						"     Store as string,",
						"     Warehouse as string,",
						"     filename as string,",
						"     TriggerSource as string,",
						"     Container as string,",
						"     OrderType as string,",
						"     isDualPurposeStore as boolean,",
						"     isItemGroupingEnabled as boolean",
						"}",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          closed as long,",
						"          closedqty as long,",
						"          isexcludedfrominventoryvalue as long,",
						"          sysdatastatecode as long,",
						"          arrived as decimal(38,6),",
						"          availordered as decimal(38,6),",
						"          availphysical as decimal(38,6),",
						"          deducted as decimal(38,6),",
						"          inventdimid as string,",
						"          itemid as string,",
						"          lastupddateexpected as timestamp,",
						"          lastupddatephysical as timestamp,",
						"          onorder as decimal(38,6),",
						"          ordered as decimal(38,6),",
						"          pdscwarrived as decimal(38,6),",
						"          pdscwavailordered as decimal(38,6),",
						"          pdscwavailphysical as decimal(38,6),",
						"          pdscwdeducted as decimal(38,6),",
						"          pdscwonorder as decimal(38,6),",
						"          pdscwordered as decimal(38,6),",
						"          pdscwphysicalinvent as decimal(38,6),",
						"          pdscwpicked as decimal(38,6),",
						"          pdscwpostedqty as decimal(38,6),",
						"          pdscwquotationissue as decimal(38,6),",
						"          pdscwquotationreceipt as decimal(38,6),",
						"          pdscwreceived as decimal(38,6),",
						"          pdscwregistered as decimal(38,6),",
						"          pdscwreservordered as decimal(38,6),",
						"          pdscwreservphysical as decimal(38,6),",
						"          physicalinvent as decimal(38,6),",
						"          physicalvalue as decimal(38,6),",
						"          physicalvalueseccur_ru as decimal(38,6),",
						"          picked as decimal(38,6),",
						"          postedqty as decimal(38,6),",
						"          postedvalue as decimal(38,6),",
						"          postedvalueseccur_ru as decimal(38,6),",
						"          quotationissue as decimal(38,6),",
						"          quotationreceipt as decimal(38,6),",
						"          received as decimal(38,6),",
						"          registered as decimal(38,6),",
						"          reservordered as decimal(38,6),",
						"          reservphysical as decimal(38,6),",
						"          configid as string,",
						"          inventbatchid as string,",
						"          inventcolorid as string,",
						"          inventgtdid_ru as string,",
						"          inventlocationid as string,",
						"          inventownerid_ru as string,",
						"          inventprofileid_ru as string,",
						"          inventserialid as string,",
						"          inventsiteid as string,",
						"          inventsizeid as string,",
						"          inventstatusid as string,",
						"          inventstyleid as string,",
						"          inventversionid as string,",
						"          licenseplateid as string,",
						"          wmslocationid as string,",
						"          wmspalletid as string,",
						"          inventdimension1 as string,",
						"          inventdimension2 as string,",
						"          inventdimension3 as string,",
						"          inventdimension4 as string,",
						"          inventdimension5 as string,",
						"          inventdimension6 as string,",
						"          inventdimension7 as string,",
						"          inventdimension8 as string,",
						"          inventdimension9 as timestamp,",
						"          inventdimension10 as decimal(38,6),",
						"          inventdimension11 as string,",
						"          inventdimension12 as string,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/inventsum_partitioned',",
						"     manifestType: 'manifest') ~> Inventsum",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          pdscwproduct as long,",
						"          producttype as long,",
						"          servicetype as long,",
						"          sunplmsyncwithplm as long,",
						"          sysdatastatecode as long,",
						"          displayproductnumber as string,",
						"          instancerelationtype as long,",
						"          searchname as string,",
						"          engchgproductownerid as string,",
						"          engchgproductcategorydetails as long,",
						"          engchgproductreleasepolicy as long,",
						"          engchgproductreadinesspolicy as long,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/ecoresproduct_partitioned',",
						"     manifestType: 'manifest') ~> EcoResProduct",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          sysdatastatecode as long,",
						"          description as string,",
						"          languageid as string,",
						"          name as string,",
						"          product as long,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/ecoresproducttranslation_partitioned',",
						"     manifestType: 'manifest') ~> EcoResProductTranslation",
						"source(output(",
						"          crd3c_availqty as integer,",
						"          crd3c_barcode as string,",
						"          crd3c_dataarea as string,",
						"          crd3c_itemvariant as string,",
						"          crd3c_itemvariantlookupname as string,",
						"          crd3c_name as string,",
						"          crd3c_orderqtiesid as string,",
						"          crd3c_quantity as integer,",
						"          crd3c_reqorderqty as integer,",
						"          crd3c_site as string,",
						"          crd3c_variantname as string,",
						"          crd3c_warehouselookupname as string,",
						"          createdbyname as string,",
						"          createdbyyominame as string,",
						"          createdon as timestamp,",
						"          createdonbehalfbyname as string,",
						"          createdonbehalfbyyominame as string,",
						"          hso_fts as integer,",
						"          hso_maxquantity as integer,",
						"          hso_minquantity as integer,",
						"          hso_size as string,",
						"          hso_teststring as string,",
						"          importsequencenumber as integer,",
						"          modifiedbyname as string,",
						"          modifiedbyyominame as string,",
						"          modifiedon as timestamp,",
						"          modifiedonbehalfbyname as string,",
						"          modifiedonbehalfbyyominame as string,",
						"          overriddencreatedon as timestamp,",
						"          owneridname as string,",
						"          owneridtype as string,",
						"          owneridyominame as string,",
						"          owningbusinessunitname as string,",
						"          statecode as integer,",
						"          statecodename as string,",
						"          statuscode as integer,",
						"          statuscodename as string,",
						"          timezoneruleversionnumber as integer,",
						"          utcconversiontimezonecode as integer,",
						"          versionnumber as long,",
						"          crd3c_warehouselookup as string,",
						"          createdonbehalfby as string,",
						"          owninguser as string,",
						"          modifiedby as string,",
						"          modifiedonbehalfby as string,",
						"          ownerid as string,",
						"          {@odata.etag} as string,",
						"          createdby as string,",
						"          owningbusinessunit as string,",
						"          crd3c_itemvariantlookup as string,",
						"          owningteam as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     store: 'dynamics',",
						"     format: 'dynamicsformat',",
						"     entity: 'crd3c_orderqties',",
						"     timeout: 30,",
						"     query: (concat('<fetch version=\"1.0\" output-format=\"xml-platform\" mapping=\"logical\" distinct=\"false\"><entity name=\"crd3c_orderqties\"><attribute name=\"crd3c_orderqtiesid\"/><attribute name=\"crd3c_dataarea\"/><attribute name=\"crd3c_site\"/><attribute name=\"crd3c_name\"/><attribute name=\"crd3c_itemvariant\"/><attribute name=\"crd3c_quantity\"/><attribute name=\"crd3c_barcode\"/><attribute name=\"createdon\"/><attribute name=\"hso_fts\"/><order attribute=\"crd3c_name\" descending=\"false\"/><filter type=\"and\"><condition attribute=\"crd3c_site\" operator=\"eq\" value=\"',$Store,'\"/></filter></entity></fetch>'))) ~> RecommendedOrderQty",
						"source(output(",
						"          crd3c_company as string,",
						"          crd3c_dataimportexecutionid as string,",
						"          crd3c_name as string,",
						"          crd3c_store as string,",
						"          crd3c_triggersource as string,",
						"          crd3c_warehouse as string,",
						"          createdbyname as string,",
						"          createdbyyominame as string,",
						"          createdon as timestamp,",
						"          createdonbehalfbyname as string,",
						"          createdonbehalfbyyominame as string,",
						"          hso_companywarehouse as string,",
						"          hso_purchaseorder as boolean,",
						"          hso_purchaseordername as string,",
						"          importsequencenumber as integer,",
						"          modifiedbyname as string,",
						"          modifiedbyyominame as string,",
						"          modifiedon as timestamp,",
						"          modifiedonbehalfbyname as string,",
						"          modifiedonbehalfbyyominame as string,",
						"          overriddencreatedon as timestamp,",
						"          owneridname as string,",
						"          owneridtype as string,",
						"          owneridyominame as string,",
						"          owningbusinessunitname as string,",
						"          statecode as integer,",
						"          statecodename as string,",
						"          statuscode as integer,",
						"          statuscodename as string,",
						"          timezoneruleversionnumber as integer,",
						"          utcconversiontimezonecode as integer,",
						"          versionnumber as long,",
						"          createdonbehalfby as string,",
						"          owninguser as string,",
						"          modifiedby as string,",
						"          modifiedonbehalfby as string,",
						"          ownerid as string,",
						"          {@odata.etag} as string,",
						"          createdby as string,",
						"          owningbusinessunit as string,",
						"          owningteam as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false) ~> DataImportExecutions",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          sysdatastatecode as long,",
						"          itemdataareaid as string,",
						"          itemgroupdataareaid as string,",
						"          itemgroupid as string,",
						"          itemid as string,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/inventitemgroupitem_partitioned') ~> InventItemGroupItem",
						"source(output(",
						"          crd3c_automatictocreation as boolean,",
						"          crd3c_automatictocreationname as string,",
						"          crd3c_dataarea as string,",
						"          crd3c_datastatus as integer,",
						"          crd3c_datastatusname as string,",
						"          crd3c_deliveryterms as string,",
						"          crd3c_modeofdelivery as string,",
						"          crd3c_name as string,",
						"          crd3c_refreshday as string,",
						"          crd3c_refreshdayname as string,",
						"          crd3c_refreshfrequency as integer,",
						"          crd3c_refreshtime as timestamp,",
						"          crd3c_site as string,",
						"          crd3c_sourcewhname as string,",
						"          crd3c_uowarehousesid as string,",
						"          crd3c_warehousename as string,",
						"          crd3c_warehousetype as string,",
						"          createdbyname as string,",
						"          createdbyyominame as string,",
						"          createdon as timestamp,",
						"          createdonbehalfbyname as string,",
						"          createdonbehalfbyyominame as string,",
						"          hso_automaticpocreation as boolean,",
						"          hso_automaticpocreationname as string,",
						"          hso_autoreservation as boolean,",
						"          hso_autoreservationname as string,",
						"          hso_companyicwarehouse as string,",
						"          hso_companylocalwarehouse as string,",
						"          hso_dualpurpose as boolean,",
						"          hso_dualpurposename as string,",
						"          hso_icwarehousename as string,",
						"          hso_itemgroup as boolean,",
						"          hso_itemgroupname as string,",
						"          hso_maxtoqty as integer,",
						"          hso_ordertypesplit as integer,",
						"          hso_ordertypesplitname as string,",
						"          hso_sourceicwarehouse as string,",
						"          hso_storeleadername as string,",
						"          hso_storeleaderyominame as string,",
						"          hso_vendorname as string,",
						"          importsequencenumber as integer,",
						"          modifiedbyname as string,",
						"          modifiedbyyominame as string,",
						"          modifiedon as timestamp,",
						"          modifiedonbehalfbyname as string,",
						"          modifiedonbehalfbyyominame as string,",
						"          overriddencreatedon as timestamp,",
						"          owneridname as string,",
						"          owneridtype as string,",
						"          owneridyominame as string,",
						"          owningbusinessunitname as string,",
						"          statecode as integer,",
						"          statecodename as string,",
						"          statuscode as integer,",
						"          statuscodename as string,",
						"          timezoneruleversionnumber as integer,",
						"          utcconversiontimezonecode as integer,",
						"          versionnumber as long,",
						"          createdonbehalfby as string,",
						"          hso_vendor as string,",
						"          hso_icwarehouse as string,",
						"          owninguser as string,",
						"          modifiedby as string,",
						"          hso_storeleader as string,",
						"          modifiedonbehalfby as string,",
						"          ownerid as string,",
						"          {@odata.etag} as string,",
						"          crd3c_sourcewh as string,",
						"          createdby as string,",
						"          owningbusinessunit as string,",
						"          owningteam as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     store: 'dynamics',",
						"     format: 'dynamicsformat',",
						"     entity: 'crd3c_uowarehouses',",
						"     timeout: 30) ~> UOWarehouse",
						"Inventsum derive(ItemSize = concat(itemid,coalesce( concat( '_',inventsizeid),'')),",
						"          DATAAREAID = upper(dataareaid),",
						"          INVENTLOCATIONID = upper(inventlocationid)) ~> ItemSize",
						"filter1 select(mapColumn(",
						"          DATAAREAID = ItemSize@DATAAREAID,",
						"          ITEMID = itemid,",
						"          INVENTSIZEID = inventsizeid,",
						"          INVENTLOCATIONID = ItemSize@INVENTLOCATIONID,",
						"          INVENTSITEID = inventsiteid,",
						"          AVAILPHYSICAL = availphysical,",
						"          ItemSize,",
						"          ORDERED = ordered",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectInventSum",
						"selectInventSum, filterMinOrderQty join(lower(DATAAREAID) == lower(dataarea)",
						"     && lower(ItemSize) == lower(itemvariant)",
						"     && lower(INVENTLOCATIONID) == lower(crd3c_site),",
						"     joinType:'right',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> joinInventSumRecorderQty",
						"derivedColumn5 filter(iif($isDualPurposeStore, coalesce(AVAILPHYSICAL,0), coalesce(AVAILPHYSICAL,0) + coalesce(ORDERED,0)) < MinOrderQty) ~> filterJoinInventSum",
						"EcoResProduct select(mapColumn(",
						"          DISPLAYPRODUCTNUMBER = displayproductnumber,",
						"          SEARCHNAME = searchname,",
						"          RECID = recid,",
						"          PARTITION = partition",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectEcoResProduct",
						"EcoResProductTranslation filter(equals(languageid, 'en-US')) ~> filterEcoResProductTranslation",
						"filterEcoResProductTranslation select(mapColumn(",
						"          DESCRIPTION = description,",
						"          PRODUCT = product,",
						"          PARTITION = partition",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectEcoResProductTranslation",
						"selectEcoResProduct, selectEcoResProductTranslation join(RECID == PRODUCT,",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"join1 select(mapColumn(",
						"          ITEMID = DISPLAYPRODUCTNUMBER,",
						"          DESCRIPTION,",
						"          SEARCHNAME",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectProductDescription",
						"filterJoinInventSum, selectProductDescription join(lower(Item) == lower(selectProductDescription@ITEMID),",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> StockLessThanMinimum",
						"StockLessThanMinimum, Warehouses join(lower(crd3c_site) == lower(Warehouses@INVENTLOCATIONID),",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> joinWhs",
						"joinWhs, selectSTKWhs join(lower(itemvariant) == lower(STKItemSize)",
						"     && lower(FromWhs) == lower(STKINVENTLOCATIONID)",
						"     && source_dataarea == STKDATAAREAID,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join2",
						"selectInventSum select(mapColumn(",
						"          STKDATAAREAID = DATAAREAID,",
						"          STKITEMID = ITEMID,",
						"          STKINVENTSIZEID = INVENTSIZEID,",
						"          STKINVENTLOCATIONID = INVENTLOCATIONID,",
						"          STKAVAILPHYSICAL = AVAILPHYSICAL,",
						"          STKItemSize = ItemSize",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectSTKWhs",
						"lookupInventItemGrp select(mapColumn(",
						"          crd3c_storeminqty = MinOrderQty,",
						"          cr5b1_dataarea = dataarea,",
						"          cr5b1_item = Item,",
						"          cr5b1_size = STKINVENTSIZEID,",
						"          cr5b1_site = Warehouses@INVENTSITEID,",
						"          crd3c_storeavailqty = AVAILPHYSICAL,",
						"          cr5b1_itemvariant = itemvariant,",
						"          cr5b1_itemdescription = DESCRIPTION,",
						"          cr5b1_towhs = Warehouses@INVENTLOCATIONID,",
						"          cr5b1_fromwhs = FromWhs,",
						"          crd3c_fromwhsstockqty = STKAVAILPHYSICAL,",
						"          crd3c_inboundorderqty = ORDERED,",
						"          crd3c_batchid,",
						"          hso_barcode = crd3c_barcode,",
						"          hso_purchaseorder = SEARCHNAME,",
						"          hso_itemgroupid = itemgroupid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectCols",
						"crd3cstoreavailqtyzero derive(crd3c_name = uuid(),",
						"          crd3c_toqty = iif($isDualPurposeStore,\r",
						"    iif((crd3c_storeminqty-(crd3c_storeavailqtyzero +crd3c_inboundorderqty )) > crd3c_fromwhsstockqty, crd3c_fromwhsstockqty, (crd3c_storeminqty-(crd3c_storeavailqtyzero +crd3c_inboundorderqty ))),\r",
						"    iif((crd3c_storeminqty-crd3c_storeavailqtyzero) > crd3c_fromwhsstockqty, crd3c_fromwhsstockqty, (crd3c_storeminqty-crd3c_storeavailqtyzero))\r",
						"),",
						"          cr5b1_createddate = currentTimestamp(),",
						"          crd3c_transferorderid = '00000000-0000-0000-0000-000000000000',",
						"          hso_purchaseorder = iif($OrderType == 'TRANSFER ORDER', false(), true()),",
						"          hso_batchnumber = 1,",
						"          hso_itemgroupid = iif($isItemGroupingEnabled, hso_itemgroupid, '00')) ~> derivedColumn2",
						"WhsUpperDataArea select(mapColumn(",
						"          crd3c_uowarehousesid,",
						"          crd3c_dataarea,",
						"          crd3c_site,",
						"          crd3c_warehousename,",
						"          crd3c_name,",
						"          crd3c_sourcewh,",
						"          hso_ordertypesplitname,",
						"          hso_ordertypesplit,",
						"          hso_sourceicwarehouse",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectWarehouse",
						"selectWarehouse filter(!isNull(hso_sourceicwarehouse) && !equals(hso_sourceicwarehouse, '')) ~> filterWarehouse",
						"filterWarehouse, selectSourceWarehouse join(crd3c_sourcewh == source_crd3c_uowarehousesid,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join3",
						"selectWarehouse select(mapColumn(",
						"          source_crd3c_uowarehousesid = crd3c_uowarehousesid,",
						"          source_crd3c_dataarea = crd3c_dataarea,",
						"          source_crd3c_site = crd3c_site,",
						"          source_crd3c_warehousename = crd3c_warehousename,",
						"          source_crd3c_name = crd3c_name,",
						"          source_crd3c_sourcewh = crd3c_sourcewh,",
						"          source_hso_sourceicwarehouse = hso_sourceicwarehouse",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectSourceWarehouse",
						"derivedColumn3 select(mapColumn(",
						"          INVENTLOCATIONID = crd3c_name,",
						"          DATAAREAID = crd3c_dataarea,",
						"          INVENTSITEID = crd3c_site,",
						"          FromWhs = source_crd3c_name,",
						"          warehousename = crd3c_warehousename,",
						"          source_dataarea = source_crd3c_dataarea,",
						"          source_site = source_crd3c_site,",
						"          source_warehousename = source_crd3c_warehousename,",
						"          crd3c_batchid,",
						"          hso_ordertypesplitname,",
						"          hso_ordertypesplit,",
						"          source_hso_sourceicwarehouse",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectWarehouseCombined",
						"RecommendedOrderQty select(mapColumn(",
						"          crd3c_name,",
						"          FreeToSell = hso_fts,",
						"          crd3c_site,",
						"          itemvariant = crd3c_itemvariant,",
						"          MSL = crd3c_quantity,",
						"          dataarea = crd3c_dataarea,",
						"          crd3c_barcode",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectMinOrderQty",
						"MinOrderUpperDataArea filter((MinOrderQty > 0) && (equals(upper(dataarea) , upper($Company)) || equals(upper($Company) , \"ALL\") ) && (equals(crd3c_site , upper($Store))  ||  equals(upper($Store) , \"ALL\"))) ~> filterMinOrderQty",
						"UOWarehouse derive(crd3c_dataarea = upper(crd3c_dataarea),",
						"          crd3c_site = upper(crd3c_site),",
						"          crd3c_name = upper(crd3c_name)) ~> WhsUpperDataArea",
						"selectMinOrderQty derive(MinOrderQty = iif($isDualPurposeStore, coalesce(MSL,0) + coalesce(FreeToSell,0), coalesce(MSL,0)),",
						"          dataarea = upper(dataarea),",
						"          crd3c_site = upper(crd3c_site),",
						"          Item = substringIndex(crd3c_name, '_', 1)) ~> MinOrderUpperDataArea",
						"derivedColumn2 aggregate(groupBy(cr5b1_dataarea,",
						"          cr5b1_towhs,",
						"          cr5b1_fromwhs,",
						"          hso_purchaseorder,",
						"          crd3c_batchid),",
						"     each(match((name!=\"cr5b1_dataarea\")&&(name!=\"cr5b1_towhs\")&&(name!=\"cr5b1_fromwhs\")&&(name!=\"hso_purchaseorder\")&&(name!=\"crd3c_batchid\")), $$ = first($$))) ~> aggregate1",
						"aggregate1 select(mapColumn(",
						"          crd3c_store = cr5b1_towhs,",
						"          crd3c_company = cr5b1_dataarea,",
						"          crd3c_warehouse = cr5b1_fromwhs,",
						"          crd3c_name = crd3c_batchid,",
						"          hso_purchaseorder",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"ItemSize filter(((equals(ItemSize@INVENTLOCATIONID , upper($Store))  ||  equals(upper($Store) , \"ALL\")) || (equals(ItemSize@INVENTLOCATIONID , upper($Warehouse))  ||  equals(upper($Warehouse) , \"ALL\")))) ~> filter1",
						"union2 derive(crd3c_batchid = uuid()) ~> derivedColumn3",
						"derivedColumn2 filter(crd3c_toqty > 0) ~> filter2",
						"selectWarehouse filter(equals(crd3c_name,$Store) && equalsIgnoreCase(crd3c_dataarea,$Company)) ~> filteronStoreParameter",
						"selectSourceWarehouse filter(equals(source_crd3c_name,$Warehouse)) ~> filteronWarehouseParameter",
						"filteronStoreParameter, filteronWarehouseParameter join(equals(crd3c_name,$Store) && equals(source_crd3c_name,$Warehouse),",
						"     joinType:'cross',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join4",
						"join4 derive(crd3c_batchid = uuid()) ~> derivedColumn4",
						"derivedColumn4 select(mapColumn(",
						"          INVENTLOCATIONID = crd3c_name,",
						"          DATAAREAID = crd3c_dataarea,",
						"          INVENTSITEID = crd3c_site,",
						"          FromWhs = source_crd3c_name,",
						"          warehousename = crd3c_warehousename,",
						"          source_dataarea = source_crd3c_dataarea,",
						"          source_site = source_crd3c_site,",
						"          source_warehousename = source_crd3c_warehousename,",
						"          crd3c_batchid,",
						"          hso_ordertypesplitname,",
						"          hso_ordertypesplit,",
						"          source_icwarehouse = source_hso_sourceicwarehouse",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectWarehouseOnParameters",
						"join3 filter((equals(crd3c_dataarea , upper($Company)) || equals(upper($Company) , \"ALL\") ) ",
						"&& (equals(crd3c_name , upper($Store))  ||  equals(upper($Store) , \"ALL\")) ",
						"&& (equals(source_crd3c_name , upper($Warehouse))  ||  equals(upper($Warehouse) , \"ALL\"))) ~> filter3",
						"derivedColumn7, SelectWarehouseOnParameters union(byName: true)~> union1",
						"union1 aggregate(groupBy(INVENTLOCATIONID,",
						"          DATAAREAID,",
						"          FromWhs,",
						"          INVENTSITEID,",
						"          source_dataarea),",
						"     crd3c_batchid = max(crd3c_batchid)) ~> Warehouses",
						"select2 derive(crd3c_triggersource = $TriggerSource) ~> triggersource",
						"selectCols derive(crd3c_storeavailqtyzero = iif(crd3c_storeavailqty <0 ,crd3c_storeavailqty*0 ,crd3c_storeavailqty  )) ~> crd3cstoreavailqtyzero",
						"joinInventSumRecorderQty derive(AVAILPHYSICAL = coalesce(AVAILPHYSICAL,0),",
						"          ORDERED = coalesce(ORDERED,0)) ~> derivedColumn5",
						"DataImportExecutions select(mapColumn(",
						"          hso_purchaseorder",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectPOBoolean",
						"filter2 select(mapColumn(",
						"          hso_storeminquantity = crd3c_storeminqty,",
						"          hso_dataarea = cr5b1_dataarea,",
						"          hso_item = cr5b1_item,",
						"          hso_size = cr5b1_size,",
						"          hso_site = cr5b1_site,",
						"          hso_storequantity = crd3c_storeavailqty,",
						"          hso_itemvariant = cr5b1_itemvariant,",
						"          hso_storeminquantity = crd3c_storeminqty,",
						"          hso_itemdescription = cr5b1_itemdescription,",
						"          hso_store = cr5b1_towhs,",
						"          hso_sourceicwarehouse = cr5b1_fromwhs,",
						"          hso_fromwhsqty = crd3c_fromwhsstockqty,",
						"          hso_inboundorderqty = crd3c_inboundorderqty,",
						"          hso_batchid = crd3c_batchid,",
						"          hso_barcode,",
						"          hso_name = crd3c_name,",
						"          hso_orderquantity = crd3c_toqty,",
						"          hso_createddate = cr5b1_createddate,",
						"          hso_purchaseorderlinesid = crd3c_transferorderid,",
						"          hso_batchnumber,",
						"          hso_itemgroupid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select4",
						"filterWarehouse, selectSourceWarehouse join(hso_sourceicwarehouse == source_hso_sourceicwarehouse,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join5",
						"derivedColumn6 filter((equals(selectWarehouse@crd3c_dataarea , upper($Company)) || equals(upper($Company) , \"ALL\") ) ",
						"&& (equals(selectWarehouse@crd3c_name , upper($Store))  ||  equals(upper($Store) , \"ALL\")) ",
						"&& (equals(source_hso_sourceicwarehouse , upper($Warehouse))  ||  equals(upper($Warehouse) , \"ALL\"))) ~> filter4",
						"filter3, select5 union(byName: true)~> union2",
						"join5, UOWarehouse lookup(selectWarehouse@hso_sourceicwarehouse == UOWarehouse@crd3c_name,",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> lookup1",
						"lookup1 derive(source_crd3c_dataarea = UOWarehouse@crd3c_dataarea) ~> derivedColumn6",
						"filter4 select(mapColumn(",
						"          source_crd3c_dataarea,",
						"          source_hso_sourceicwarehouse,",
						"          crd3c_name = selectWarehouse@crd3c_name,",
						"          crd3c_dataarea = selectWarehouse@crd3c_dataarea",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select5",
						"selectWarehouseCombined derive(FromWhs = source_hso_sourceicwarehouse) ~> derivedColumn7",
						"InventItemGroupItem select(mapColumn(",
						"          itemid,",
						"          itemgroupid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectInvItemGrpCols",
						"join2, selectInvItemGrpCols lookup(lower(Item) == lower(selectInvItemGrpCols@itemid),",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> lookupInventItemGrp",
						"triggersource sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     store: 'dynamics',",
						"     format: 'dynamicsformat',",
						"     entity: 'crd3c_dataimportexecution',",
						"     timeout: 30,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     saveOrder: 0,",
						"     mapColumn(",
						"          crd3c_company,",
						"          crd3c_store,",
						"          crd3c_warehouse,",
						"          crd3c_name,",
						"          crd3c_triggersource,",
						"          hso_purchaseorder",
						"     ),",
						"     partitionBy('hash', 1)) ~> DataExecutionsTO",
						"select4 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delimited',",
						"     container: 'whsstockreplenish',",
						"     folderPath: 'OL',",
						"     columnDelimiter: ';',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true,",
						"     partitionFileNames:[(concat($filename, '.csv'))],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     partitionBy('hash', 1)) ~> PurchaseOrdersSink"
					]
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/CreateRecOrderQtyCsv')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "UOWarehouses",
								"type": "DatasetReference"
							},
							"name": "UOWarehouses"
						},
						{
							"dataset": {
								"referenceName": "UOItem",
								"type": "DatasetReference"
							},
							"name": "UOItem"
						},
						{
							"dataset": {
								"referenceName": "LegalEntity",
								"type": "DatasetReference"
							},
							"name": "LegalEntity"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "RecomOrderQtyCsvFile",
								"type": "DatasetReference"
							},
							"name": "createCsv"
						}
					],
					"transformations": [
						{
							"name": "joinWhsItem"
						},
						{
							"name": "selectJoinWhsItem"
						},
						{
							"name": "selectWarehouses"
						},
						{
							"name": "filterWarehouse"
						},
						{
							"name": "deriveName"
						},
						{
							"name": "filterActiveLegalEntity"
						},
						{
							"name": "selectActiveLegalEntity"
						},
						{
							"name": "joinWarehouseLegalEntity"
						}
					],
					"scriptLines": [
						"source(output(",
						"          crd3c_automatictocreation as boolean,",
						"          crd3c_automatictocreationname as string,",
						"          crd3c_dataarea as string,",
						"          crd3c_datastatus as integer,",
						"          crd3c_datastatusname as string,",
						"          crd3c_deliveryterms as string,",
						"          crd3c_modeofdelivery as string,",
						"          crd3c_name as string,",
						"          crd3c_refreshday as string,",
						"          crd3c_refreshdayname as string,",
						"          crd3c_refreshfrequency as integer,",
						"          crd3c_refreshtime as timestamp,",
						"          crd3c_site as string,",
						"          crd3c_sourcewhname as string,",
						"          crd3c_uowarehousesid as string,",
						"          crd3c_warehousename as string,",
						"          crd3c_warehousetype as string,",
						"          createdbyname as string,",
						"          createdbyyominame as string,",
						"          createdon as timestamp,",
						"          createdonbehalfbyname as string,",
						"          createdonbehalfbyyominame as string,",
						"          hso_automaticpocreation as boolean,",
						"          hso_automaticpocreationname as string,",
						"          hso_companyicwarehouse as string,",
						"          hso_companylocalwarehouse as string,",
						"          hso_dualpurpose as boolean,",
						"          hso_dualpurposename as string,",
						"          hso_icwarehousename as string,",
						"          hso_maxtoqty as integer,",
						"          hso_ordertypesplit as integer,",
						"          hso_ordertypesplitname as string,",
						"          hso_sourceicwarehouse as string,",
						"          hso_storeleadername as string,",
						"          hso_storeleaderyominame as string,",
						"          hso_vendorname as string,",
						"          importsequencenumber as integer,",
						"          modifiedbyname as string,",
						"          modifiedbyyominame as string,",
						"          modifiedon as timestamp,",
						"          modifiedonbehalfbyname as string,",
						"          modifiedonbehalfbyyominame as string,",
						"          overriddencreatedon as timestamp,",
						"          owneridname as string,",
						"          owneridtype as string,",
						"          owneridyominame as string,",
						"          owningbusinessunitname as string,",
						"          statecode as integer,",
						"          statecodename as string,",
						"          statuscode as integer,",
						"          statuscodename as string,",
						"          timezoneruleversionnumber as integer,",
						"          utcconversiontimezonecode as integer,",
						"          versionnumber as long,",
						"          createdonbehalfby as string,",
						"          hso_vendor as string,",
						"          hso_icwarehouse as string,",
						"          owninguser as string,",
						"          modifiedby as string,",
						"          hso_storeleader as string,",
						"          modifiedonbehalfby as string,",
						"          ownerid as string,",
						"          {@odata.etag} as string,",
						"          crd3c_sourcewh as string,",
						"          createdby as string,",
						"          owningbusinessunit as string,",
						"          owningteam as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false) ~> UOWarehouses",
						"source(output(",
						"          crd3c_barcode as string,",
						"          crd3c_dataarea as string,",
						"          crd3c_datastatus as integer,",
						"          crd3c_datastatusname as string,",
						"          crd3c_gender as string,",
						"          crd3c_name as string,",
						"          crd3c_productnumber as string,",
						"          crd3c_simpleid as string,",
						"          crd3c_size as string,",
						"          crd3c_uoitemid as string,",
						"          crd3c_variantname as string,",
						"          createdbyname as string,",
						"          createdbyyominame as string,",
						"          createdon as timestamp,",
						"          createdonbehalfbyname as string,",
						"          createdonbehalfbyyominame as string,",
						"          importsequencenumber as integer,",
						"          modifiedbyname as string,",
						"          modifiedbyyominame as string,",
						"          modifiedon as timestamp,",
						"          modifiedonbehalfbyname as string,",
						"          modifiedonbehalfbyyominame as string,",
						"          overriddencreatedon as timestamp,",
						"          owneridname as string,",
						"          owneridtype as string,",
						"          owneridyominame as string,",
						"          owningbusinessunitname as string,",
						"          statecode as integer,",
						"          statecodename as string,",
						"          statuscode as integer,",
						"          statuscodename as string,",
						"          timezoneruleversionnumber as integer,",
						"          utcconversiontimezonecode as integer,",
						"          versionnumber as long,",
						"          createdonbehalfby as string,",
						"          owninguser as string,",
						"          modifiedby as string,",
						"          modifiedonbehalfby as string,",
						"          ownerid as string,",
						"          {@odata.etag} as string,",
						"          createdby as string,",
						"          owningbusinessunit as string,",
						"          owningteam as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     wildcardPaths:['UOItem.csv']) ~> UOItem",
						"source(output(",
						"          createdonbehalfbyyominame as string,",
						"          statecode as integer,",
						"          owneridname as string,",
						"          statecodename as string,",
						"          importsequencenumber as integer,",
						"          modifiedbyyominame as string,",
						"          crd3c_description as string,",
						"          crd3c_legalentitiesid as string,",
						"          utcconversiontimezonecode as integer,",
						"          createdbyyominame as string,",
						"          modifiedbyname as string,",
						"          versionnumber as long,",
						"          timezoneruleversionnumber as integer,",
						"          owneridtype as string,",
						"          statuscodename as string,",
						"          crd3c_legalentity as string,",
						"          owneridyominame as string,",
						"          modifiedon as timestamp,",
						"          modifiedonbehalfbyyominame as string,",
						"          statuscode as integer,",
						"          createdbyname as string,",
						"          createdon as timestamp,",
						"          owningbusinessunitname as string,",
						"          createdonbehalfbyname as string,",
						"          modifiedonbehalfbyname as string,",
						"          overriddencreatedon as timestamp,",
						"          createdonbehalfby as string,",
						"          owninguser as string,",
						"          modifiedby as string,",
						"          modifiedonbehalfby as string,",
						"          ownerid as string,",
						"          {@odata.etag} as string,",
						"          createdby as string,",
						"          owningbusinessunit as string,",
						"          owningteam as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false) ~> LegalEntity",
						"UOItem, selectWarehouses join(upper(UOItem@crd3c_dataarea) == upper(selectWarehouses@crd3c_dataarea),",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> joinWhsItem",
						"joinWhsItem select(mapColumn(",
						"          crd3c_itemvariant = crd3c_simpleid,",
						"          crd3c_barcode,",
						"          crd3c_variantname,",
						"          crd3c_itemvariantlookup = crd3c_uoitemid,",
						"          crd3c_dataarea = UOItem@crd3c_dataarea,",
						"          crd3c_site = selectWarehouses@crd3c_name,",
						"          crd3c_warehouselookup = crd3c_uowarehousesid,",
						"          hso_size = crd3c_size",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectJoinWhsItem",
						"joinWarehouseLegalEntity select(mapColumn(",
						"          crd3c_name,",
						"          crd3c_dataarea,",
						"          crd3c_warehousename,",
						"          crd3c_uowarehousesid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectWarehouses",
						"UOWarehouses filter(or(upper(crd3c_warehousetype) == 'STORE' && statecode == 0,  upper(crd3c_warehousetype) == \"STOCK\" && hso_dualpurpose)) ~> filterWarehouse",
						"selectJoinWhsItem derive(crd3c_name = concat(crd3c_itemvariant, \"_\",crd3c_site)) ~> deriveName",
						"LegalEntity filter(statecode == 0) ~> filterActiveLegalEntity",
						"filterActiveLegalEntity select(mapColumn(",
						"          crd3c_legalentity",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectActiveLegalEntity",
						"filterWarehouse, selectActiveLegalEntity join(upper(crd3c_dataarea) == upper(crd3c_legalentity),",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> joinWarehouseLegalEntity",
						"deriveName sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     input(",
						"          crd3c_name as string,",
						"          crd3c_variantname as string,",
						"          crd3c_barcode as string,",
						"          crd3c_productnumber as string,",
						"          crd3c_dataarea as string,",
						"          crd3c_size as string",
						"     ),",
						"     partitionFileNames:['RecOrderQty.csv'],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     partitionBy('hash', 1)) ~> createCsv"
					]
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/CreateRecOrderQtyCsv_VirtualStores')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"folder": {
					"name": "OL/MSL Sync"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "UOWarehouses",
								"type": "DatasetReference"
							},
							"name": "UOWarehouses"
						},
						{
							"dataset": {
								"referenceName": "UOItem",
								"type": "DatasetReference"
							},
							"name": "UOItem"
						},
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "Barcode"
						},
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "InventDim"
						},
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "ForecastSales"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "RecomOrderQtyCsvFile_virtualStore",
								"type": "DatasetReference"
							},
							"name": "MSLcreateCSV"
						}
					],
					"transformations": [
						{
							"name": "filterModelCustGroupChannel"
						},
						{
							"name": "SelectItemIdForecastQtyInventDimId"
						},
						{
							"name": "SelectInventDimIdAndBarcodeNum"
						},
						{
							"name": "GetBarcode"
						},
						{
							"name": "AddMSL"
						},
						{
							"name": "SelectInventSizeIdAndInventDimId"
						},
						{
							"name": "GetInventSizeId"
						},
						{
							"name": "FinalSelectBarcodeInventSizeId"
						},
						{
							"name": "FSGetInventSizeId"
						},
						{
							"name": "MSL"
						},
						{
							"name": "GetDualPurposeStores"
						},
						{
							"name": "SelectDualPurposeStores"
						},
						{
							"name": "DualPurposeStoresOnly"
						},
						{
							"name": "SelectStoreAndSize"
						},
						{
							"name": "CalculateMSL"
						},
						{
							"name": "joinMSL"
						},
						{
							"name": "SelectPreBarcode"
						}
					],
					"scriptLines": [
						"parameters{",
						"     Container as string",
						"}",
						"source(output(",
						"          crd3c_automatictocreation as boolean,",
						"          crd3c_automatictocreationname as string,",
						"          crd3c_dataarea as string,",
						"          crd3c_datastatus as integer,",
						"          crd3c_datastatusname as string,",
						"          crd3c_deliveryterms as string,",
						"          crd3c_modeofdelivery as string,",
						"          crd3c_name as string,",
						"          crd3c_refreshday as string,",
						"          crd3c_refreshdayname as string,",
						"          crd3c_refreshfrequency as integer,",
						"          crd3c_refreshtime as timestamp,",
						"          crd3c_site as string,",
						"          crd3c_sourcewhname as string,",
						"          crd3c_uowarehousesid as string,",
						"          crd3c_warehousename as string,",
						"          crd3c_warehousetype as string,",
						"          createdbyname as string,",
						"          createdbyyominame as string,",
						"          createdon as timestamp,",
						"          createdonbehalfbyname as string,",
						"          createdonbehalfbyyominame as string,",
						"          hso_automaticpocreation as boolean,",
						"          hso_automaticpocreationname as string,",
						"          hso_companyicwarehouse as string,",
						"          hso_companylocalwarehouse as string,",
						"          hso_dualpurpose as boolean,",
						"          hso_dualpurposename as string,",
						"          hso_icwarehousename as string,",
						"          hso_maxtoqty as integer,",
						"          hso_ordertypesplit as integer,",
						"          hso_ordertypesplitname as string,",
						"          hso_sourceicwarehouse as string,",
						"          hso_storeleadername as string,",
						"          hso_storeleaderyominame as string,",
						"          hso_vendorname as string,",
						"          importsequencenumber as integer,",
						"          modifiedbyname as string,",
						"          modifiedbyyominame as string,",
						"          modifiedon as timestamp,",
						"          modifiedonbehalfbyname as string,",
						"          modifiedonbehalfbyyominame as string,",
						"          overriddencreatedon as timestamp,",
						"          owneridname as string,",
						"          owneridtype as string,",
						"          owneridyominame as string,",
						"          owningbusinessunitname as string,",
						"          statecode as integer,",
						"          statecodename as string,",
						"          statuscode as integer,",
						"          statuscodename as string,",
						"          timezoneruleversionnumber as integer,",
						"          utcconversiontimezonecode as integer,",
						"          versionnumber as long,",
						"          createdonbehalfby as string,",
						"          hso_vendor as string,",
						"          hso_icwarehouse as string,",
						"          owninguser as string,",
						"          modifiedby as string,",
						"          hso_storeleader as string,",
						"          modifiedonbehalfby as string,",
						"          ownerid as string,",
						"          {@odata.etag} as string,",
						"          crd3c_sourcewh as string,",
						"          createdby as string,",
						"          owningbusinessunit as string,",
						"          owningteam as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false) ~> UOWarehouses",
						"source(output(",
						"          crd3c_barcode as string,",
						"          crd3c_dataarea as string,",
						"          crd3c_datastatus as integer,",
						"          crd3c_datastatusname as string,",
						"          crd3c_gender as string,",
						"          crd3c_name as string,",
						"          crd3c_productnumber as string,",
						"          crd3c_simpleid as string,",
						"          crd3c_size as string,",
						"          crd3c_uoitemid as string,",
						"          crd3c_variantname as string,",
						"          createdbyname as string,",
						"          createdbyyominame as string,",
						"          createdon as timestamp,",
						"          createdonbehalfbyname as string,",
						"          createdonbehalfbyyominame as string,",
						"          importsequencenumber as integer,",
						"          modifiedbyname as string,",
						"          modifiedbyyominame as string,",
						"          modifiedon as timestamp,",
						"          modifiedonbehalfbyname as string,",
						"          modifiedonbehalfbyyominame as string,",
						"          overriddencreatedon as timestamp,",
						"          owneridname as string,",
						"          owneridtype as string,",
						"          owneridyominame as string,",
						"          owningbusinessunitname as string,",
						"          statecode as integer,",
						"          statecodename as string,",
						"          statuscode as integer,",
						"          statuscodename as string,",
						"          timezoneruleversionnumber as integer,",
						"          utcconversiontimezonecode as integer,",
						"          versionnumber as long,",
						"          createdonbehalfby as string,",
						"          owninguser as string,",
						"          modifiedby as string,",
						"          modifiedonbehalfby as string,",
						"          ownerid as string,",
						"          {@odata.etag} as string,",
						"          createdby as string,",
						"          owningbusinessunit as string,",
						"          owningteam as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     wildcardPaths:['UOItem.csv']) ~> UOItem",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          blocked as long,",
						"          retailshowforitem as long,",
						"          useforinput as long,",
						"          useforprinting as long,",
						"          hsoisuniqueidentifier as long,",
						"          sysdatastatecode as long,",
						"          barcodesetupid as string,",
						"          description as string,",
						"          inventdimid as string,",
						"          itembarcode as string,",
						"          itemid as string,",
						"          qty as decimal(38,6),",
						"          retailvariantid as string,",
						"          unitid as string,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/inventitembarcode_partitioned') ~> Barcode",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          hashtype as long,",
						"          sysdatastatecode as long,",
						"          configid as string,",
						"          inventbatchid as string,",
						"          inventcolorid as string,",
						"          inventdimid as string,",
						"          inventgtdid_ru as string,",
						"          inventlocationid as string,",
						"          inventownerid_ru as string,",
						"          inventprofileid_ru as string,",
						"          inventserialid as string,",
						"          inventsiteid as string,",
						"          inventsizeid as string,",
						"          inventstatusid as string,",
						"          inventstyleid as string,",
						"          inventversionid as string,",
						"          licenseplateid as string,",
						"          wmslocationid as string,",
						"          wmspalletid as string,",
						"          sha1hashhex as string,",
						"          inventdimension1 as string,",
						"          inventdimension2 as string,",
						"          inventdimension3 as string,",
						"          inventdimension4 as string,",
						"          inventdimension5 as string,",
						"          inventdimension6 as string,",
						"          inventdimension7 as string,",
						"          inventdimension8 as string,",
						"          inventdimension9 as timestamp,",
						"          inventdimension10 as decimal(38,6),",
						"          inventdimension11 as string,",
						"          inventdimension12 as string,",
						"          sha3hashhex as string,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'dataverse-ontest-unqccd0037834be4cec846b41a3ea290',",
						"     folderPath: 'deltalake/inventdim_partitioned') ~> InventDim",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          active as long,",
						"          allocatemethod as long,",
						"          cov as long,",
						"          freqcode as long,",
						"          projforecastbudgettype as long,",
						"          report as long,",
						"          hsoisreturnorder as long,",
						"          sysdatastatecode as long,",
						"          activitynumber as string,",
						"          amount as decimal(38,6),",
						"          comment as string,",
						"          costprice as decimal(38,6),",
						"          covstatus as long,",
						"          currency as string,",
						"          custaccountid as string,",
						"          custgroupid as string,",
						"          defaultdimension as long,",
						"          discamount as decimal(38,6),",
						"          discpercent as decimal(38,6),",
						"          enddate as timestamp,",
						"          expandid as long,",
						"          freq as long,",
						"          inventdimid as string,",
						"          inventqty as decimal(38,6),",
						"          itemallocateid as string,",
						"          itembomid as string,",
						"          itemgroupid as string,",
						"          itemid as string,",
						"          itemrouteid as string,",
						"          keyid as string,",
						"          modelid as string,",
						"          pdscwqty as decimal(38,6),",
						"          pdscwunitid as string,",
						"          priceunit as decimal(38,12),",
						"          projcategoryid as string,",
						"          projforecastcostpaymdate as timestamp,",
						"          projforecasteliminationdate as timestamp,",
						"          projforecastinvoicedate as timestamp,",
						"          projforecastsalespaymdate as timestamp,",
						"          projfundingsource as long,",
						"          projid as string,",
						"          projlinepropertyid as string,",
						"          projtransid as string,",
						"          psarefpurchline as long,",
						"          salesmarkup as decimal(38,6),",
						"          salesprice as decimal(38,6),",
						"          salesqty as decimal(38,6),",
						"          salesunitid as string,",
						"          startdate as timestamp,",
						"          taxgroupid as string,",
						"          taxitemgroupid as string,",
						"          forecastentrynumber as string,",
						"          description as string,",
						"          planningpriority as decimal(38,2),",
						"          itemdescription as string,",
						"          contractlineid as string,",
						"          kittinginventtransid as string,",
						"          kittinglinenum as decimal(38,16),",
						"          suntaforigforecastdate as timestamp,",
						"          suntaforigforecastqty as decimal(38,6),",
						"          suntafforecastchannelid as string,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/forecastsales_partitioned') ~> ForecastSales",
						"ForecastSales filter(equals(suntafforecastchannelid, \"D2CE\") && equals(modelid, \"D2CE model\") && equals(custgroupid, \"zD2CE\") && (salesqty != 0) && toDate(toString(startdate)) == addDays(currentDate(),1)) ~> filterModelCustGroupChannel",
						"filterModelCustGroupChannel select(mapColumn(",
						"          itemid,",
						"          inventdimid,",
						"          salesqty,",
						"          dataareaid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectItemIdForecastQtyInventDimId",
						"Barcode select(mapColumn(",
						"          inventdimid,",
						"          itemid,",
						"          dataareaid,",
						"          itembarcode",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectInventDimIdAndBarcodeNum",
						"SelectPreBarcode, FinalSelectBarcodeInventSizeId lookup(SelectPreBarcode@itemid == FinalSelectBarcodeInventSizeId@itemid",
						"     && SelectPreBarcode@dataareaid == FinalSelectBarcodeInventSizeId@dataareaid",
						"     && SelectPreBarcode@inventsizeid == FinalSelectBarcodeInventSizeId@inventsizeid,",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> GetBarcode",
						"joinMSL select(mapColumn(",
						"          crd3c_barcode,",
						"          crd3c_site = inventlocationid,",
						"          crd3c_dataarea = UOItem@crd3c_dataarea,",
						"          crd3c_quantity = salesqty,",
						"          crd3c_itemvariant = crd3c_simpleid,",
						"          crd3c_variantname,",
						"          crd3c_itemvariantlookup = crd3c_uoitemid,",
						"          hso_size = crd3c_size,",
						"          crd3c_warehouselookup = crd3c_uowarehousesid,",
						"          crd3c_quantity = salesqty,",
						"          crd3c_name",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> AddMSL",
						"InventDim select(mapColumn(",
						"          inventdimid,",
						"          inventsizeid,",
						"          dataareaid,",
						"          inventlocationid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectInventSizeIdAndInventDimId",
						"SelectInventDimIdAndBarcodeNum, SelectInventSizeIdAndInventDimId join(SelectInventDimIdAndBarcodeNum@inventdimid == SelectInventSizeIdAndInventDimId@inventdimid",
						"     && SelectInventDimIdAndBarcodeNum@dataareaid == SelectInventSizeIdAndInventDimId@dataareaid,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> GetInventSizeId",
						"GetInventSizeId select(mapColumn(",
						"          inventdimid = SelectInventDimIdAndBarcodeNum@inventdimid,",
						"          dataareaid = SelectInventDimIdAndBarcodeNum@dataareaid,",
						"          itembarcode,",
						"          inventsizeid,",
						"          itemid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> FinalSelectBarcodeInventSizeId",
						"SelectItemIdForecastQtyInventDimId, SelectInventSizeIdAndInventDimId lookup(SelectItemIdForecastQtyInventDimId@inventdimid == SelectInventSizeIdAndInventDimId@inventdimid",
						"     && SelectItemIdForecastQtyInventDimId@dataareaid == SelectInventSizeIdAndInventDimId@dataareaid,",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> FSGetInventSizeId",
						"GetBarcode select(mapColumn(",
						"          itembarcode,",
						"          crd3c_dataarea = SelectPreBarcode@dataareaid,",
						"          salesqty,",
						"          inventlocationid,",
						"          crd3c_uowarehousesid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> MSL",
						"UOWarehouses filter(upper(crd3c_warehousetype) == \"STOCK\" && hso_dualpurpose == true() && statecode == 0) ~> GetDualPurposeStores",
						"GetDualPurposeStores select(mapColumn(",
						"          crd3c_dataarea,",
						"          crd3c_name,",
						"          crd3c_uowarehousesid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectDualPurposeStores",
						"SelectStoreAndSize, SelectDualPurposeStores join(inventlocationid == crd3c_name",
						"     && dataareaid == crd3c_dataarea,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> DualPurposeStoresOnly",
						"FSGetInventSizeId select(mapColumn(",
						"          itemid,",
						"          salesqty,",
						"          dataareaid = SelectItemIdForecastQtyInventDimId@dataareaid,",
						"          inventsizeid,",
						"          inventlocationid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectStoreAndSize",
						"DualPurposeStoresOnly aggregate(groupBy(itemid,",
						"          dataareaid,",
						"          inventsizeid,",
						"          inventlocationid,",
						"          crd3c_uowarehousesid),",
						"     salesqty = sum(salesqty)) ~> CalculateMSL",
						"UOItem, MSL join(crd3c_barcode == itembarcode",
						"     && UOItem@crd3c_dataarea == MSL@crd3c_dataarea,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> joinMSL",
						"CalculateMSL select(mapColumn(",
						"          itemid,",
						"          dataareaid,",
						"          inventsizeid,",
						"          inventlocationid,",
						"          salesqty,",
						"          crd3c_uowarehousesid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectPreBarcode",
						"AddMSL sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     input(",
						"          crd3c_name as string,",
						"          crd3c_variantname as string,",
						"          crd3c_barcode as string,",
						"          crd3c_productnumber as string,",
						"          crd3c_dataarea as string,",
						"          crd3c_size as string",
						"     ),",
						"     partitionFileNames:['RecOrderQtyVS.csv'],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     partitionBy('hash', 1)) ~> MSLcreateCSV"
					]
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/CreateRecOrderQtyCsv_VirtualStores_SampleData')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"folder": {
					"name": "OL/MSL Sync"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "UOWarehouses",
								"type": "DatasetReference"
							},
							"name": "UOWarehousesSample"
						},
						{
							"dataset": {
								"referenceName": "UOItem",
								"type": "DatasetReference"
							},
							"name": "UOItemSample"
						},
						{
							"dataset": {
								"referenceName": "InventdimONUKONUS",
								"type": "DatasetReference"
							},
							"name": "InventDimSample"
						},
						{
							"dataset": {
								"referenceName": "BarcodeONUKONUS",
								"type": "DatasetReference"
							},
							"name": "BarcodeSample"
						},
						{
							"dataset": {
								"referenceName": "ForecastSalesONUKONUS",
								"type": "DatasetReference"
							},
							"name": "ForecastSalesSample"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "RecomOrderQtyCsvFile_virtualStore",
								"type": "DatasetReference"
							},
							"name": "MSLcreateCSV"
						}
					],
					"transformations": [
						{
							"name": "filterModelCustGroupChannel"
						},
						{
							"name": "SelectItemIdForecastQtyInventDimId"
						},
						{
							"name": "SelectInventDimIdAndBarcodeNum"
						},
						{
							"name": "GetBarcode"
						},
						{
							"name": "AddMSL"
						},
						{
							"name": "SelectInventSizeIdAndInventDimId"
						},
						{
							"name": "GetInventSizeId"
						},
						{
							"name": "FinalSelectBarcodeInventSizeId"
						},
						{
							"name": "FSGetInventSizeId"
						},
						{
							"name": "MSL"
						},
						{
							"name": "GetDualPurposeStores"
						},
						{
							"name": "SelectDualPurposeStores"
						},
						{
							"name": "DualPurposeStoresOnly"
						},
						{
							"name": "SelectStoreAndSize"
						},
						{
							"name": "CalculateMSL"
						},
						{
							"name": "joinMSL"
						},
						{
							"name": "SelectPreBarcode"
						}
					],
					"scriptLines": [
						"parameters{",
						"     Container as string",
						"}",
						"source(output(",
						"          crd3c_automatictocreation as boolean,",
						"          crd3c_automatictocreationname as string,",
						"          crd3c_dataarea as string,",
						"          crd3c_datastatus as integer,",
						"          crd3c_datastatusname as string,",
						"          crd3c_deliveryterms as string,",
						"          crd3c_modeofdelivery as string,",
						"          crd3c_name as string,",
						"          crd3c_refreshday as string,",
						"          crd3c_refreshdayname as string,",
						"          crd3c_refreshfrequency as integer,",
						"          crd3c_refreshtime as timestamp,",
						"          crd3c_site as string,",
						"          crd3c_sourcewhname as string,",
						"          crd3c_uowarehousesid as string,",
						"          crd3c_warehousename as string,",
						"          crd3c_warehousetype as string,",
						"          createdbyname as string,",
						"          createdbyyominame as string,",
						"          createdon as timestamp,",
						"          createdonbehalfbyname as string,",
						"          createdonbehalfbyyominame as string,",
						"          hso_automaticpocreation as boolean,",
						"          hso_automaticpocreationname as string,",
						"          hso_companyicwarehouse as string,",
						"          hso_companylocalwarehouse as string,",
						"          hso_dualpurpose as boolean,",
						"          hso_dualpurposename as string,",
						"          hso_icwarehousename as string,",
						"          hso_maxtoqty as integer,",
						"          hso_ordertypesplit as integer,",
						"          hso_ordertypesplitname as string,",
						"          hso_sourceicwarehouse as string,",
						"          hso_storeleadername as string,",
						"          hso_storeleaderyominame as string,",
						"          hso_vendorname as string,",
						"          importsequencenumber as integer,",
						"          modifiedbyname as string,",
						"          modifiedbyyominame as string,",
						"          modifiedon as timestamp,",
						"          modifiedonbehalfbyname as string,",
						"          modifiedonbehalfbyyominame as string,",
						"          overriddencreatedon as timestamp,",
						"          owneridname as string,",
						"          owneridtype as string,",
						"          owneridyominame as string,",
						"          owningbusinessunitname as string,",
						"          statecode as integer,",
						"          statecodename as string,",
						"          statuscode as integer,",
						"          statuscodename as string,",
						"          timezoneruleversionnumber as integer,",
						"          utcconversiontimezonecode as integer,",
						"          versionnumber as long,",
						"          createdonbehalfby as string,",
						"          hso_vendor as string,",
						"          hso_icwarehouse as string,",
						"          owninguser as string,",
						"          modifiedby as string,",
						"          hso_storeleader as string,",
						"          modifiedonbehalfby as string,",
						"          ownerid as string,",
						"          {@odata.etag} as string,",
						"          crd3c_sourcewh as string,",
						"          createdby as string,",
						"          owningbusinessunit as string,",
						"          owningteam as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     query: ('<fetch version=\"1.0\" mapping=\"logical\" distinct=\"true\" savedqueryid=\"41c7362d-ac5a-ed11-9562-000d3aba35c5\" no-lock=\"false\"><entity name=\"crd3c_uowarehouses\"><attribute name=\"statecode\"/><attribute name=\"crd3c_uowarehousesid\"/><attribute name=\"crd3c_name\"/><attribute name=\"crd3c_dataarea\"/><order attribute=\"hso_ordertypesplit\" descending=\"true\"/><order attribute=\"crd3c_warehousename\" descending=\"false\"/><attribute name=\"crd3c_warehousetype\"/><filter type=\"and\"><condition attribute=\"statecode\" operator=\"eq\" value=\"0\"/><condition attribute=\"hso_dualpurpose\" operator=\"eq\" value=\"1\"/></filter></entity></fetch>')) ~> UOWarehousesSample",
						"source(output(",
						"          crd3c_barcode as string,",
						"          crd3c_dataarea as string,",
						"          crd3c_datastatus as integer,",
						"          crd3c_datastatusname as string,",
						"          crd3c_gender as string,",
						"          crd3c_name as string,",
						"          crd3c_productnumber as string,",
						"          crd3c_simpleid as string,",
						"          crd3c_size as string,",
						"          crd3c_uoitemid as string,",
						"          crd3c_variantname as string,",
						"          createdbyname as string,",
						"          createdbyyominame as string,",
						"          createdon as timestamp,",
						"          createdonbehalfbyname as string,",
						"          createdonbehalfbyyominame as string,",
						"          importsequencenumber as integer,",
						"          modifiedbyname as string,",
						"          modifiedbyyominame as string,",
						"          modifiedon as timestamp,",
						"          modifiedonbehalfbyname as string,",
						"          modifiedonbehalfbyyominame as string,",
						"          overriddencreatedon as timestamp,",
						"          owneridname as string,",
						"          owneridtype as string,",
						"          owneridyominame as string,",
						"          owningbusinessunitname as string,",
						"          statecode as integer,",
						"          statecodename as string,",
						"          statuscode as integer,",
						"          statuscodename as string,",
						"          timezoneruleversionnumber as integer,",
						"          utcconversiontimezonecode as integer,",
						"          versionnumber as long,",
						"          createdonbehalfby as string,",
						"          owninguser as string,",
						"          modifiedby as string,",
						"          modifiedonbehalfby as string,",
						"          ownerid as string,",
						"          {@odata.etag} as string,",
						"          createdby as string,",
						"          owningbusinessunit as string,",
						"          owningteam as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     query: ('<fetch version=\"1.0\" mapping=\"logical\" no-lock=\"false\" distinct=\"true\"><entity name=\"crd3c_uoitem\"><attribute name=\"statecode\"/><attribute name=\"crd3c_uoitemid\"/><attribute name=\"crd3c_name\"/><order attribute=\"crd3c_name\" descending=\"false\"/><attribute name=\"crd3c_simpleid\"/><attribute name=\"crd3c_variantname\"/><attribute name=\"crd3c_dataarea\"/><attribute name=\"crd3c_barcode\"/><attribute name=\"crd3c_size\"/><filter type=\"and\"><condition attribute=\"statecode\" operator=\"eq\" value=\"0\"/><filter type=\"or\"><condition attribute=\"crd3c_productnumber\" operator=\"eq\" value=\"3ME10140264\"/><condition attribute=\"crd3c_productnumber\" operator=\"eq\" value=\"3WF10061508\"/><condition attribute=\"crd3c_productnumber\" operator=\"eq\" value=\"2UF10080069\"/><condition attribute=\"crd3c_productnumber\" operator=\"eq\" value=\"3WF10053037\"/><condition attribute=\"crd3c_productnumber\" operator=\"eq\" value=\"2UE30660553\"/><condition attribute=\"crd3c_productnumber\" operator=\"eq\" value=\"3WD30120958\"/></filter></filter></entity></fetch>'),",
						"     wildcardPaths:['UOItem.csv']) ~> UOItemSample",
						"source(output(",
						"          inventdimid as string,",
						"          inventlocationid as string,",
						"          inventsizeid as string,",
						"          dataareaid as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false) ~> InventDimSample",
						"source(output(",
						"          inventdimid as string,",
						"          itembarcode as string,",
						"          itemid as string,",
						"          dataareaid as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false) ~> BarcodeSample",
						"source(output(",
						"          dataareaid as string,",
						"          itemid as string,",
						"          salesqty as double,",
						"          inventdimid as string,",
						"          startdate as timestamp,",
						"          suntafforecastchannelid as string,",
						"          modelid as string,",
						"          custgroupid as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false) ~> ForecastSalesSample",
						"ForecastSalesSample filter(equals(suntafforecastchannelid, \"D2CE\") && equals(modelid, \"D2CE model\") && equals(custgroupid, \"zD2CE\") && (salesqty != 0) && toDate(toString(startdate)) == addDays(currentDate(), 1)) ~> filterModelCustGroupChannel",
						"filterModelCustGroupChannel select(mapColumn(",
						"          itemid,",
						"          inventdimid,",
						"          salesqty,",
						"          dataareaid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectItemIdForecastQtyInventDimId",
						"BarcodeSample select(mapColumn(",
						"          inventdimid,",
						"          itemid,",
						"          dataareaid,",
						"          itembarcode",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectInventDimIdAndBarcodeNum",
						"SelectPreBarcode, FinalSelectBarcodeInventSizeId lookup(SelectPreBarcode@itemid == FinalSelectBarcodeInventSizeId@itemid",
						"     && SelectPreBarcode@dataareaid == FinalSelectBarcodeInventSizeId@dataareaid",
						"     && SelectPreBarcode@inventsizeid == FinalSelectBarcodeInventSizeId@inventsizeid,",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> GetBarcode",
						"joinMSL select(mapColumn(",
						"          crd3c_barcode,",
						"          crd3c_site = inventlocationid,",
						"          crd3c_dataarea = UOItemSample@crd3c_dataarea,",
						"          crd3c_quantity = salesqty,",
						"          crd3c_itemvariant = crd3c_simpleid,",
						"          crd3c_variantname,",
						"          crd3c_itemvariantlookup = crd3c_uoitemid,",
						"          hso_size = crd3c_size,",
						"          crd3c_warehouselookup = crd3c_uowarehousesid,",
						"          crd3c_quantity = salesqty,",
						"          crd3c_name",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> AddMSL",
						"InventDimSample select(mapColumn(",
						"          inventdimid,",
						"          inventsizeid,",
						"          dataareaid,",
						"          inventlocationid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectInventSizeIdAndInventDimId",
						"SelectInventDimIdAndBarcodeNum, SelectInventSizeIdAndInventDimId join(SelectInventDimIdAndBarcodeNum@inventdimid == SelectInventSizeIdAndInventDimId@inventdimid",
						"     && SelectInventDimIdAndBarcodeNum@dataareaid == SelectInventSizeIdAndInventDimId@dataareaid,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> GetInventSizeId",
						"GetInventSizeId select(mapColumn(",
						"          inventdimid = SelectInventDimIdAndBarcodeNum@inventdimid,",
						"          dataareaid = SelectInventDimIdAndBarcodeNum@dataareaid,",
						"          itembarcode,",
						"          inventsizeid,",
						"          itemid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> FinalSelectBarcodeInventSizeId",
						"SelectItemIdForecastQtyInventDimId, SelectInventSizeIdAndInventDimId lookup(SelectItemIdForecastQtyInventDimId@inventdimid == SelectInventSizeIdAndInventDimId@inventdimid",
						"     && SelectItemIdForecastQtyInventDimId@dataareaid == SelectInventSizeIdAndInventDimId@dataareaid,",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> FSGetInventSizeId",
						"GetBarcode select(mapColumn(",
						"          itembarcode,",
						"          crd3c_dataarea = SelectPreBarcode@dataareaid,",
						"          salesqty,",
						"          inventlocationid,",
						"          crd3c_uowarehousesid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> MSL",
						"UOWarehousesSample filter(upper(crd3c_warehousetype) == \"STOCK\" && statecode == 0) ~> GetDualPurposeStores",
						"GetDualPurposeStores select(mapColumn(",
						"          crd3c_dataarea,",
						"          crd3c_name,",
						"          crd3c_uowarehousesid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectDualPurposeStores",
						"SelectStoreAndSize, SelectDualPurposeStores join(inventlocationid == crd3c_name",
						"     && dataareaid == crd3c_dataarea,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> DualPurposeStoresOnly",
						"FSGetInventSizeId select(mapColumn(",
						"          itemid,",
						"          salesqty,",
						"          dataareaid = SelectItemIdForecastQtyInventDimId@dataareaid,",
						"          inventsizeid,",
						"          inventlocationid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectStoreAndSize",
						"DualPurposeStoresOnly aggregate(groupBy(itemid,",
						"          dataareaid,",
						"          inventsizeid,",
						"          inventlocationid,",
						"          crd3c_uowarehousesid),",
						"     salesqty = sum(salesqty)) ~> CalculateMSL",
						"UOItemSample, MSL join(crd3c_barcode == itembarcode",
						"     && UOItemSample@crd3c_dataarea == MSL@crd3c_dataarea,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> joinMSL",
						"CalculateMSL select(mapColumn(",
						"          itemid,",
						"          dataareaid,",
						"          inventsizeid,",
						"          inventlocationid,",
						"          salesqty,",
						"          crd3c_uowarehousesid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectPreBarcode",
						"AddMSL sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     input(",
						"          crd3c_name as string,",
						"          crd3c_variantname as string,",
						"          crd3c_barcode as string,",
						"          crd3c_productnumber as string,",
						"          crd3c_dataarea as string,",
						"          crd3c_size as string",
						"     ),",
						"     partitionFileNames:['RecOrderQtyVS.csv'],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     partitionBy('hash', 1)) ~> MSLcreateCSV"
					]
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/CreateRecOrderQtyCsv_VirtualStores_v1')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"folder": {
					"name": "OL/MSL Sync"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "1ME10030553",
								"type": "DatasetReference"
							},
							"name": "ForecastSalesONUKONUS"
						},
						{
							"dataset": {
								"referenceName": "BarcodeONUKONUS",
								"type": "DatasetReference"
							},
							"name": "BarcodeONUKONUS"
						},
						{
							"dataset": {
								"referenceName": "InventdimONUKONUS",
								"type": "DatasetReference"
							},
							"name": "InventdimONUKONUS"
						},
						{
							"dataset": {
								"referenceName": "ItemONUKONUS",
								"type": "DatasetReference"
							},
							"name": "ItemONUKONUS"
						},
						{
							"dataset": {
								"referenceName": "WHONUKONUS",
								"type": "DatasetReference"
							},
							"name": "WHONUKONUS"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "storageaccount",
								"type": "LinkedServiceReference"
							},
							"name": "createCsv"
						}
					],
					"transformations": [
						{
							"name": "joinWhsItem"
						},
						{
							"name": "selectJoinWhsItem"
						},
						{
							"name": "selectWarehouses"
						},
						{
							"name": "SelectInventDimIdAndBarcodeNum"
						},
						{
							"name": "GetBarcode"
						},
						{
							"name": "LookupMSLForVirtualStores"
						},
						{
							"name": "AddMSL"
						},
						{
							"name": "SelectInventSizeIdAndInventDimId"
						},
						{
							"name": "GetInventSizeId"
						},
						{
							"name": "FinalSelectBarcodeInventSizeId"
						},
						{
							"name": "FSGetInventSizeId"
						},
						{
							"name": "SelectInventSizeForFS"
						},
						{
							"name": "MSL"
						},
						{
							"name": "DualPurposeStoresOnly"
						},
						{
							"name": "SelectStoreAndSize"
						},
						{
							"name": "CalculateMSL"
						},
						{
							"name": "DualPurposeStores"
						},
						{
							"name": "SelectDualPurposeStores"
						},
						{
							"name": "TomorrowDate"
						}
					],
					"scriptLines": [
						"parameters{",
						"     Container as string ('dataverse-ontest-unqccd0037834be4cec846b41a3ea290')",
						"}",
						"source(output(",
						"          dataareaid as string,",
						"          itemid as string,",
						"          salesqty as integer,",
						"          inventdimid as string,",
						"          startdate as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false) ~> ForecastSalesONUKONUS",
						"source(output(",
						"          inventdimid as string,",
						"          itembarcode as string,",
						"          itemid as string,",
						"          dataareaid as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false) ~> BarcodeONUKONUS",
						"source(output(",
						"          inventdimid as string,",
						"          inventlocationid as string,",
						"          inventsizeid as string,",
						"          dataareaid as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false) ~> InventdimONUKONUS",
						"source(output(",
						"          crd3c_barcode as string,",
						"          crd3c_dataarea as string,",
						"          crd3c_size as string,",
						"          crd3c_simpleid as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false) ~> ItemONUKONUS",
						"source(output(",
						"          crd3c_dataarea as string,",
						"          crd3c_name as string,",
						"          hso_vendor as string,",
						"          crd3c_sourcewhname as string,",
						"          hso_dualpurpose as boolean",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false) ~> WHONUKONUS",
						"ItemONUKONUS, selectWarehouses join(upper(ItemONUKONUS@crd3c_dataarea) == upper(selectWarehouses@crd3c_dataarea),",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> joinWhsItem",
						"joinWhsItem select(mapColumn(",
						"          crd3c_barcode,",
						"          crd3c_name,",
						"          crd3c_dataarea = ItemONUKONUS@crd3c_dataarea,",
						"          crd3c_size,",
						"          crd3c_name",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectJoinWhsItem",
						"WHONUKONUS select(mapColumn(",
						"          crd3c_name,",
						"          crd3c_dataarea,",
						"          hso_dualpurpose",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectWarehouses",
						"BarcodeONUKONUS select(mapColumn(",
						"          inventdimid,",
						"          itemid,",
						"          dataareaid,",
						"          itembarcode",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectInventDimIdAndBarcodeNum",
						"SelectInventSizeForFS, FinalSelectBarcodeInventSizeId lookup(SelectInventSizeForFS@itemid == FinalSelectBarcodeInventSizeId@itemid",
						"     && SelectInventSizeForFS@inventsizeid == FinalSelectBarcodeInventSizeId@inventsizeid",
						"     && SelectInventSizeForFS@dataareaid == FinalSelectBarcodeInventSizeId@dataareaid,",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> GetBarcode",
						"selectJoinWhsItem, MSL lookup(crd3c_barcode == itembarcode",
						"     && crd3c_dataarea == dataareaid",
						"     && crd3c_name == inventlocationid,",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> LookupMSLForVirtualStores",
						"LookupMSLForVirtualStores select(mapColumn(",
						"          crd3c_barcode,",
						"          crd3c_dataarea,",
						"          crd3c_name,",
						"          crd3c_Quantity = salesqty",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> AddMSL",
						"InventdimONUKONUS select(mapColumn(",
						"          inventdimid,",
						"          inventsizeid,",
						"          inventlocationid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectInventSizeIdAndInventDimId",
						"SelectInventDimIdAndBarcodeNum, SelectInventSizeIdAndInventDimId join(SelectInventDimIdAndBarcodeNum@inventdimid == SelectInventSizeIdAndInventDimId@inventdimid,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> GetInventSizeId",
						"GetInventSizeId select(mapColumn(",
						"          inventdimid = SelectInventDimIdAndBarcodeNum@inventdimid,",
						"          dataareaid,",
						"          itembarcode,",
						"          inventsizeid,",
						"          itemid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> FinalSelectBarcodeInventSizeId",
						"TomorrowDate, SelectInventSizeIdAndInventDimId lookup(ForecastSalesONUKONUS@inventdimid == SelectInventSizeIdAndInventDimId@inventdimid,",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> FSGetInventSizeId",
						"CalculateMSL select(mapColumn(",
						"          itemid,",
						"          inventsizeid,",
						"          dataareaid,",
						"          inventlocationid,",
						"          salesqty",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectInventSizeForFS",
						"GetBarcode select(mapColumn(",
						"          itembarcode,",
						"          salesqty,",
						"          dataareaid = SelectInventSizeForFS@dataareaid,",
						"          inventlocationid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> MSL",
						"SelectStoreAndSize, SelectDualPurposeStores join(inventlocationid == crd3c_name",
						"     && dataareaid == crd3c_dataarea,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> DualPurposeStoresOnly",
						"FSGetInventSizeId select(mapColumn(",
						"          itemid,",
						"          salesqty,",
						"          dataareaid,",
						"          inventsizeid,",
						"          inventlocationid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectStoreAndSize",
						"DualPurposeStoresOnly aggregate(groupBy(itemid,",
						"          dataareaid,",
						"          inventsizeid,",
						"          inventlocationid),",
						"     salesqty = sum(salesqty)) ~> CalculateMSL",
						"selectWarehouses filter(hso_dualpurpose == true()) ~> DualPurposeStores",
						"DualPurposeStores select(mapColumn(",
						"          crd3c_name,",
						"          crd3c_dataarea",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectDualPurposeStores",
						"ForecastSalesONUKONUS filter(toDate(toString(startdate)) == addDays(currentDate(), 1)) ~> TomorrowDate",
						"AddMSL sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delimited',",
						"     container: 'whsstockreplenish',",
						"     folderPath: 'OL/',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true,",
						"     partitionFileNames:['RecommenderV1.csv'],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     partitionBy('hash', 1)) ~> createCsv"
					]
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/CreateTransferOrderLines')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "Inventsum"
						},
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "EcoResProduct"
						},
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "EcoResProductTranslation"
						},
						{
							"linkedService": {
								"referenceName": "powerappdataverse",
								"type": "LinkedServiceReference"
							},
							"name": "UOWarehouse"
						},
						{
							"linkedService": {
								"referenceName": "powerappdataverse",
								"type": "LinkedServiceReference"
							},
							"name": "RecommendedOrderQty"
						},
						{
							"dataset": {
								"referenceName": "DataImportExecution",
								"type": "DatasetReference"
							},
							"name": "DataImportExecutions"
						},
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "InventItemGroupItem"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "powerappdataverse",
								"type": "LinkedServiceReference"
							},
							"name": "DataExecutionsTO"
						},
						{
							"linkedService": {
								"referenceName": "storageaccount",
								"type": "LinkedServiceReference"
							},
							"name": "TransferOrdersSink"
						}
					],
					"transformations": [
						{
							"name": "ItemSize"
						},
						{
							"name": "selectInventSum"
						},
						{
							"name": "joinInventSumRecorderQty"
						},
						{
							"name": "filterJoinInventSum"
						},
						{
							"name": "selectEcoResProduct"
						},
						{
							"name": "filterEcoResProductTranslation"
						},
						{
							"name": "selectEcoResProductTranslation"
						},
						{
							"name": "join1"
						},
						{
							"name": "selectProductDescription"
						},
						{
							"name": "StockLessThanMinimum"
						},
						{
							"name": "joinWhs"
						},
						{
							"name": "join2"
						},
						{
							"name": "selectSTKWhs"
						},
						{
							"name": "selectCols"
						},
						{
							"name": "derivedColumn2"
						},
						{
							"name": "selectWarehouse"
						},
						{
							"name": "filterWarehouse"
						},
						{
							"name": "join3"
						},
						{
							"name": "selectSourceWarehouse"
						},
						{
							"name": "selectWarehouseCombined"
						},
						{
							"name": "selectMinOrderQty"
						},
						{
							"name": "filterMinOrderQty"
						},
						{
							"name": "WhsUpperDataArea"
						},
						{
							"name": "MinOrderUpperDataArea"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "select2"
						},
						{
							"name": "filter1"
						},
						{
							"name": "derivedColumn3"
						},
						{
							"name": "filter2"
						},
						{
							"name": "filteronStoreParameter"
						},
						{
							"name": "filteronWarehouseParameter"
						},
						{
							"name": "join4"
						},
						{
							"name": "derivedColumn4"
						},
						{
							"name": "SelectWarehouseOnParameters"
						},
						{
							"name": "filter3"
						},
						{
							"name": "union1"
						},
						{
							"name": "Warehouses"
						},
						{
							"name": "triggersource"
						},
						{
							"name": "crd3cstoreavailqtyzero"
						},
						{
							"name": "select3"
						},
						{
							"name": "derivedColumn5"
						},
						{
							"name": "selectPOBoolean"
						},
						{
							"name": "selectInvItemGrpCols"
						},
						{
							"name": "lookupInventItemGrp"
						}
					],
					"scriptLines": [
						"parameters{",
						"     Company as string,",
						"     Store as string,",
						"     Warehouse as string,",
						"     filename as string,",
						"     TriggerSource as string,",
						"     Container as string,",
						"     OrderType as string",
						"}",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          closed as long,",
						"          closedqty as long,",
						"          isexcludedfrominventoryvalue as long,",
						"          sysdatastatecode as long,",
						"          arrived as decimal(38,6),",
						"          availordered as decimal(38,6),",
						"          availphysical as decimal(38,6),",
						"          deducted as decimal(38,6),",
						"          inventdimid as string,",
						"          itemid as string,",
						"          lastupddateexpected as timestamp,",
						"          lastupddatephysical as timestamp,",
						"          onorder as decimal(38,6),",
						"          ordered as decimal(38,6),",
						"          pdscwarrived as decimal(38,6),",
						"          pdscwavailordered as decimal(38,6),",
						"          pdscwavailphysical as decimal(38,6),",
						"          pdscwdeducted as decimal(38,6),",
						"          pdscwonorder as decimal(38,6),",
						"          pdscwordered as decimal(38,6),",
						"          pdscwphysicalinvent as decimal(38,6),",
						"          pdscwpicked as decimal(38,6),",
						"          pdscwpostedqty as decimal(38,6),",
						"          pdscwquotationissue as decimal(38,6),",
						"          pdscwquotationreceipt as decimal(38,6),",
						"          pdscwreceived as decimal(38,6),",
						"          pdscwregistered as decimal(38,6),",
						"          pdscwreservordered as decimal(38,6),",
						"          pdscwreservphysical as decimal(38,6),",
						"          physicalinvent as decimal(38,6),",
						"          physicalvalue as decimal(38,6),",
						"          physicalvalueseccur_ru as decimal(38,6),",
						"          picked as decimal(38,6),",
						"          postedqty as decimal(38,6),",
						"          postedvalue as decimal(38,6),",
						"          postedvalueseccur_ru as decimal(38,6),",
						"          quotationissue as decimal(38,6),",
						"          quotationreceipt as decimal(38,6),",
						"          received as decimal(38,6),",
						"          registered as decimal(38,6),",
						"          reservordered as decimal(38,6),",
						"          reservphysical as decimal(38,6),",
						"          configid as string,",
						"          inventbatchid as string,",
						"          inventcolorid as string,",
						"          inventgtdid_ru as string,",
						"          inventlocationid as string,",
						"          inventownerid_ru as string,",
						"          inventprofileid_ru as string,",
						"          inventserialid as string,",
						"          inventsiteid as string,",
						"          inventsizeid as string,",
						"          inventstatusid as string,",
						"          inventstyleid as string,",
						"          inventversionid as string,",
						"          licenseplateid as string,",
						"          wmslocationid as string,",
						"          wmspalletid as string,",
						"          inventdimension1 as string,",
						"          inventdimension2 as string,",
						"          inventdimension3 as string,",
						"          inventdimension4 as string,",
						"          inventdimension5 as string,",
						"          inventdimension6 as string,",
						"          inventdimension7 as string,",
						"          inventdimension8 as string,",
						"          inventdimension9 as timestamp,",
						"          inventdimension10 as decimal(38,6),",
						"          inventdimension11 as string,",
						"          inventdimension12 as string,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/inventsum_partitioned',",
						"     manifestType: 'manifest') ~> Inventsum",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          pdscwproduct as long,",
						"          producttype as long,",
						"          servicetype as long,",
						"          sunplmsyncwithplm as long,",
						"          sysdatastatecode as long,",
						"          displayproductnumber as string,",
						"          instancerelationtype as long,",
						"          searchname as string,",
						"          engchgproductownerid as string,",
						"          engchgproductcategorydetails as long,",
						"          engchgproductreleasepolicy as long,",
						"          engchgproductreadinesspolicy as long,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/ecoresproduct_partitioned',",
						"     manifestType: 'manifest') ~> EcoResProduct",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          sysdatastatecode as long,",
						"          description as string,",
						"          languageid as string,",
						"          name as string,",
						"          product as long,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/ecoresproducttranslation_partitioned',",
						"     manifestType: 'manifest') ~> EcoResProductTranslation",
						"source(output(",
						"          crd3c_automatictocreation as boolean,",
						"          crd3c_automatictocreationname as string,",
						"          crd3c_dataarea as string,",
						"          crd3c_datastatus as integer,",
						"          crd3c_datastatusname as string,",
						"          crd3c_deliveryterms as string,",
						"          crd3c_modeofdelivery as string,",
						"          crd3c_name as string,",
						"          crd3c_refreshday as string,",
						"          crd3c_refreshdayname as string,",
						"          crd3c_refreshfrequency as integer,",
						"          crd3c_refreshtime as timestamp,",
						"          crd3c_site as string,",
						"          crd3c_sourcewhname as string,",
						"          crd3c_uowarehousesid as string,",
						"          crd3c_warehousename as string,",
						"          crd3c_warehousetype as string,",
						"          createdbyname as string,",
						"          createdbyyominame as string,",
						"          createdon as timestamp,",
						"          createdonbehalfbyname as string,",
						"          createdonbehalfbyyominame as string,",
						"          hso_automaticpocreation as boolean,",
						"          hso_automaticpocreationname as string,",
						"          hso_companyicwarehouse as string,",
						"          hso_companylocalwarehouse as string,",
						"          hso_icwarehousename as string,",
						"          hso_ordertypesplit as integer,",
						"          hso_ordertypesplitname as string,",
						"          hso_sourceicwarehouse as string,",
						"          hso_vendorname as string,",
						"          importsequencenumber as integer,",
						"          modifiedbyname as string,",
						"          modifiedbyyominame as string,",
						"          modifiedon as timestamp,",
						"          modifiedonbehalfbyname as string,",
						"          modifiedonbehalfbyyominame as string,",
						"          overriddencreatedon as timestamp,",
						"          owneridname as string,",
						"          owneridtype as string,",
						"          owneridyominame as string,",
						"          owningbusinessunitname as string,",
						"          statecode as integer,",
						"          statecodename as string,",
						"          statuscode as integer,",
						"          statuscodename as string,",
						"          timezoneruleversionnumber as integer,",
						"          utcconversiontimezonecode as integer,",
						"          versionnumber as long,",
						"          createdonbehalfby as string,",
						"          hso_vendor as string,",
						"          hso_icwarehouse as string,",
						"          owninguser as string,",
						"          modifiedby as string,",
						"          modifiedonbehalfby as string,",
						"          ownerid as string,",
						"          {@odata.etag} as string,",
						"          crd3c_sourcewh as string,",
						"          createdby as string,",
						"          owningbusinessunit as string,",
						"          owningteam as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     store: 'dynamics',",
						"     format: 'dynamicsformat',",
						"     entity: 'crd3c_uowarehouses',",
						"     timeout: 30) ~> UOWarehouse",
						"source(output(",
						"          crd3c_availqty as integer,",
						"          crd3c_barcode as string,",
						"          crd3c_dataarea as string,",
						"          crd3c_itemvariant as string,",
						"          crd3c_itemvariantlookupname as string,",
						"          crd3c_name as string,",
						"          crd3c_orderqtiesid as string,",
						"          crd3c_quantity as integer,",
						"          crd3c_reqorderqty as integer,",
						"          crd3c_site as string,",
						"          crd3c_variantname as string,",
						"          crd3c_warehouselookupname as string,",
						"          createdbyname as string,",
						"          createdbyyominame as string,",
						"          createdon as timestamp,",
						"          createdonbehalfbyname as string,",
						"          createdonbehalfbyyominame as string,",
						"          hso_size as string,",
						"          importsequencenumber as integer,",
						"          modifiedbyname as string,",
						"          modifiedbyyominame as string,",
						"          modifiedon as timestamp,",
						"          modifiedonbehalfbyname as string,",
						"          modifiedonbehalfbyyominame as string,",
						"          overriddencreatedon as timestamp,",
						"          owneridname as string,",
						"          owneridtype as string,",
						"          owneridyominame as string,",
						"          owningbusinessunitname as string,",
						"          statecode as integer,",
						"          statecodename as string,",
						"          statuscode as integer,",
						"          statuscodename as string,",
						"          timezoneruleversionnumber as integer,",
						"          utcconversiontimezonecode as integer,",
						"          versionnumber as long,",
						"          crd3c_warehouselookup as string,",
						"          createdonbehalfby as string,",
						"          owninguser as string,",
						"          modifiedby as string,",
						"          modifiedonbehalfby as string,",
						"          ownerid as string,",
						"          {@odata.etag} as string,",
						"          createdby as string,",
						"          owningbusinessunit as string,",
						"          crd3c_itemvariantlookup as string,",
						"          owningteam as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     store: 'dynamics',",
						"     format: 'dynamicsformat',",
						"     entity: 'crd3c_orderqties',",
						"     timeout: 30,",
						"     query: (concat('<fetch version=\"1.0\" output-format=\"xml-platform\" mapping=\"logical\" distinct=\"false\"><entity name=\"crd3c_orderqties\"><attribute name=\"crd3c_orderqtiesid\" /><attribute name=\"crd3c_dataarea\" /><attribute name=\"crd3c_site\" /><attribute name=\"crd3c_name\" /><attribute name=\"crd3c_itemvariant\" /><attribute name=\"crd3c_quantity\" /><attribute name=\"crd3c_barcode\" /><attribute name=\"createdon\" /><order attribute=\"crd3c_name\" descending=\"false\" /><filter type=\"and\"><condition attribute=\"crd3c_site\" operator=\"eq\" value=\"',$Store,'\" /><condition attribute=\"crd3c_dataarea\" operator=\"eq\" value=\"',$Company,'\" /></filter></entity></fetch>'))) ~> RecommendedOrderQty",
						"source(output(",
						"          crd3c_company as string,",
						"          crd3c_dataimportexecutionid as string,",
						"          crd3c_name as string,",
						"          crd3c_store as string,",
						"          crd3c_triggersource as string,",
						"          crd3c_warehouse as string,",
						"          createdbyname as string,",
						"          createdbyyominame as string,",
						"          createdon as timestamp,",
						"          createdonbehalfbyname as string,",
						"          createdonbehalfbyyominame as string,",
						"          hso_companywarehouse as string,",
						"          hso_purchaseorder as boolean,",
						"          hso_purchaseordername as string,",
						"          importsequencenumber as integer,",
						"          modifiedbyname as string,",
						"          modifiedbyyominame as string,",
						"          modifiedon as timestamp,",
						"          modifiedonbehalfbyname as string,",
						"          modifiedonbehalfbyyominame as string,",
						"          overriddencreatedon as timestamp,",
						"          owneridname as string,",
						"          owneridtype as string,",
						"          owneridyominame as string,",
						"          owningbusinessunitname as string,",
						"          statecode as integer,",
						"          statecodename as string,",
						"          statuscode as integer,",
						"          statuscodename as string,",
						"          timezoneruleversionnumber as integer,",
						"          utcconversiontimezonecode as integer,",
						"          versionnumber as long,",
						"          createdonbehalfby as string,",
						"          owninguser as string,",
						"          modifiedby as string,",
						"          modifiedonbehalfby as string,",
						"          ownerid as string,",
						"          {@odata.etag} as string,",
						"          createdby as string,",
						"          owningbusinessunit as string,",
						"          owningteam as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false) ~> DataImportExecutions",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          sysdatastatecode as long,",
						"          itemdataareaid as string,",
						"          itemgroupdataareaid as string,",
						"          itemgroupid as string,",
						"          itemid as string,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/inventitemgroupitem_partitioned') ~> InventItemGroupItem",
						"Inventsum derive(ItemSize = concat(itemid,coalesce( concat( '_',inventsizeid),'')),",
						"          DATAAREAID = upper(dataareaid),",
						"          INVENTLOCATIONID = upper(inventlocationid)) ~> ItemSize",
						"filter1 select(mapColumn(",
						"          DATAAREAID = ItemSize@DATAAREAID,",
						"          ITEMID = itemid,",
						"          INVENTSIZEID = inventsizeid,",
						"          INVENTLOCATIONID = ItemSize@INVENTLOCATIONID,",
						"          INVENTSITEID = inventsiteid,",
						"          AVAILPHYSICAL = availphysical,",
						"          ItemSize,",
						"          ORDERED = ordered",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectInventSum",
						"selectInventSum, filterMinOrderQty join(lower(DATAAREAID) == lower(dataarea)",
						"     && lower(ItemSize) == lower(itemvariant)",
						"     && lower(INVENTLOCATIONID) == lower(crd3c_site),",
						"     joinType:'right',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> joinInventSumRecorderQty",
						"derivedColumn5 filter((coalesce(AVAILPHYSICAL,0) + coalesce(ORDERED,0)) < MinOrderQty) ~> filterJoinInventSum",
						"EcoResProduct select(mapColumn(",
						"          DISPLAYPRODUCTNUMBER = displayproductnumber,",
						"          SEARCHNAME = searchname,",
						"          RECID = recid,",
						"          PARTITION = partition",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectEcoResProduct",
						"EcoResProductTranslation filter(equals(languageid, 'en-US')) ~> filterEcoResProductTranslation",
						"filterEcoResProductTranslation select(mapColumn(",
						"          DESCRIPTION = description,",
						"          PRODUCT = product,",
						"          PARTITION = partition",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectEcoResProductTranslation",
						"selectEcoResProduct, selectEcoResProductTranslation join(RECID == PRODUCT,",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"join1 select(mapColumn(",
						"          ITEMID = DISPLAYPRODUCTNUMBER,",
						"          DESCRIPTION,",
						"          SEARCHNAME",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectProductDescription",
						"filterJoinInventSum, selectProductDescription join(lower(Item) == lower(selectProductDescription@ITEMID),",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> StockLessThanMinimum",
						"StockLessThanMinimum, Warehouses join(lower(crd3c_site) == lower(Warehouses@INVENTLOCATIONID),",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> joinWhs",
						"joinWhs, selectSTKWhs join(lower(itemvariant) == lower(STKItemSize)",
						"     && lower(FromWhs) == lower(STKINVENTLOCATIONID)",
						"     && lower(dataarea) == lower(STKDATAAREAID),",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join2",
						"selectInventSum select(mapColumn(",
						"          STKDATAAREAID = DATAAREAID,",
						"          STKITEMID = ITEMID,",
						"          STKINVENTSIZEID = INVENTSIZEID,",
						"          STKINVENTLOCATIONID = INVENTLOCATIONID,",
						"          STKAVAILPHYSICAL = AVAILPHYSICAL,",
						"          STKItemSize = ItemSize",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectSTKWhs",
						"lookupInventItemGrp select(mapColumn(",
						"          cr5b1_dataarea = dataarea,",
						"          cr5b1_item = Item,",
						"          cr5b1_size = STKINVENTSIZEID,",
						"          cr5b1_site = Warehouses@INVENTSITEID,",
						"          crd3c_storeavailqty = AVAILPHYSICAL,",
						"          cr5b1_itemvariant = itemvariant,",
						"          crd3c_storeminqty = MinOrderQty,",
						"          cr5b1_itemdescription = DESCRIPTION,",
						"          cr5b1_towhs = Warehouses@INVENTLOCATIONID,",
						"          cr5b1_fromwhs = FromWhs,",
						"          crd3c_fromwhsstockqty = STKAVAILPHYSICAL,",
						"          crd3c_inboundorderqty = ORDERED,",
						"          crd3c_batchid,",
						"          hso_barcode = crd3c_barcode,",
						"          hso_purchaseorder = SEARCHNAME,",
						"          hso_itemgroupid = itemgroupid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectCols",
						"crd3cstoreavailqtyzero derive(crd3c_name = uuid(),",
						"          crd3c_toqty = iif((crd3c_storeminqty-(crd3c_storeavailqtyzero +crd3c_inboundorderqty )) > crd3c_fromwhsstockqty, crd3c_fromwhsstockqty, (crd3c_storeminqty-(crd3c_storeavailqtyzero +crd3c_inboundorderqty ))),",
						"          cr5b1_createddate = currentTimestamp(),",
						"          crd3c_transferorderid = '00000000-0000-0000-0000-000000000000',",
						"          hso_purchaseorder = iif($OrderType == 'TRANSFER ORDER', false(), true()),",
						"          hso_batchnumber = 1) ~> derivedColumn2",
						"WhsUpperDataArea select(mapColumn(",
						"          crd3c_uowarehousesid,",
						"          crd3c_dataarea,",
						"          crd3c_site,",
						"          crd3c_warehousename,",
						"          crd3c_name,",
						"          crd3c_sourcewh,",
						"          hso_ordertypesplitname,",
						"          hso_ordertypesplit,",
						"          hso_sourceicwarehouse",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectWarehouse",
						"selectWarehouse filter(!isNull(crd3c_sourcewh) && !equals(crd3c_sourcewh, '')) ~> filterWarehouse",
						"filterWarehouse, selectSourceWarehouse join(crd3c_sourcewh == source_crd3c_uowarehousesid,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join3",
						"selectWarehouse select(mapColumn(",
						"          source_crd3c_uowarehousesid = crd3c_uowarehousesid,",
						"          source_crd3c_dataarea = crd3c_dataarea,",
						"          source_crd3c_site = crd3c_site,",
						"          source_crd3c_warehousename = crd3c_warehousename,",
						"          source_crd3c_name = crd3c_name,",
						"          source_crd3c_sourcewh = crd3c_sourcewh,",
						"          source_hso_sourceicwarehouse = hso_sourceicwarehouse",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectSourceWarehouse",
						"derivedColumn3 select(mapColumn(",
						"          INVENTLOCATIONID = crd3c_name,",
						"          DATAAREAID = crd3c_dataarea,",
						"          INVENTSITEID = crd3c_site,",
						"          FromWhs = source_crd3c_name,",
						"          warehousename = crd3c_warehousename,",
						"          source_dataarea = source_crd3c_dataarea,",
						"          source_site = source_crd3c_site,",
						"          source_warehousename = source_crd3c_warehousename,",
						"          crd3c_batchid,",
						"          hso_ordertypesplitname,",
						"          hso_ordertypesplit",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectWarehouseCombined",
						"RecommendedOrderQty select(mapColumn(",
						"          crd3c_name,",
						"          crd3c_site,",
						"          itemvariant = crd3c_itemvariant,",
						"          MinOrderQty = crd3c_quantity,",
						"          dataarea = crd3c_dataarea,",
						"          crd3c_barcode",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectMinOrderQty",
						"MinOrderUpperDataArea filter((MinOrderQty > 0) && (equals(upper(dataarea) , upper($Company)) || equals(upper($Company) , \"ALL\") ) && (equals(crd3c_site , upper($Store))  ||  equals(upper($Store) , \"ALL\"))) ~> filterMinOrderQty",
						"UOWarehouse derive(crd3c_dataarea = upper(crd3c_dataarea),",
						"          crd3c_site = upper(crd3c_site),",
						"          crd3c_name = upper(crd3c_name)) ~> WhsUpperDataArea",
						"selectMinOrderQty derive(dataarea = upper(dataarea),",
						"          crd3c_site = upper(crd3c_site),",
						"          Item = substringIndex(crd3c_name, '_', 1)) ~> MinOrderUpperDataArea",
						"derivedColumn2 aggregate(groupBy(cr5b1_dataarea,",
						"          cr5b1_towhs,",
						"          cr5b1_fromwhs,",
						"          hso_purchaseorder,",
						"          crd3c_batchid),",
						"     each(match((name!=\"cr5b1_dataarea\")&&(name!=\"cr5b1_towhs\")&&(name!=\"cr5b1_fromwhs\")&&(name!=\"hso_purchaseorder\")&&(name!=\"crd3c_batchid\")), $$ = first($$))) ~> aggregate1",
						"aggregate1 select(mapColumn(",
						"          crd3c_company = cr5b1_dataarea,",
						"          crd3c_store = cr5b1_towhs,",
						"          crd3c_warehouse = cr5b1_fromwhs,",
						"          crd3c_name = crd3c_batchid,",
						"          hso_purchaseorder",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select2",
						"ItemSize filter((equals(ItemSize@DATAAREAID , upper($Company)) || equals(upper($Company) , \"ALL\") ) && ((equals(ItemSize@INVENTLOCATIONID , upper($Store))  ||  equals(upper($Store) , \"ALL\")) \r",
						"|| (equals(ItemSize@INVENTLOCATIONID , upper($Warehouse))  ||  equals(upper($Warehouse) , \"ALL\")))) ~> filter1",
						"filter3 derive(crd3c_batchid = uuid()) ~> derivedColumn3",
						"derivedColumn2 filter(crd3c_toqty > 0) ~> filter2",
						"selectWarehouse filter(equals(crd3c_name,$Store) && equalsIgnoreCase(crd3c_dataarea,$Company)) ~> filteronStoreParameter",
						"selectSourceWarehouse filter(equals(source_crd3c_name,$Warehouse)) ~> filteronWarehouseParameter",
						"filteronStoreParameter, filteronWarehouseParameter join(equals(crd3c_name,$Store) && equals(source_crd3c_name,$Warehouse),",
						"     joinType:'cross',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join4",
						"join4 derive(crd3c_batchid = uuid()) ~> derivedColumn4",
						"derivedColumn4 select(mapColumn(",
						"          INVENTLOCATIONID = crd3c_name,",
						"          DATAAREAID = crd3c_dataarea,",
						"          INVENTSITEID = crd3c_site,",
						"          FromWhs = source_crd3c_name,",
						"          warehousename = crd3c_warehousename,",
						"          source_dataarea = source_crd3c_dataarea,",
						"          source_site = source_crd3c_site,",
						"          source_warehousename = source_crd3c_warehousename,",
						"          crd3c_batchid,",
						"          hso_ordertypesplitname,",
						"          hso_ordertypesplit,",
						"          source_icwarehouse = source_hso_sourceicwarehouse",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectWarehouseOnParameters",
						"join3 filter((equals(crd3c_dataarea , upper($Company)) || equals(upper($Company) , \"ALL\") ) ",
						"&& (equals(crd3c_name , upper($Store))  ||  equals(upper($Store) , \"ALL\")) ",
						"&& (equals(source_crd3c_name , upper($Warehouse))  ||  equals(upper($Warehouse) , \"ALL\"))) ~> filter3",
						"selectWarehouseCombined, SelectWarehouseOnParameters union(byName: true)~> union1",
						"union1 aggregate(groupBy(INVENTLOCATIONID,",
						"          DATAAREAID,",
						"          FromWhs,",
						"          INVENTSITEID),",
						"     crd3c_batchid = max(crd3c_batchid)) ~> Warehouses",
						"select2 derive(crd3c_triggersource = $TriggerSource) ~> triggersource",
						"selectCols derive(crd3c_storeavailqtyzero = iif(crd3c_storeavailqty <0 ,crd3c_storeavailqty*0 ,crd3c_storeavailqty  )) ~> crd3cstoreavailqtyzero",
						"filter2 select(mapColumn(",
						"          cr5b1_dataarea,",
						"          cr5b1_item,",
						"          cr5b1_size,",
						"          cr5b1_site,",
						"          crd3c_storeavailqty,",
						"          cr5b1_itemvariant,",
						"          crd3c_storeminqty,",
						"          cr5b1_itemdescription,",
						"          cr5b1_towhs,",
						"          cr5b1_fromwhs,",
						"          crd3c_fromwhsstockqty,",
						"          crd3c_inboundorderqty,",
						"          crd3c_batchid,",
						"          crd3c_name,",
						"          crd3c_toqty,",
						"          cr5b1_createddate,",
						"          crd3c_transferorderid,",
						"          hso_barcode,",
						"          hso_batchnumber,",
						"          hso_itemgroupid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select3",
						"joinInventSumRecorderQty derive(AVAILPHYSICAL = coalesce(AVAILPHYSICAL,0),",
						"          ORDERED = coalesce(ORDERED,0)) ~> derivedColumn5",
						"DataImportExecutions select(mapColumn(",
						"          hso_purchaseorder",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectPOBoolean",
						"InventItemGroupItem select(mapColumn(",
						"          itemid,",
						"          itemgroupid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectInvItemGrpCols",
						"join2, selectInvItemGrpCols lookup(lower(Item) == lower(selectInvItemGrpCols@itemid),",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> lookupInventItemGrp",
						"triggersource sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     store: 'dynamics',",
						"     format: 'dynamicsformat',",
						"     entity: 'crd3c_dataimportexecution',",
						"     timeout: 30,",
						"     deletable: false,",
						"     insertable: true,",
						"     updateable: false,",
						"     upsertable: false,",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     saveOrder: 0,",
						"     mapColumn(",
						"          crd3c_company,",
						"          crd3c_store,",
						"          crd3c_warehouse,",
						"          crd3c_name,",
						"          crd3c_triggersource,",
						"          hso_purchaseorder",
						"     ),",
						"     partitionBy('hash', 1)) ~> DataExecutionsTO",
						"select3 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delimited',",
						"     container: 'whsstockreplenish',",
						"     columnDelimiter: ';',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true,",
						"     partitionFileNames:[(concat($filename, '.csv'))],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     saveOrder: 0,",
						"     partitionBy('hash', 1)) ~> TransferOrdersSink"
					]
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/CreateUOItemsCsv')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "ecoResProduct"
						},
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "EcoResProductVariantDimensionValue"
						},
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "EcoResSize"
						},
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "Translation"
						},
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "InventItemBarcode"
						},
						{
							"dataset": {
								"referenceName": "LegalEntity",
								"type": "DatasetReference"
							},
							"name": "LegalEntity"
						},
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "EcoResDistinctProduct"
						},
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "EcoResProductVariantSize"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "TempCsvFile",
								"type": "DatasetReference"
							},
							"name": "sinkUOItem"
						}
					],
					"transformations": [
						{
							"name": "selectecoResProductCols"
						},
						{
							"name": "filterEcoResProductVariantDimensionValue"
						},
						{
							"name": "selectEcoResProductVariantDimensionValue"
						},
						{
							"name": "selectEcoResSize"
						},
						{
							"name": "joinSize"
						},
						{
							"name": "joinSizeVariant"
						},
						{
							"name": "selectFinal"
						},
						{
							"name": "selectTranslation"
						},
						{
							"name": "filterTranslation",
							"description": "Add for the filter"
						},
						{
							"name": "joinTranslation"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "selectItemBarcode"
						},
						{
							"name": "joinItemBarcodeEcoResProduct"
						},
						{
							"name": "selectItemBarcodeEcoResProduct"
						},
						{
							"name": "join1"
						},
						{
							"name": "selectActiveLegalEntity"
						},
						{
							"name": "select1"
						},
						{
							"name": "selectEcoResDistinctProduct"
						},
						{
							"name": "joinEcoResProducts"
						},
						{
							"name": "selectProducts"
						},
						{
							"name": "selectEcoResProductVariantSize"
						},
						{
							"name": "joinForSize"
						}
					],
					"scriptLines": [
						"parameters{",
						"     Container as string",
						"}",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          pdscwproduct as long,",
						"          producttype as long,",
						"          servicetype as long,",
						"          sunplmsyncwithplm as long,",
						"          sysdatastatecode as long,",
						"          displayproductnumber as string,",
						"          instancerelationtype as long,",
						"          searchname as string,",
						"          engchgproductownerid as string,",
						"          engchgproductcategorydetails as long,",
						"          engchgproductreleasepolicy as long,",
						"          engchgproductreadinesspolicy as long,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/ecoresproduct_partitioned',",
						"     manifestType: 'manifest') ~> ecoResProduct",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          sysdatastatecode as long,",
						"          distinctproductvariant as long,",
						"          instancerelationtype as long,",
						"          productdimensionattribute as long,",
						"          retailweight as long,",
						"          retaildisplayorder as decimal(38,6),",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/ecoresproductvariantdimensionvalue_partitioned',",
						"     manifestType: 'manifest') ~> EcoResProductVariantDimensionValue",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          sysdatastatecode as long,",
						"          name as string,",
						"          displayorder as decimal(38,6),",
						"          url as string,",
						"          hexcode as string,",
						"          refinergroup as string,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/ecoressize_partitioned',",
						"     manifestType: 'manifest') ~> EcoResSize",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          sysdatastatecode as long,",
						"          description as string,",
						"          languageid as string,",
						"          name as string,",
						"          product as long,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/ecoresproducttranslation_partitioned',",
						"     manifestType: 'manifest') ~> Translation",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          blocked as long,",
						"          retailshowforitem as long,",
						"          useforinput as long,",
						"          useforprinting as long,",
						"          hsoisuniqueidentifier as long,",
						"          sysdatastatecode as long,",
						"          barcodesetupid as string,",
						"          description as string,",
						"          inventdimid as string,",
						"          itembarcode as string,",
						"          itemid as string,",
						"          qty as decimal(38,6),",
						"          retailvariantid as string,",
						"          unitid as string,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/inventitembarcode_partitioned',",
						"     manifestType: 'manifest') ~> InventItemBarcode",
						"source(output(",
						"          {@odata.etag} as string,",
						"          crd3c_description as string,",
						"          crd3c_legalentitiesid as string,",
						"          crd3c_legalentity as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     query: '<fetch version=\"1.0\" output-format=\"xml-platform\" mapping=\"logical\" distinct=\"false\">\\n  <entity name=\"crd3c_legalentities\">\\n    <attribute name=\"crd3c_legalentitiesid\" />\\n    <attribute name=\"crd3c_legalentity\" />\\n    <attribute name=\"crd3c_description\" />\\n    <order attribute=\"crd3c_legalentity\" descending=\"false\" />\\n    <filter type=\"and\">\\n      <condition attribute=\"statecode\" operator=\"eq\" value=\"0\" />\\n    </filter>\\n  </entity>\\n</fetch>') ~> LegalEntity",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          sysdatastatecode as long,",
						"          hsoitembarcode as string,",
						"          hsolegacyproductnumber as string,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/ecoresdistinctproduct_partitioned') ~> EcoResDistinctProduct",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          sysdatastatecode as long,",
						"          size as long,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/ecoresproductvariantsize_partitioned') ~> EcoResProductVariantSize",
						"ecoResProduct select(mapColumn(",
						"          RECID = recid,",
						"          crd3c_name = displayproductnumber,",
						"          PARTITION = partition",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectecoResProductCols",
						"EcoResProductVariantDimensionValue filter(instancerelationtype == 8224) ~> filterEcoResProductVariantDimensionValue",
						"joinForSize select(mapColumn(",
						"          DISTINCTPRODUCTVARIANT = distinctproductvariant,",
						"          SIZE_,",
						"          PARTITION = partition",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectEcoResProductVariantDimensionValue",
						"EcoResSize select(mapColumn(",
						"          RECID = recid,",
						"          PRODUCTSIZEID = name,",
						"          PARTITION = partition",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectEcoResSize",
						"selectItemBarcodeEcoResProduct, joinSizeVariant join(selectItemBarcodeEcoResProduct@RECID == DISTINCTPRODUCTVARIANT",
						"     && selectItemBarcodeEcoResProduct@PARTITION == selectEcoResProductVariantDimensionValue@PARTITION,",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> joinSize",
						"selectEcoResProductVariantDimensionValue, selectEcoResSize join(SIZE_ == RECID",
						"     && selectEcoResProductVariantDimensionValue@PARTITION == selectEcoResSize@PARTITION,",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> joinSizeVariant",
						"joinTranslation select(mapColumn(",
						"          crd3c_name,",
						"          crd3c_variantname,",
						"          crd3c_barcode,",
						"          crd3c_dataarea,",
						"          crd3c_size = PRODUCTSIZEID,",
						"          crd3c_productnumber = ITEMID",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectFinal",
						"filterTranslation select(mapColumn(",
						"          crd3c_variantname = name,",
						"          PRODUCT = product,",
						"          PARTITION = partition",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectTranslation",
						"Translation filter(languageid == \"en-US\") ~> filterTranslation",
						"joinSize, selectTranslation join(selectItemBarcodeEcoResProduct@RECID == PRODUCT",
						"     && selectItemBarcodeEcoResProduct@PARTITION == selectTranslation@PARTITION,",
						"     joinType:'left',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> joinTranslation",
						"select1 derive(crd3c_simpleid = concat(crd3c_productnumber,iif(equals( coalesce(crd3c_size,\"\"),\"\"),\"\",concat(\"_\",crd3c_size)))) ~> derivedColumn1",
						"InventItemBarcode select(mapColumn(",
						"          ITEMBARCODE = itembarcode,",
						"          ITEMID = itemid,",
						"          crd3c_dataarea = dataareaid,",
						"          PARTITION = partition",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectItemBarcode",
						"selectItemBarcode, selectProducts join(ITEMBARCODE == HSOITEMBARCODE,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> joinItemBarcodeEcoResProduct",
						"joinItemBarcodeEcoResProduct select(mapColumn(",
						"          RECID,",
						"          crd3c_name,",
						"          crd3c_barcode = ITEMBARCODE,",
						"          PARTITION = selectItemBarcode@PARTITION,",
						"          crd3c_dataarea,",
						"          ITEMID",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectItemBarcodeEcoResProduct",
						"selectFinal, selectActiveLegalEntity join(upper(crd3c_dataarea) == upper(crd3c_legalentity),",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"LegalEntity select(mapColumn(",
						"          crd3c_legalentity",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectActiveLegalEntity",
						"join1 select(mapColumn(",
						"          crd3c_name,",
						"          crd3c_variantname,",
						"          crd3c_barcode,",
						"          crd3c_dataarea,",
						"          crd3c_size,",
						"          crd3c_productnumber",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"EcoResDistinctProduct select(mapColumn(",
						"          RECID = recid,",
						"          HSOITEMBARCODE = hsoitembarcode",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectEcoResDistinctProduct",
						"selectecoResProductCols, selectEcoResDistinctProduct join(selectecoResProductCols@RECID == selectEcoResDistinctProduct@RECID,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> joinEcoResProducts",
						"joinEcoResProducts select(mapColumn(",
						"          RECID = selectecoResProductCols@RECID,",
						"          crd3c_name,",
						"          PARTITION,",
						"          HSOITEMBARCODE",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectProducts",
						"EcoResProductVariantSize select(mapColumn(",
						"          recid,",
						"          SIZE_ = size",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectEcoResProductVariantSize",
						"filterEcoResProductVariantDimensionValue, selectEcoResProductVariantSize join(EcoResProductVariantDimensionValue@recid == selectEcoResProductVariantSize@recid,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> joinForSize",
						"derivedColumn1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     input(",
						"          cr5b1_dataarea as string,",
						"          cr5b1_item as string,",
						"          cr5b1_size as string,",
						"          cr5b1_site as string,",
						"          crd3c_storeavailqty as string,",
						"          cr5b1_itemvariant as string,",
						"          crd3c_storeminqty as string,",
						"          cr5b1_itemdescription as string,",
						"          cr5b1_towhs as string,",
						"          cr5b1_fromwhs as string,",
						"          crd3c_fromwhsstockqty as string,",
						"          crd3c_inboundorderqty as string,",
						"          crd3c_batchid as string,",
						"          crd3c_name as string,",
						"          crd3c_toqty as string,",
						"          cr5b1_createddate as string,",
						"          crd3c_transferorderid as string,",
						"          hso_barcode as string,",
						"          hso_batchnumber as string,",
						"          hso_itemgroupid as string",
						"     ),",
						"     partitionFileNames:['UOItem.csv'],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     partitionBy('hash', 1)) ~> sinkUOItem"
					]
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/DeleteUOItems')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "UOItem",
								"type": "DatasetReference"
							},
							"name": "UOItem"
						},
						{
							"dataset": {
								"referenceName": "UOItemCsvFile",
								"type": "DatasetReference"
							},
							"name": "UOItemCsv"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "UOItem",
								"type": "DatasetReference"
							},
							"name": "sinkDelete"
						}
					],
					"transformations": [
						{
							"name": "exists"
						},
						{
							"name": "MarkRecordsToDelete"
						},
						{
							"name": "select1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          crd3c_barcode as string,",
						"          crd3c_dataarea as string,",
						"          crd3c_datastatus as integer,",
						"          crd3c_datastatusname as string,",
						"          crd3c_gender as string,",
						"          crd3c_name as string,",
						"          crd3c_productnumber as string,",
						"          crd3c_simpleid as string,",
						"          crd3c_size as string,",
						"          crd3c_uoitemid as string,",
						"          crd3c_variantname as string,",
						"          createdbyname as string,",
						"          createdbyyominame as string,",
						"          createdon as timestamp,",
						"          createdonbehalfbyname as string,",
						"          createdonbehalfbyyominame as string,",
						"          importsequencenumber as integer,",
						"          modifiedbyname as string,",
						"          modifiedbyyominame as string,",
						"          modifiedon as timestamp,",
						"          modifiedonbehalfbyname as string,",
						"          modifiedonbehalfbyyominame as string,",
						"          overriddencreatedon as timestamp,",
						"          owneridname as string,",
						"          owneridtype as string,",
						"          owneridyominame as string,",
						"          owningbusinessunitname as string,",
						"          statecode as integer,",
						"          statecodename as string,",
						"          statuscode as integer,",
						"          statuscodename as string,",
						"          timezoneruleversionnumber as integer,",
						"          utcconversiontimezonecode as integer,",
						"          versionnumber as long,",
						"          createdonbehalfby as string,",
						"          owninguser as string,",
						"          modifiedby as string,",
						"          modifiedonbehalfby as string,",
						"          ownerid as string,",
						"          {@odata.etag} as string,",
						"          createdby as string,",
						"          owningbusinessunit as string,",
						"          owningteam as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false) ~> UOItem",
						"source(output(",
						"          crd3c_name as string,",
						"          crd3c_variantname as string,",
						"          crd3c_barcode as string,",
						"          crd3c_productnumber as string,",
						"          crd3c_dataarea as string,",
						"          crd3c_size as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     wildcardPaths:['UOItem.csv']) ~> UOItemCsv",
						"UOItem, UOItemCsv exists(UOItem@crd3c_dataarea == UOItemCsv@crd3c_dataarea",
						"     && UOItem@crd3c_name == UOItemCsv@crd3c_name,",
						"     negate:true,",
						"     broadcast: 'auto')~> exists",
						"exists alterRow(deleteIf(true())) ~> MarkRecordsToDelete",
						"MarkRecordsToDelete select(mapColumn(",
						"          crd3c_name,",
						"          {@odata.etag},",
						"          crd3c_dataarea",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     deletable:true,",
						"     insertable:false,",
						"     updateable:false,",
						"     upsertable:false,",
						"     alternateKeyName: 'crd3c_le_variant',",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> sinkDelete"
					]
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/DeleteVendors')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "VendTable"
						},
						{
							"dataset": {
								"referenceName": "Vendors",
								"type": "DatasetReference"
							},
							"name": "Vendors"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "Vendors",
								"type": "DatasetReference"
							},
							"name": "DeleteVendors"
						}
					],
					"transformations": [
						{
							"name": "selectVendors"
						},
						{
							"name": "notExists"
						},
						{
							"name": "deleterows"
						},
						{
							"name": "selectDelete"
						}
					],
					"scriptLines": [
						"parameters{",
						"     Container as string",
						"}",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          bidonly as long,",
						"          blocked as long,",
						"          cashaccountingregime_es as long,",
						"          changerequestallowoverride as long,",
						"          changerequestenabled as long,",
						"          changerequestoverride as long,",
						"          cisstatus as long,",
						"          companytype_mx as long,",
						"          disabledowned as long,",
						"          fatcafilingrequirement as long,",
						"          femaleowned as long,",
						"          foreignentityindicator as long,",
						"          foreignresident_ru as long,",
						"          heir_it as long,",
						"          hubzone as long,",
						"          icmscontributor_br as long,",
						"          incltax as long,",
						"          inventprofiletype_ru as long,",
						"          ispaymfeecovered_jp as long,",
						"          isresident_lv as long,",
						"          locallyowned as long,",
						"          mandatoryvatdate_pl as long,",
						"          matchingpolicy as long,",
						"          minorityowned as long,",
						"          nontaxable_br as long,",
						"          offsetaccounttype as long,",
						"          onetimevendor as long,",
						"          operationtype_mx as long,",
						"          presencetype_br as long,",
						"          purchamountpurchaseorder as long,",
						"          secondtin as long,",
						"          servicecodeondlvaddress_br as long,",
						"          smallbusiness as long,",
						"          tax1099namechoice as long,",
						"          tax1099reports as long,",
						"          taxidtype as long,",
						"          taxwithholdcalculate as long,",
						"          taxwithholdvendortype_th as long,",
						"          unitedvatinvoice_lt as long,",
						"          usecashdisc as long,",
						"          vatpartnerkind_ru as long,",
						"          vattaxagent_ru as long,",
						"          vendconsumption_br as long,",
						"          vendortype_mx as long,",
						"          veteranowned as long,",
						"          w9 as long,",
						"          w9included as long,",
						"          vendvendorcollaborationtype as long,",
						"          withholdingtaxpayertype_mx as long,",
						"          originalvendorinreporting_it as long,",
						"          isselfinvoicevendor_it as long,",
						"          workflowstate as long,",
						"          iscprb_br as long,",
						"          cxmlorderenable as long,",
						"          vatnumtabletype as long,",
						"          overridesalestax as long,",
						"          accruesalestaxtype as long,",
						"          taxvendorchargetaxtolerancevalidation as long,",
						"          revenuetypology_it as long,",
						"          ispublicsector_it as long,",
						"          istaxationoverpayroll_br as long,",
						"          einvoiceregister_it as long,",
						"          isunidentifiedbenef_br as long,",
						"          itmimportcostingvendor as long,",
						"          itmservicesprovider as long,",
						"          itmvendtype as long,",
						"          exf_porequired as long,",
						"          exf_classified as long,",
						"          exf_vendorportalinvoicesmustbeapproved as long,",
						"          exf_istmsfreight as long,",
						"          sunplmsyncwithplm as long,",
						"          hsooscaenabled as long,",
						"          hsogitincludevendorinquery as long,",
						"          oninterface as long,",
						"          onsourcingdeliverytype as long,",
						"          onsourcingupdatechain as long,",
						"          onpoplacementenabled as long,",
						"          sysdatastatecode as long,",
						"          taxwithholdgroup as string,",
						"          residenceforeigncountryregionid as string,",
						"          paymtermid as string,",
						"          linedisc as string,",
						"          accountnum as string,",
						"          bankaccount as string,",
						"          bankcentralbankpurposecode as string,",
						"          bankcentralbankpurposetext as string,",
						"          bankcentralbanktranstypecur_ru as string,",
						"          bankorderofpayment_ru as string,",
						"          birthcountycode_it as string,",
						"          birthplace as string,",
						"          blockedreleasedate as timestamp,",
						"          cashdisc as string,",
						"          ccmnum_br as string,",
						"          ciscompanyregnum as string,",
						"          cisnationalinsurancenum as string,",
						"          cisuniquetaxpayerref as string,",
						"          cisverificationdate as timestamp,",
						"          cisverificationnum as string,",
						"          clearingperiod as string,",
						"          cnae_br as string,",
						"          cnpjcpfnum_br as string,",
						"          commercialregister as string,",
						"          commercialregisterinsetnumber as string,",
						"          commercialregistersection as string,",
						"          companychainid as string,",
						"          companyidsiret as string,",
						"          companynafcode as long,",
						"          consday_jp as long,",
						"          contactpersonid as string,",
						"          creditmax as decimal(38,6),",
						"          creditrating as string,",
						"          curp_mx as string,",
						"          currency as string,",
						"          dba as string,",
						"          defaultdimension as long,",
						"          defaultinventstatusid as string,",
						"          destinationcodeid as string,",
						"          diotcountrycode_mx as string,",
						"          dlvmode as string,",
						"          dlvterm as string,",
						"          enddisc as string,",
						"          enterprisenumber as string,",
						"          ethnicoriginid as string,",
						"          factoringaccount as string,",
						"          finecode_br as string,",
						"          fiscalcode as string,",
						"          foreignerid_br as string,",
						"          foreigntaxregistration_mx as string,",
						"          freightzone as string,",
						"          ienum_br as string,",
						"          insscei_br as string,",
						"          intbank_lv as string,",
						"          interestcode_br as string,",
						"          inventlocation as string,",
						"          inventprofileid_ru as string,",
						"          inventsiteid as string,",
						"          invoiceaccount as string,",
						"          itembuyergroupid as string,",
						"          lineofbusinessid as string,",
						"          lvpaymtranscodes as long,",
						"          maincontactworker as long,",
						"          markupgroup as string,",
						"          memo as string,",
						"          multilinedisc as string,",
						"          namecontrol as string,",
						"          nationality_mx as string,",
						"          nit_br as string,",
						"          numbersequencegroup as string,",
						"          offsetledgerdimension as long,",
						"          organizationnumber as string,",
						"          orgid as string,",
						"          party as long,",
						"          paymdayid as string,",
						"          paymid as string,",
						"          paymmode as string,",
						"          paymsched as string,",
						"          paymspec as string,",
						"          pricegroup as string,",
						"          purchcalendarid as string,",
						"          purchpoolid as string,",
						"          rfc_mx as string,",
						"          segmentid as string,",
						"          separatedivisionid_ru as string,",
						"          stateinscription_mx as string,",
						"          structdepartment_ru as string,",
						"          subsegmentid as string,",
						"          suppitemgroupid as string,",
						"          tamrebategroupid as string,",
						"          tax1099fields as long,",
						"          tax1099regnum as string,",
						"          taxgroup as string,",
						"          taxperiodpaymentcode_pl as string,",
						"          vatnum as string,",
						"          vatoperationcode_ru as string,",
						"          vendexceptiongroup as long,",
						"          vendgroup as string,",
						"          vendincomecode_br as string,",
						"          vendinvoicedeclaration_is as long,",
						"          venditemgroupid as string,",
						"          vendorportaladministratorrecid as long,",
						"          vendpaymfeegroup_jp as string,",
						"          vendpricetolerancegroupid as string,",
						"          youraccountnum as string,",
						"          legalrepresentativecurp_mx as string,",
						"          legalrepresentativename_mx as string,",
						"          legalrepresentativerfc_mx as string,",
						"          withholdingtypecode_mx as string,",
						"          birthdate as timestamp,",
						"          regnum_w as string,",
						"          enterprisecode as string,",
						"          vatnumrecid as long,",
						"          purchaseshipcalendarid as string,",
						"          taxvendorchargetaxtoleranceamount as decimal(38,6),",
						"          taxvendorchargetaxtolerancepercent as decimal(38,6),",
						"          freenotesgroup_it as string,",
						"          coderevenuetypology_it as string,",
						"          itmfromport as string,",
						"          itmoverundertolerancegroupid as string,",
						"          itmagent as string,",
						"          itmvendaccount as string,",
						"          itmcosttypegroupid as string,",
						"          exf_systemapprovalgroupid as string,",
						"          exf_invoicetype as string,",
						"          gupdiscountvendorclaimgroupname as string,",
						"          hsolocalname as string,",
						"          onsourcingvendaccount as string,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string,",
						"          onsource as string,",
						"          onexternalid as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/vendtable_partitioned',",
						"     manifestType: 'manifest') ~> VendTable",
						"source(output(",
						"          {@odata.etag} as string,",
						"          hso_company as string,",
						"          hso_name as string,",
						"          hso_vendorsid as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     query: '<fetch version=\"1.0\" output-format=\"xml-platform\" mapping=\"logical\" distinct=\"false\">\\n  <entity name=\"hso_vendors\">\\n    <attribute name=\"hso_vendorsid\" />\\n    <attribute name=\"hso_name\" />\\n    <attribute name=\"hso_company\" />\\n    <order attribute=\"hso_name\" descending=\"false\" />\\n  </entity>\\n</fetch>') ~> Vendors",
						"VendTable select(mapColumn(",
						"          ACCOUNTNUM = accountnum,",
						"          DATAAREAID = dataareaid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectVendors",
						"Vendors, selectVendors exists(hso_name == ACCOUNTNUM && upper (hso_company) == upper(DATAAREAID),",
						"     negate:true,",
						"     broadcast: 'auto')~> notExists",
						"notExists alterRow(deleteIf(true())) ~> deleterows",
						"deleterows select(mapColumn(",
						"          hso_name,",
						"          hso_company",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectDelete",
						"selectDelete sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     deletable:true,",
						"     insertable:false,",
						"     updateable:false,",
						"     upsertable:false,",
						"     alternateKeyName: 'hso_vendorsid',",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     saveOrder: 1) ~> DeleteVendors"
					]
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/ItemsONUKONUS')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"folder": {
					"name": "OL/Sample Data"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "UOItem",
								"type": "DatasetReference"
							},
							"name": "ItemONUK"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "storageaccount",
								"type": "LinkedServiceReference"
							},
							"name": "WriteToItemONUK"
						}
					],
					"transformations": [
						{
							"name": "ONUK"
						},
						{
							"name": "SelectKeyColumns"
						}
					],
					"scriptLines": [
						"source(output(",
						"          crd3c_barcode as string,",
						"          crd3c_dataarea as string,",
						"          crd3c_datastatus as integer,",
						"          crd3c_datastatusname as string,",
						"          crd3c_gender as string,",
						"          crd3c_name as string,",
						"          crd3c_productnumber as string,",
						"          crd3c_simpleid as string,",
						"          crd3c_size as string,",
						"          crd3c_uoitemid as string,",
						"          crd3c_variantname as string,",
						"          createdbyname as string,",
						"          createdbyyominame as string,",
						"          createdon as timestamp,",
						"          createdonbehalfbyname as string,",
						"          createdonbehalfbyyominame as string,",
						"          importsequencenumber as integer,",
						"          modifiedbyname as string,",
						"          modifiedbyyominame as string,",
						"          modifiedon as timestamp,",
						"          modifiedonbehalfbyname as string,",
						"          modifiedonbehalfbyyominame as string,",
						"          overriddencreatedon as timestamp,",
						"          owneridname as string,",
						"          owneridtype as string,",
						"          owneridyominame as string,",
						"          owningbusinessunitname as string,",
						"          statecode as integer,",
						"          statecodename as string,",
						"          statuscode as integer,",
						"          statuscodename as string,",
						"          timezoneruleversionnumber as integer,",
						"          utcconversiontimezonecode as integer,",
						"          versionnumber as long,",
						"          createdonbehalfby as string,",
						"          owninguser as string,",
						"          modifiedby as string,",
						"          modifiedonbehalfby as string,",
						"          ownerid as string,",
						"          {@odata.etag} as string,",
						"          createdby as string,",
						"          owningbusinessunit as string,",
						"          owningteam as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false) ~> ItemONUK",
						"ItemONUK filter(crd3c_dataarea == 'onuk' || crd3c_dataarea == 'onus') ~> ONUK",
						"ONUK select(mapColumn(",
						"          crd3c_barcode,",
						"          crd3c_dataarea,",
						"          crd3c_size,",
						"          crd3c_simpleid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectKeyColumns",
						"SelectKeyColumns sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delimited',",
						"     container: 'whsstockreplenish',",
						"     folderPath: 'OL/',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true,",
						"     partitionFileNames:['ForecastSalesONUKONUS.csv'],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     partitionBy('hash', 1)) ~> WriteToItemONUK"
					]
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/Reset MSL when no forecast')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "If there is no forecast for items today, then set their MSL to 0",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "RecommendedOrderQty",
								"type": "DatasetReference"
							},
							"name": "RecommendedOrderQty"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "RecommendedOrderQty",
								"type": "DatasetReference"
							},
							"name": "RecommendedOrderQtyResetMSL"
						}
					],
					"transformations": [
						{
							"name": "GetMSL"
						},
						{
							"name": "Update"
						},
						{
							"name": "ResetMSL"
						},
						{
							"name": "MSLGreaterThan0"
						}
					],
					"scriptLines": [
						"parameters{",
						"     companyFetchXML as string,",
						"     CompanyList as string[],",
						"     StoreList as string[],",
						"     storeFetchXML as string",
						"}",
						"source(output(",
						"          crd3c_availqty as integer,",
						"          crd3c_barcode as string,",
						"          crd3c_dataarea as string,",
						"          crd3c_itemvariant as string,",
						"          crd3c_itemvariantlookupname as string,",
						"          crd3c_name as string,",
						"          crd3c_orderqtiesid as string,",
						"          crd3c_quantity as integer,",
						"          crd3c_reqorderqty as integer,",
						"          crd3c_site as string,",
						"          crd3c_variantname as string,",
						"          crd3c_warehouselookupname as string,",
						"          createdbyname as string,",
						"          createdbyyominame as string,",
						"          createdon as timestamp,",
						"          createdonbehalfbyname as string,",
						"          createdonbehalfbyyominame as string,",
						"          hso_fts as integer,",
						"          hso_hasforecast as boolean,",
						"          hso_hasforecastname as string,",
						"          hso_maxquantity as integer,",
						"          hso_minquantity as integer,",
						"          hso_size as string,",
						"          hso_teststring as string,",
						"          importsequencenumber as integer,",
						"          modifiedbyname as string,",
						"          modifiedbyyominame as string,",
						"          modifiedon as timestamp,",
						"          modifiedonbehalfbyname as string,",
						"          modifiedonbehalfbyyominame as string,",
						"          overriddencreatedon as timestamp,",
						"          owneridname as string,",
						"          owneridtype as string,",
						"          owneridyominame as string,",
						"          owningbusinessunitname as string,",
						"          statecode as integer,",
						"          statecodename as string,",
						"          statuscode as integer,",
						"          statuscodename as string,",
						"          timezoneruleversionnumber as integer,",
						"          utcconversiontimezonecode as integer,",
						"          versionnumber as long,",
						"          crd3c_warehouselookup as string,",
						"          createdonbehalfby as string,",
						"          owninguser as string,",
						"          modifiedby as string,",
						"          modifiedonbehalfby as string,",
						"          ownerid as string,",
						"          {@odata.etag} as string,",
						"          createdby as string,",
						"          owningbusinessunit as string,",
						"          crd3c_itemvariantlookup as string,",
						"          owningteam as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     query: (concat('<fetch version=\"1.0\" output-format=\"xml-platform\" mapping=\"logical\" distinct=\"false\"><entity name=\"crd3c_orderqties\"><attribute name=\"crd3c_orderqtiesid\"/><attribute name=\"crd3c_dataarea\"/><attribute name=\"crd3c_quantity\"/><attribute name=\"crd3c_barcode\"/><attribute name=\"crd3c_site\"/><attribute name=\"crd3c_name\"/><attribute name=\"crd3c_itemvariant\"/><order attribute=\"crd3c_barcode\" descending=\"false\"/><filter type=\"and\"><filter type=\"or\"><condition attribute=\"crd3c_quantity\" operator=\"gt\" value=\"0\"/><condition attribute=\"hso_fts\" operator=\"gt\" value=\"0\"/></filter><condition attribute=\"crd3c_site\" operator=\"in\">',$storeFetchXML,' </condition><condition attribute=\"crd3c_dataarea\" operator=\"in\">',$companyFetchXML,' </condition></filter></entity></fetch>'))) ~> RecommendedOrderQty",
						"RecommendedOrderQty select(mapColumn(",
						"          crd3c_quantity,",
						"          crd3c_barcode,",
						"          crd3c_dataarea,",
						"          crd3c_name,",
						"          crd3c_itemvariant,",
						"          crd3c_site",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> GetMSL",
						"ResetMSL alterRow(updateIf(true())) ~> Update",
						"MSLGreaterThan0 derive(crd3c_quantity = 0) ~> ResetMSL",
						"GetMSL filter(coalesce(crd3c_quantity,0)>0) ~> MSLGreaterThan0",
						"Update sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     deletable:false,",
						"     insertable:false,",
						"     updateable:true,",
						"     upsertable:false,",
						"     alternateKeyName: 'hso_barcodekey',",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> RecommendedOrderQtyResetMSL"
					]
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/RevenuePerProduct')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"folder": {
					"name": "JL/New folder"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "RevenuePerProduct",
								"type": "DatasetReference"
							},
							"name": "RevenuePerProduct"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "storageaccount",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "derivedColumn1"
						},
						{
							"name": "aggregate1"
						},
						{
							"name": "filter1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          TransactionID as short,",
						"          Product as string,",
						"          Price as short,",
						"          Quantity as short,",
						"          CustomerName as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false) ~> RevenuePerProduct",
						"RevenuePerProduct derive(Quantity = coalesce(Quantity, 0)+1) ~> derivedColumn1",
						"derivedColumn1 aggregate(groupBy(Product),",
						"     Price = sum(Price),",
						"          Quantity = avg(Quantity)) ~> aggregate1",
						"aggregate1 filter(Product == 'Laptop') ~> filter1",
						"filter1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delimited',",
						"     container: 'whsstockreplenish',",
						"     folderPath: 'JL',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true,",
						"     partitionFileNames:['Test1.csv'],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     partitionBy('hash', 1)) ~> sink1"
					]
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/RevenuePerProduct1')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"folder": {
					"name": "JL/New folder"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "RevenuePerProduct1",
								"type": "DatasetReference"
							},
							"name": "RevenuePerProduct1"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "storageaccount",
								"type": "LinkedServiceReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "aggregate1"
						}
					],
					"scriptLines": [
						"source(output(",
						"          TransactionID as short,",
						"          Product as string,",
						"          Price as short,",
						"          Quantity as short,",
						"          CustomerName as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false) ~> RevenuePerProduct1",
						"RevenuePerProduct1 aggregate(groupBy(Product),",
						"     Price = sum(Price)) ~> aggregate1",
						"aggregate1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     format: 'delimited',",
						"     container: 'whsstockreplenish',",
						"     folderPath: 'JL',",
						"     columnDelimiter: ',',",
						"     escapeChar: '\\\\',",
						"     quoteChar: '\\\"',",
						"     columnNamesAsHeader: true,",
						"     partitionFileNames:['RevenuePerProductTest011.xls'],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     partitionBy('hash', 1)) ~> sink1"
					]
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/Sync MSL based on forecast sales')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "Lookup activity, array of companies, Dataverse query taking in the array.",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "UOItem",
								"type": "DatasetReference"
							},
							"name": "UOItem"
						},
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "InventDim"
						},
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "ForecastSales"
						},
						{
							"dataset": {
								"referenceName": "UOWarehouses",
								"type": "DatasetReference"
							},
							"name": "UOWarehouses"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "RecomOrderQtyCsvFile_virtualStore",
								"type": "DatasetReference"
							},
							"name": "MSLcreateCSV"
						}
					],
					"transformations": [
						{
							"name": "filterModelCustGroupChannel"
						},
						{
							"name": "SelectItemIdForecastQtyInventDimId"
						},
						{
							"name": "AddMSL"
						},
						{
							"name": "SelectInventSizeIdAndInventDimId"
						},
						{
							"name": "FSGetInventSizeId"
						},
						{
							"name": "MSL"
						},
						{
							"name": "SelectDualPurposeStores"
						},
						{
							"name": "DualPurposeStoresOnly"
						},
						{
							"name": "SelectStoreAndSize"
						},
						{
							"name": "CalculateMSL"
						},
						{
							"name": "joinMSL"
						},
						{
							"name": "filterCompany"
						},
						{
							"name": "JoinDualPurposeStores"
						}
					],
					"scriptLines": [
						"parameters{",
						"     Container as string,",
						"     CompanyList as string[],",
						"     companyFetchXML as string,",
						"     storeList as string[],",
						"     storeFetchXML as string",
						"}",
						"source(output(",
						"          {@odata.etag} as string,",
						"          crd3c_barcode as string,",
						"          crd3c_dataarea as string,",
						"          crd3c_name as string,",
						"          crd3c_productnumber as string,",
						"          crd3c_simpleid as string,",
						"          crd3c_size as string,",
						"          crd3c_uoitemid as string,",
						"          crd3c_variantname as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     query: (concat('<fetch version=\"1.0\" mapping=\"logical\" no-lock=\"false\" distinct=\"true\"><entity name=\"crd3c_uoitem\"><attribute name=\"crd3c_uoitemid\"/><attribute name=\"crd3c_name\"/><attribute name=\"crd3c_simpleid\"/><attribute name=\"crd3c_variantname\"/><attribute name=\"crd3c_dataarea\"/><attribute name=\"crd3c_barcode\"/><attribute name=\"crd3c_size\"/><attribute name=\"crd3c_productnumber\"/><filter type=\"and\"><condition attribute=\"statecode\" operator=\"eq\" value=\"0\"/><condition attribute=\"crd3c_dataarea\" operator=\"in\">',$companyFetchXML,' </condition></filter></entity></fetch>')),",
						"     wildcardPaths:['UOItem.csv']) ~> UOItem",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          hashtype as long,",
						"          sysdatastatecode as long,",
						"          configid as string,",
						"          inventbatchid as string,",
						"          inventcolorid as string,",
						"          inventdimid as string,",
						"          inventgtdid_ru as string,",
						"          inventlocationid as string,",
						"          inventownerid_ru as string,",
						"          inventprofileid_ru as string,",
						"          inventserialid as string,",
						"          inventsiteid as string,",
						"          inventsizeid as string,",
						"          inventstatusid as string,",
						"          inventstyleid as string,",
						"          inventversionid as string,",
						"          licenseplateid as string,",
						"          wmslocationid as string,",
						"          wmspalletid as string,",
						"          sha1hashhex as string,",
						"          inventdimension1 as string,",
						"          inventdimension2 as string,",
						"          inventdimension3 as string,",
						"          inventdimension4 as string,",
						"          inventdimension5 as string,",
						"          inventdimension6 as string,",
						"          inventdimension7 as string,",
						"          inventdimension8 as string,",
						"          inventdimension9 as timestamp,",
						"          inventdimension10 as decimal(38,6),",
						"          inventdimension11 as string,",
						"          inventdimension12 as string,",
						"          sha3hashhex as string,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: 'dataverse-ontest-unqccd0037834be4cec846b41a3ea290',",
						"     folderPath: 'deltalake/inventdim_partitioned') ~> InventDim",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          active as long,",
						"          allocatemethod as long,",
						"          cov as long,",
						"          freqcode as long,",
						"          projforecastbudgettype as long,",
						"          report as long,",
						"          hsoisreturnorder as long,",
						"          sysdatastatecode as long,",
						"          activitynumber as string,",
						"          amount as decimal(38,6),",
						"          comment as string,",
						"          costprice as decimal(38,6),",
						"          covstatus as long,",
						"          currency as string,",
						"          custaccountid as string,",
						"          custgroupid as string,",
						"          defaultdimension as long,",
						"          discamount as decimal(38,6),",
						"          discpercent as decimal(38,6),",
						"          enddate as timestamp,",
						"          expandid as long,",
						"          freq as long,",
						"          inventdimid as string,",
						"          inventqty as decimal(38,6),",
						"          itemallocateid as string,",
						"          itembomid as string,",
						"          itemgroupid as string,",
						"          itemid as string,",
						"          itemrouteid as string,",
						"          keyid as string,",
						"          modelid as string,",
						"          pdscwqty as decimal(38,6),",
						"          pdscwunitid as string,",
						"          priceunit as decimal(38,12),",
						"          projcategoryid as string,",
						"          projforecastcostpaymdate as timestamp,",
						"          projforecasteliminationdate as timestamp,",
						"          projforecastinvoicedate as timestamp,",
						"          projforecastsalespaymdate as timestamp,",
						"          projfundingsource as long,",
						"          projid as string,",
						"          projlinepropertyid as string,",
						"          projtransid as string,",
						"          psarefpurchline as long,",
						"          salesmarkup as decimal(38,6),",
						"          salesprice as decimal(38,6),",
						"          salesqty as decimal(38,6),",
						"          salesunitid as string,",
						"          startdate as timestamp,",
						"          taxgroupid as string,",
						"          taxitemgroupid as string,",
						"          forecastentrynumber as string,",
						"          description as string,",
						"          planningpriority as decimal(38,2),",
						"          itemdescription as string,",
						"          contractlineid as string,",
						"          kittinginventtransid as string,",
						"          kittinglinenum as decimal(38,16),",
						"          suntaforigforecastdate as timestamp,",
						"          suntaforigforecastqty as decimal(38,6),",
						"          suntafforecastchannelid as string,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/forecastsales_partitioned') ~> ForecastSales",
						"source(output(",
						"          {@odata.etag} as string,",
						"          crd3c_dataarea as string,",
						"          crd3c_name as string,",
						"          crd3c_uowarehousesid as string,",
						"          statecode as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     query: ('<fetch version=\"1.0\" mapping=\"logical\" distinct=\"true\" savedqueryid=\"41c7362d-ac5a-ed11-9562-000d3aba35c5\" no-lock=\"false\"><entity name=\"crd3c_uowarehouses\"><attribute name=\"statecode\"/><attribute name=\"crd3c_uowarehousesid\"/><attribute name=\"crd3c_name\"/><attribute name=\"crd3c_dataarea\"/><filter type=\"and\"><condition attribute=\"statecode\" operator=\"eq\" value=\"0\"/><condition attribute=\"hso_dualpurpose\" operator=\"eq\" value=\"1\"/><condition attribute=\"crd3c_warehousetype\" operator=\"eq\" value=\"STOCK\"/><condition attribute=\"hso_ordertypesplit\" operator=\"eq\" value=\"1\"/></filter></entity></fetch>')) ~> UOWarehouses",
						"ForecastSales filter(equals(suntafforecastchannelid, \"D2CE\") && \r",
						"equals(modelid, \"D2CE model\") && \r",
						"equals(custgroupid, \"zD2CE\") && \r",
						"(salesqty != 0) && \r",
						"toString(toDate(toString(startdate))) == toString(addDays(currentDate(), 1)) && \r",
						"in($CompanyList, dataareaid)) ~> filterModelCustGroupChannel",
						"filterModelCustGroupChannel select(mapColumn(",
						"          itemid,",
						"          inventdimid,",
						"          salesqty,",
						"          dataareaid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectItemIdForecastQtyInventDimId",
						"joinMSL select(mapColumn(",
						"          crd3c_barcode,",
						"          crd3c_site = inventlocationid,",
						"          crd3c_dataarea = UOItem@crd3c_dataarea,",
						"          crd3c_quantity = salesqty,",
						"          crd3c_itemvariant = crd3c_simpleid,",
						"          crd3c_variantname,",
						"          crd3c_itemvariantlookup = crd3c_uoitemid,",
						"          hso_size = crd3c_size,",
						"          crd3c_warehouselookup = crd3c_uowarehousesid,",
						"          crd3c_quantity = salesqty,",
						"          crd3c_name",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> AddMSL",
						"JoinDualPurposeStores select(mapColumn(",
						"          inventdimid,",
						"          inventsizeid,",
						"          dataareaid,",
						"          inventlocationid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectInventSizeIdAndInventDimId",
						"SelectItemIdForecastQtyInventDimId, SelectInventSizeIdAndInventDimId lookup(SelectItemIdForecastQtyInventDimId@inventdimid == SelectInventSizeIdAndInventDimId@inventdimid",
						"     && SelectItemIdForecastQtyInventDimId@dataareaid == SelectInventSizeIdAndInventDimId@dataareaid,",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> FSGetInventSizeId",
						"CalculateMSL select(mapColumn(",
						"          crd3c_dataarea = dataareaid,",
						"          itemid,",
						"          salesqty,",
						"          inventlocationid,",
						"          crd3c_uowarehousesid,",
						"          inventsizeid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> MSL",
						"UOWarehouses select(mapColumn(",
						"          crd3c_dataarea,",
						"          crd3c_name,",
						"          crd3c_uowarehousesid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectDualPurposeStores",
						"SelectStoreAndSize, SelectDualPurposeStores join(inventlocationid == crd3c_name",
						"     && dataareaid == crd3c_dataarea,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> DualPurposeStoresOnly",
						"FSGetInventSizeId select(mapColumn(",
						"          itemid,",
						"          salesqty,",
						"          dataareaid = SelectItemIdForecastQtyInventDimId@dataareaid,",
						"          inventsizeid,",
						"          inventlocationid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectStoreAndSize",
						"DualPurposeStoresOnly aggregate(groupBy(itemid,",
						"          dataareaid,",
						"          inventsizeid,",
						"          inventlocationid,",
						"          crd3c_uowarehousesid),",
						"     salesqty = sum(salesqty)) ~> CalculateMSL",
						"UOItem, MSL join(crd3c_productnumber == itemid",
						"     && coalesce(crd3c_size, '') == coalesce(inventsizeid, '')",
						"     && UOItem@crd3c_dataarea == MSL@crd3c_dataarea,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> joinMSL",
						"InventDim filter(in($CompanyList, dataareaid) &&\r",
						"in($storeList, inventlocationid)) ~> filterCompany",
						"filterCompany, SelectDualPurposeStores join(inventlocationid == crd3c_name,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> JoinDualPurposeStores",
						"AddMSL sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     input(",
						"          crd3c_name as string,",
						"          crd3c_variantname as string,",
						"          crd3c_barcode as string,",
						"          crd3c_productnumber as string,",
						"          crd3c_dataarea as string,",
						"          crd3c_size as string",
						"     ),",
						"     partitionFileNames:['RecOrderQtyVS.csv'],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     partitionBy('hash', 1)) ~> MSLcreateCSV"
					]
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/SyncOUWarehouse')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "InventLocation"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "UOWarehouses",
								"type": "DatasetReference"
							},
							"name": "SinkOUWarehouse"
						}
					],
					"transformations": [
						{
							"name": "select1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "AlterRow1"
						},
						{
							"name": "filterDataAreaNonEmpty"
						}
					],
					"scriptLines": [
						"parameters{",
						"     Container as string",
						"}",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          allowlaborstandards as long,",
						"          allowmarkingreservationremoval as long,",
						"          consolidateshipatrtw as long,",
						"          cyclecountallowpalletmove as long,",
						"          decrementloadline as long,",
						"          fshstore as long,",
						"          inventcountinggroup_br as long,",
						"          inventlocationtype as long,",
						"          inventprofiletype_ru as long,",
						"          manual as long,",
						"          printbolbeforeshipconfirm as long,",
						"          prodreserveonlywhse as long,",
						"          removeinventblockingonstatuschange as long,",
						"          reqrefill as long,",
						"          reserveatloadpost as long,",
						"          retailinventnegfinancial as long,",
						"          retailinventnegphysical as long,",
						"          uniquecheckdigits as long,",
						"          usewmsorders as long,",
						"          whsenabled as long,",
						"          whsrawmaterialpolicy as long,",
						"          wmsaislenameactive as long,",
						"          wmslevelnameactive as long,",
						"          wmspositionnameactive as long,",
						"          wmsracknameactive as long,",
						"          warehouseautoreleasereservation as long,",
						"          releasetowarehouserule as long,",
						"          autoupdateshipment as long,",
						"          enablequalitymanagement as long,",
						"          loadreleasereservationpolicy as long,",
						"          whsprodorderbackflushmustusereservedqty as long,",
						"          inventusedefaultproductionlocationforformulabom as long,",
						"          rafpostingmethod as long,",
						"          sunecommintegrationtype as long,",
						"          sun3plintegrationtype as long,",
						"          suntafreleasegrpmethod as long,",
						"          suntafreleasethreshmethod as long,",
						"          suntafaggplanningwhse as long,",
						"          hsoatpcalculation as long,",
						"          hsoisshortpickadjustmentjour as long,",
						"          onpickingrequired as long,",
						"          oninventorycalculationmethod as long,",
						"          onprocessssccreceiptmessages as long,",
						"          on3plssccinboundenabled as long,",
						"          enableexternalwarehouse as long,",
						"          sysdatastatecode as long,",
						"          activitytype_ru as string,",
						"          branchnumber as string,",
						"          custaccount_br as string,",
						"          custaccount_hu as string,",
						"          defaultkanbanfinishedgoodslocation as string,",
						"          defaultproductionfinishgoodslocation as string,",
						"          defaultshipmaintenanceloc as string,",
						"          defaultstatusid as string,",
						"          emptypalletlocation as string,",
						"          inventlocationid as string,",
						"          inventlocationidgoodsinroute_ru as string,",
						"          inventlocationidquarantine as string,",
						"          inventlocationidreqmain as string,",
						"          inventlocationidtransit as string,",
						"          inventlocationlevel as long,",
						"          inventprofileid_ru as string,",
						"          inventsiteid as string,",
						"          maxpickingroutetime as long,",
						"          maxpickingroutevolume as decimal(38,6),",
						"          name as string,",
						"          numbersequencegroup_ru as string,",
						"          pickinglinetime as long,",
						"          rbodefaultinventprofileid_ru as string,",
						"          rbodefaultwmslocationid as string,",
						"          rbodefaultwmspalletid as string,",
						"          reqcalendarid as string,",
						"          retailweightex1 as decimal(38,6),",
						"          retailwmslocationiddefaultreturn as string,",
						"          retailwmspalletiddefaultreturn as string,",
						"          vendaccount as string,",
						"          vendaccountcustom_ru as string,",
						"          wmslevelformat as string,",
						"          wmslocationiddefaultissue as string,",
						"          wmslocationiddefaultreceipt as string,",
						"          wmslocationidgoodsinroute_ru as string,",
						"          wmspositionformat as string,",
						"          wmsrackformat as string,",
						"          defaultproductioninputlocation as string,",
						"          defaultreturncreditonlylocation as string,",
						"          defaultcontainertypecode as string,",
						"          workprocessingpolicyname as string,",
						"          defaultqualitymaintenancelocation as string,",
						"          hmimexportlanguage as string,",
						"          hmimdomesticlanguage as string,",
						"          defaultfinalshipmentlocation as string,",
						"          defaultsortinglocation as string,",
						"          rejectorderfulfillment as string,",
						"          itminventlocationidunder as string,",
						"          itminventlocationidgit as string,",
						"          suntafforecastchannelid as string,",
						"          suntafreleasegroupthreshold as decimal(38,6),",
						"          suntafreleasethreshold as decimal(38,6),",
						"          suntafaggplanningwhseid as string,",
						"          suntafsplitpercentage as long,",
						"          hso3plvendaccount as string,",
						"          hsoinventlocationidwaiting as string,",
						"          hsoatpissuemargin as long,",
						"          hsoportwarehouse as string,",
						"          hsovirtualwarehouse as string,",
						"          hsofiscaldocumentemail as string,",
						"          oninventtodeviationvirtualwh as string,",
						"          onreturnwarehouse as string,",
						"          onvatcountry as string,",
						"          onvatid as string,",
						"          onforecastnettinggroupid as string,",
						"          onovgwarehouse as string,",
						"          ondlvdatecalendarcalculation as string,",
						"          onreturnsite as string,",
						"          externalwarehouseid as string,",
						"          externalwarehousedefaultlocation as string,",
						"          externalwarehousemanagementsystemid as string,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string,",
						"          onisinventtransfershortpick as long,",
						"          oninventlocationidinventtransfershortpick as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/inventlocation_partitioned',",
						"     manifestType: 'manifest') ~> InventLocation",
						"filterDataAreaNonEmpty select(mapColumn(",
						"          crd3c_name = inventlocationid,",
						"          crd3c_site = inventsiteid,",
						"          crd3c_warehousename = name,",
						"          crd3c_dataarea = dataareaid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"select1 derive(crd3c_warehousetype = iif(endsWith(upper( crd3c_name), \"-STORE\") ,\"Store\",iif(endsWith(upper( crd3c_name), \"-STK\") ,\"Stock\",\"\")),",
						"          crd3c_warehousename = replace(replace(crd3c_warehousename, \"♂\", \" \"),\"\u000b\", \" \")) ~> derivedColumn1",
						"derivedColumn1 alterRow(upsertIf(true())) ~> AlterRow1",
						"InventLocation filter(not(isNull(dataareaid))) ~> filterDataAreaNonEmpty",
						"AlterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     deletable:false,",
						"     insertable:false,",
						"     updateable:false,",
						"     upsertable:true,",
						"     alternateKeyName: 'crd3c_warehousedataarea',",
						"     partitionFileNames:['OuWarehouseCsv'],",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     saveOrder: 1,",
						"     partitionBy('hash', 1)) ~> SinkOUWarehouse"
					]
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/SyncVendors')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "Vendors"
						},
						{
							"dataset": {
								"referenceName": "UOWarehouses",
								"type": "DatasetReference"
							},
							"name": "UOWarehouses"
						},
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "InterCompanyTradingRelationCustomer"
						},
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "Customers"
						},
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "InterCompanyTradingPartner"
						},
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "Party"
						},
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "InterCompanyTradingRelationVendor"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "Vendors",
								"type": "DatasetReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "VendorsSelect"
						},
						{
							"name": "FilterVendorsWithStoresAsInventLocation"
						},
						{
							"name": "selectWarehouseCols"
						},
						{
							"name": "lookup1"
						},
						{
							"name": "derivedColumn1"
						},
						{
							"name": "LookUpCustomerParty"
						},
						{
							"name": "GetThePartyTableRecords"
						},
						{
							"name": "SelectInterCoCustomers"
						},
						{
							"name": "LookUpThePartyNumber"
						},
						{
							"name": "FinalCustomerSelectWithPartyNumber"
						},
						{
							"name": "select4"
						},
						{
							"name": "GetCustomerDetails"
						},
						{
							"name": "GetVendorParty"
						},
						{
							"name": "SelectVendorParty"
						},
						{
							"name": "GetVendorParty2"
						},
						{
							"name": "FinalSelect"
						},
						{
							"name": "GetVendCustRelation"
						},
						{
							"name": "alterRow1"
						},
						{
							"name": "ConvertVendorPartyToString"
						},
						{
							"name": "selectInterCompanyTradingPartner"
						},
						{
							"name": "selectParty"
						}
					],
					"scriptLines": [
						"parameters{",
						"     Container as string",
						"}",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          bidonly as long,",
						"          blocked as long,",
						"          cashaccountingregime_es as long,",
						"          changerequestallowoverride as long,",
						"          changerequestenabled as long,",
						"          changerequestoverride as long,",
						"          cisstatus as long,",
						"          companytype_mx as long,",
						"          disabledowned as long,",
						"          fatcafilingrequirement as long,",
						"          femaleowned as long,",
						"          foreignentityindicator as long,",
						"          foreignresident_ru as long,",
						"          heir_it as long,",
						"          hubzone as long,",
						"          icmscontributor_br as long,",
						"          incltax as long,",
						"          inventprofiletype_ru as long,",
						"          ispaymfeecovered_jp as long,",
						"          isresident_lv as long,",
						"          locallyowned as long,",
						"          mandatoryvatdate_pl as long,",
						"          matchingpolicy as long,",
						"          minorityowned as long,",
						"          nontaxable_br as long,",
						"          offsetaccounttype as long,",
						"          onetimevendor as long,",
						"          operationtype_mx as long,",
						"          presencetype_br as long,",
						"          purchamountpurchaseorder as long,",
						"          secondtin as long,",
						"          servicecodeondlvaddress_br as long,",
						"          smallbusiness as long,",
						"          tax1099namechoice as long,",
						"          tax1099reports as long,",
						"          taxidtype as long,",
						"          taxwithholdcalculate as long,",
						"          taxwithholdvendortype_th as long,",
						"          unitedvatinvoice_lt as long,",
						"          usecashdisc as long,",
						"          vatpartnerkind_ru as long,",
						"          vattaxagent_ru as long,",
						"          vendconsumption_br as long,",
						"          vendortype_mx as long,",
						"          veteranowned as long,",
						"          w9 as long,",
						"          w9included as long,",
						"          vendvendorcollaborationtype as long,",
						"          withholdingtaxpayertype_mx as long,",
						"          originalvendorinreporting_it as long,",
						"          isselfinvoicevendor_it as long,",
						"          workflowstate as long,",
						"          iscprb_br as long,",
						"          cxmlorderenable as long,",
						"          vatnumtabletype as long,",
						"          overridesalestax as long,",
						"          accruesalestaxtype as long,",
						"          taxvendorchargetaxtolerancevalidation as long,",
						"          revenuetypology_it as long,",
						"          ispublicsector_it as long,",
						"          istaxationoverpayroll_br as long,",
						"          einvoiceregister_it as long,",
						"          isunidentifiedbenef_br as long,",
						"          itmimportcostingvendor as long,",
						"          itmservicesprovider as long,",
						"          itmvendtype as long,",
						"          exf_porequired as long,",
						"          exf_classified as long,",
						"          exf_vendorportalinvoicesmustbeapproved as long,",
						"          exf_istmsfreight as long,",
						"          sunplmsyncwithplm as long,",
						"          hsooscaenabled as long,",
						"          hsogitincludevendorinquery as long,",
						"          oninterface as long,",
						"          onsourcingdeliverytype as long,",
						"          onsourcingupdatechain as long,",
						"          onpoplacementenabled as long,",
						"          sysdatastatecode as long,",
						"          taxwithholdgroup as string,",
						"          residenceforeigncountryregionid as string,",
						"          paymtermid as string,",
						"          linedisc as string,",
						"          accountnum as string,",
						"          bankaccount as string,",
						"          bankcentralbankpurposecode as string,",
						"          bankcentralbankpurposetext as string,",
						"          bankcentralbanktranstypecur_ru as string,",
						"          bankorderofpayment_ru as string,",
						"          birthcountycode_it as string,",
						"          birthplace as string,",
						"          blockedreleasedate as timestamp,",
						"          cashdisc as string,",
						"          ccmnum_br as string,",
						"          ciscompanyregnum as string,",
						"          cisnationalinsurancenum as string,",
						"          cisuniquetaxpayerref as string,",
						"          cisverificationdate as timestamp,",
						"          cisverificationnum as string,",
						"          clearingperiod as string,",
						"          cnae_br as string,",
						"          cnpjcpfnum_br as string,",
						"          commercialregister as string,",
						"          commercialregisterinsetnumber as string,",
						"          commercialregistersection as string,",
						"          companychainid as string,",
						"          companyidsiret as string,",
						"          companynafcode as long,",
						"          consday_jp as long,",
						"          contactpersonid as string,",
						"          creditmax as decimal(38,6),",
						"          creditrating as string,",
						"          curp_mx as string,",
						"          currency as string,",
						"          dba as string,",
						"          defaultdimension as long,",
						"          defaultinventstatusid as string,",
						"          destinationcodeid as string,",
						"          diotcountrycode_mx as string,",
						"          dlvmode as string,",
						"          dlvterm as string,",
						"          enddisc as string,",
						"          enterprisenumber as string,",
						"          ethnicoriginid as string,",
						"          factoringaccount as string,",
						"          finecode_br as string,",
						"          fiscalcode as string,",
						"          foreignerid_br as string,",
						"          foreigntaxregistration_mx as string,",
						"          freightzone as string,",
						"          ienum_br as string,",
						"          insscei_br as string,",
						"          intbank_lv as string,",
						"          interestcode_br as string,",
						"          inventlocation as string,",
						"          inventprofileid_ru as string,",
						"          inventsiteid as string,",
						"          invoiceaccount as string,",
						"          itembuyergroupid as string,",
						"          lineofbusinessid as string,",
						"          lvpaymtranscodes as long,",
						"          maincontactworker as long,",
						"          markupgroup as string,",
						"          memo as string,",
						"          multilinedisc as string,",
						"          namecontrol as string,",
						"          nationality_mx as string,",
						"          nit_br as string,",
						"          numbersequencegroup as string,",
						"          offsetledgerdimension as long,",
						"          organizationnumber as string,",
						"          orgid as string,",
						"          party as long,",
						"          paymdayid as string,",
						"          paymid as string,",
						"          paymmode as string,",
						"          paymsched as string,",
						"          paymspec as string,",
						"          pricegroup as string,",
						"          purchcalendarid as string,",
						"          purchpoolid as string,",
						"          rfc_mx as string,",
						"          segmentid as string,",
						"          separatedivisionid_ru as string,",
						"          stateinscription_mx as string,",
						"          structdepartment_ru as string,",
						"          subsegmentid as string,",
						"          suppitemgroupid as string,",
						"          tamrebategroupid as string,",
						"          tax1099fields as long,",
						"          tax1099regnum as string,",
						"          taxgroup as string,",
						"          taxperiodpaymentcode_pl as string,",
						"          vatnum as string,",
						"          vatoperationcode_ru as string,",
						"          vendexceptiongroup as long,",
						"          vendgroup as string,",
						"          vendincomecode_br as string,",
						"          vendinvoicedeclaration_is as long,",
						"          venditemgroupid as string,",
						"          vendorportaladministratorrecid as long,",
						"          vendpaymfeegroup_jp as string,",
						"          vendpricetolerancegroupid as string,",
						"          youraccountnum as string,",
						"          legalrepresentativecurp_mx as string,",
						"          legalrepresentativename_mx as string,",
						"          legalrepresentativerfc_mx as string,",
						"          withholdingtypecode_mx as string,",
						"          birthdate as timestamp,",
						"          regnum_w as string,",
						"          enterprisecode as string,",
						"          vatnumrecid as long,",
						"          purchaseshipcalendarid as string,",
						"          taxvendorchargetaxtoleranceamount as decimal(38,6),",
						"          taxvendorchargetaxtolerancepercent as decimal(38,6),",
						"          freenotesgroup_it as string,",
						"          coderevenuetypology_it as string,",
						"          itmfromport as string,",
						"          itmoverundertolerancegroupid as string,",
						"          itmagent as string,",
						"          itmvendaccount as string,",
						"          itmcosttypegroupid as string,",
						"          exf_systemapprovalgroupid as string,",
						"          exf_invoicetype as string,",
						"          gupdiscountvendorclaimgroupname as string,",
						"          hsolocalname as string,",
						"          onsourcingvendaccount as string,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string,",
						"          onsource as string,",
						"          onexternalid as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/vendtable_partitioned',",
						"     manifestType: 'manifest') ~> Vendors",
						"source(output(",
						"          {@odata.etag} as string,",
						"          crd3c_name as string,",
						"          crd3c_uowarehousesid as string,",
						"          crd3c_warehousetype as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     query: '<fetch version=\"1.0\" output-format=\"xml-platform\" mapping=\"logical\" distinct=\"false\">\\n  <entity name=\"crd3c_uowarehouses\">\\n    <attribute name=\"crd3c_uowarehousesid\" />\\n    <attribute name=\"crd3c_name\" />\\n    <attribute name=\"crd3c_warehousetype\" />\\n    <order attribute=\"crd3c_name\" descending=\"false\" />\\n    <filter type=\"and\">\\n      <condition attribute=\"crd3c_warehousetype\" operator=\"eq\" value=\"Store\" />\\n    </filter>\\n  </entity>\\n</fetch>') ~> UOWarehouses",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          active as long,",
						"          excludeihbnetting as long,",
						"          sysdatastatecode as long,",
						"          intercompanytradingcustomer as long,",
						"          intercompanytradingvendor as long,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/intercompanytradingrelation_partitioned',",
						"     manifestType: 'manifest') ~> InterCompanyTradingRelationCustomer",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          accountstatement as long,",
						"          affiliated_ru as long,",
						"          blocked as long,",
						"          companytype_mx as long,",
						"          creditcardaddressverification as long,",
						"          creditcardaddressverificationlevel as long,",
						"          creditcardaddressverificationvoid as long,",
						"          creditcardcvc as long,",
						"          custexcludecollectionfee as long,",
						"          custexcludeinterestcharges as long,",
						"          custfinaluser_br as long,",
						"          custwhtcontributiontype_br as long,",
						"          einvoice as long,",
						"          einvoiceattachment as long,",
						"          entrycertificaterequired_w as long,",
						"          exportsales_pl as long,",
						"          expressbilloflading as long,",
						"          fednonfedindicator as long,",
						"          fiscaldoctype_pl as long,",
						"          forecastdmpinclude as long,",
						"          foreignresident_ru as long,",
						"          generateincomingfiscaldocument_br as long,",
						"          girotype as long,",
						"          girotypeaccountstatement as long,",
						"          girotypecollectionletter as long,",
						"          girotypefreetextinvoice as long,",
						"          girotypeinterestnote as long,",
						"          girotypeprojinvoice as long,",
						"          icmscontributor_br as long,",
						"          incltax as long,",
						"          intercompanyallowindirectcreation as long,",
						"          intercompanyautocreateorders as long,",
						"          intercompanydirectdelivery as long,",
						"          inventprofiletype_ru as long,",
						"          invoiceaddress as long,",
						"          invoicepostingtype_ru as long,",
						"          isresident_lv as long,",
						"          issueownentrycertificate_w as long,",
						"          mandatorycreditlimit as long,",
						"          mandatoryvatdate_pl as long,",
						"          onetimecustomer as long,",
						"          packagedepositexcempt_pl as long,",
						"          pdsfreightaccrued as long,",
						"          rfidcasetagging as long,",
						"          rfiditemtagging as long,",
						"          rfidpallettagging as long,",
						"          servicecodeondlvaddress_br as long,",
						"          shipcarrierblindshipment as long,",
						"          shipcarrierfuelsurcharge as long,",
						"          suframa_br as long,",
						"          suframapiscofins_br as long,",
						"          taxwithholdcalculate_in as long,",
						"          taxwithholdcalculate_th as long,",
						"          unitedvatinvoice_lt as long,",
						"          usecashdisc as long,",
						"          usepurchrequest as long,",
						"          websalesorderdisplay as long,",
						"          einvoiceregister_it as long,",
						"          presencetype_br as long,",
						"          isexternallymaintained as long,",
						"          cfdienabled_mx as long,",
						"          foreigntrade_mx as long,",
						"          workflowstate as long,",
						"          useoriginaldocumentasfacture_ru as long,",
						"          collectionlettercode as long,",
						"          blockfloorlimituseinchannel as long,",
						"          cfdiskipiepstaxes_mx as long,",
						"          simplifytaxintgrexportdocvalidation_cn as long,",
						"          simplenational_br as long,",
						"          vatnumtabletype as long,",
						"          overridesalestax as long,",
						"          usualexporter_it as long,",
						"          ispublicsector_it as long,",
						"          simplifytaxintgrexporttaxregvalidation_cn as long,",
						"          printdynamicqrcode_in as long,",
						"          invoicetype_w as long,",
						"          cfditemporaryexport_mx as long,",
						"          credmanexclude as long,",
						"          credmantitleheld as long,",
						"          credmanwithagency as long,",
						"          credmancustunlimitedcredit as long,",
						"          revrecdisableintercompany as long,",
						"          suntafreleasegrpmethod as long,",
						"          suntafreleasethreshmethod as long,",
						"          suntafskipbulkconsumption as long,",
						"          sks_epy_custfilter as long,",
						"          sks_epy_paymenttype as long,",
						"          sks_cc_disablecardsync as long,",
						"          sks_cc_walletlinkstatus as long,",
						"          sks_lb_autosettlement as long,",
						"          hsoedicustcountrycode as long,",
						"          hsoediprovider as long,",
						"          hsoediisdespatchadvicerecordid as long,",
						"          hsoedimarkforaddressrequirement as long,",
						"          hsoomnicsenabled as long,",
						"          hsokeyaccount as long,",
						"          hsousingaotsystem as long,",
						"          oncustomerrefautofill as long,",
						"          oncustomerconsolidatedinvoice as long,",
						"          hsouseshipwindow as long,",
						"          oninvoicedatesummary as long,",
						"          hsoisinternalcustomer as long,",
						"          hsoapplyifdirectdelivery as long,",
						"          sysdatastatecode as long,",
						"          paymtermid as string,",
						"          linedisc as string,",
						"          taxwithholdgroup_th as string,",
						"          partycountry as string,",
						"          accountnum as string,",
						"          agencylocationcode as string,",
						"          bankaccount as string,",
						"          bankcentralbankpurposecode as string,",
						"          bankcentralbankpurposetext as string,",
						"          bankcustpaymidtable as long,",
						"          cashdisc as string,",
						"          cashdiscbasedays as long,",
						"          ccmnum_br as string,",
						"          clearingperiod as string,",
						"          cnae_br as string,",
						"          cnpjcpfnum_br as string,",
						"          commercialregister as string,",
						"          commercialregisterinsetnumber as string,",
						"          commercialregistersection as string,",
						"          commissiongroup as string,",
						"          companychainid as string,",
						"          companyidsiret as string,",
						"          companynafcode as long,",
						"          consday_jp as long,",
						"          contactpersonid as string,",
						"          creditmax as decimal(38,6),",
						"          creditrating as string,",
						"          curp_mx as string,",
						"          currency as string,",
						"          custclassificationid as string,",
						"          custgroup as string,",
						"          custitemgroupid as string,",
						"          custtradingpartnercode as long,",
						"          defaultdimension as long,",
						"          defaultdirectdebitmandate as long,",
						"          defaultinventstatusid as string,",
						"          destinationcodeid as string,",
						"          dlvmode as string,",
						"          dlvreason as string,",
						"          dlvterm as string,",
						"          einvoiceeannum as string,",
						"          enddisc as string,",
						"          enterprisenumber as string,",
						"          factoringaccount as string,",
						"          federalcomments as string,",
						"          finecode_br as string,",
						"          fiscalcode as string,",
						"          freightzone as string,",
						"          ienum_br as string,",
						"          insscei_br as string,",
						"          intbank_lv as string,",
						"          interestcode_br as string,",
						"          inventlocation as string,",
						"          inventprofileid_ru as string,",
						"          inventsiteid as string,",
						"          invoiceaccount as string,",
						"          issuercountry_hu as string,",
						"          lineofbusinessid as string,",
						"          lvpaymtranscodes as long,",
						"          maincontactworker as long,",
						"          markupgroup as string,",
						"          mcrmergedparent as string,",
						"          mcrmergedroot as string,",
						"          memo as string,",
						"          multilinedisc as string,",
						"          nit_br as string,",
						"          numbersequencegroup as string,",
						"          orderentrydeadlinegroupid as string,",
						"          orgid as string,",
						"          ouraccountnum as string,",
						"          packmaterialfeelicensenum as string,",
						"          party as long,",
						"          partystate as string,",
						"          paymdayid as string,",
						"          paymentreference_ee as string,",
						"          paymidtype as string,",
						"          paymmode as string,",
						"          paymsched as string,",
						"          paymspec as string,",
						"          pdscustrebategroupid as string,",
						"          pdsrebatetmagroup as string,",
						"          pricegroup as string,",
						"          residenceforeigncountryregionid_it as string,",
						"          rfc_mx as string,",
						"          salescalendarid as string,",
						"          salesdistrictid as string,",
						"          salesgroup as string,",
						"          salespoolid as string,",
						"          segmentid as string,",
						"          shipcarrieraccount as string,",
						"          shipcarrieraccountcode as string,",
						"          shipcarrierid as string,",
						"          stateinscription_mx as string,",
						"          statisticsgroup as string,",
						"          subsegmentid as string,",
						"          suframanumber_br as string,",
						"          suppitemgroupid as string,",
						"          taxgroup as string,",
						"          taxperiodpaymentcode_pl as string,",
						"          vatnum as string,",
						"          vendaccount as string,",
						"          authorityoffice_it as string,",
						"          foreignerid_br as string,",
						"          taxgstreliefgroupheading_my as long,",
						"          foreigntaxregistration_mx as string,",
						"          custwriteoffrefrecid as long,",
						"          regnum_w as string,",
						"          enterprisecode as string,",
						"          taxbordernumber_fi as string,",
						"          birthdate_it as timestamp,",
						"          satpaymmethod_mx as string,",
						"          satpurpose_mx as string,",
						"          vatnumrecid as long,",
						"          freenotesgroup_it as string,",
						"          taxregimecode_mx as string,",
						"          satregistrationname_mx as string,",
						"          credmaneligiblecreditlimitdate as timestamp,",
						"          credmangroupid as string,",
						"          credmannotes as string,",
						"          credmanaccountstatusid as string,",
						"          credmaneligiblecreditmax as decimal(38,6),",
						"          credmanbusinessstarted as timestamp,",
						"          credmancustcreditmaxalt as decimal(38,6),",
						"          credmaneligiblecreditlimitcurrency as string,",
						"          credmancustomersince as timestamp,",
						"          credmanstatusreasonid as string,",
						"          credmancollectiongroupid as string,",
						"          credmancreditlimitexpirydate as timestamp,",
						"          credmancreditlimitdate as timestamp,",
						"          credmanlastreviewdate as timestamp,",
						"          credmannextschedreviewdate as timestamp,",
						"          sunecommcustomerid as string,",
						"          suntafreleasethreshold as decimal(38,6),",
						"          suntafcustomergroup as string,",
						"          suntafforecastchannelid as string,",
						"          suntafreleasegroupthreshold as decimal(38,6),",
						"          sks_lb_tpmdedcat as string,",
						"          sks_br_ebankreccustgroupid as string,",
						"          sks_cc_journalpaymmode as string,",
						"          sks_cc_walletlinkcount as long,",
						"          sks_cc_walletlinkerrormsg as string,",
						"          hsoediinterchangeid as string,",
						"          hsoedilocationid as string,",
						"          hsoedideliverypartygln as string,",
						"          hsoedibuyergln as string,",
						"          hsoedifrominventlocationid as string,",
						"          hsoediaccountnumber as string,",
						"          hsoshippingcarrier as string,",
						"          hsoshippingcarrieraccountnum as string,",
						"          hsolocalname as string,",
						"          onedibuyergln as string,",
						"          hsoroutetimesalesorders as long,",
						"          hsodaysbetweenshipdates as long,",
						"          oninventbarcodesetupid as string,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string,",
						"          irs1099cindicator as long,",
						"          birthcountycode_it as string,",
						"          birthplace_it as string,",
						"          identificationnumber as string,",
						"          passportno_hu as string,",
						"          taxlicensenum as string,",
						"          dynfamilygroupid as string,",
						"          trigeoid as string,",
						"          onnoshortpickallowed as long,",
						"          hsocustomsnumber as string,",
						"          hsodlvtermreturn as string,",
						"          hsoprofileid as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/custtable_partitioned',",
						"     manifestType: 'manifest') ~> Customers",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          tradingpartnertype as long,",
						"          sysdatastatecode as long,",
						"          vendordataareaid as string,",
						"          customerdataareaid as string,",
						"          customerparty as long,",
						"          vendorparty as long,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/intercompanytradingpartner_partitioned',",
						"     manifestType: 'manifest') ~> InterCompanyTradingPartner",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          sysdatastatecode as long,",
						"          instancerelationtype as long,",
						"          knownas as string,",
						"          languageid as string,",
						"          name as string,",
						"          namealias as string,",
						"          partynumber as string,",
						"          primaryaddresslocation as long,",
						"          primarycontactemail as long,",
						"          primarycontactfax as long,",
						"          primarycontactphone as long,",
						"          primarycontacttelex as long,",
						"          primarycontacturl as long,",
						"          primarycontactfacebook as long,",
						"          primarycontacttwitter as long,",
						"          primarycontactlinkedin as long,",
						"          addressbooknames as string,",
						"          legacyinstancerelationtype as long,",
						"          hsoexternalcontactreference as string,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/dirpartytable_partitioned',",
						"     manifestType: 'manifest') ~> Party",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          active as long,",
						"          excludeihbnetting as long,",
						"          sysdatastatecode as long,",
						"          intercompanytradingcustomer as long,",
						"          intercompanytradingvendor as long,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/intercompanytradingrelation_partitioned',",
						"     manifestType: 'manifest') ~> InterCompanyTradingRelationVendor",
						"Vendors select(mapColumn(",
						"          hso_site = inventsiteid,",
						"          hso_store = inventlocation,",
						"          hso_company = dataareaid,",
						"          hso_vendorgroup = vendgroup,",
						"          hso_name = accountnum,",
						"          hso_store2 = inventlocation,",
						"          VENDPARTY = party,",
						"          VENDRECID = recid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> VendorsSelect",
						"VendorsSelect filter(endsWith(upper(hso_store), \"-STORE\")) ~> FilterVendorsWithStoresAsInventLocation",
						"UOWarehouses select(mapColumn(",
						"          crd3c_uowarehousesid,",
						"          crd3c_name",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectWarehouseCols",
						"FilterVendorsWithStoresAsInventLocation, selectWarehouseCols lookup(hso_store == crd3c_name,",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> lookup1",
						"lookup1 derive(crd3c_uowarehousesid = concat(concat('crd3c_uowarehouseses','('),concat(crd3c_uowarehousesid,')'))) ~> derivedColumn1",
						"InterCompanyTradingRelationCustomer, selectInterCompanyTradingPartner lookup(intercompanytradingcustomer == selectInterCompanyTradingPartner@recid,",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> LookUpCustomerParty",
						"LookUpCustomerParty, selectParty lookup(customerparty == selectParty@recid,",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> GetThePartyTableRecords",
						"Customers select(mapColumn(",
						"          PARTYRECID = party,",
						"          ACCOUNTNUM = accountnum,",
						"          INVENTLOCATION = inventlocation,",
						"          CUSTGROUP = custgroup,",
						"          INVENTSITEID = inventsiteid,",
						"          CUSTDATAAREA = dataareaid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectInterCoCustomers",
						"SelectInterCoCustomers, selectParty lookup(PARTYRECID == recid,",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> LookUpThePartyNumber",
						"LookUpThePartyNumber select(mapColumn(",
						"          CUSTDATAAREA,",
						"          ACCOUNTNUM,",
						"          INVENTSITEID,",
						"          INVENTLOCATION,",
						"          CUSTPARTYNUMBER = partynumber,",
						"          CUSTPARTYRECID = PARTYRECID,",
						"          CUSTGROUP",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> FinalCustomerSelectWithPartyNumber",
						"GetThePartyTableRecords select(mapColumn(",
						"          INTERCOMPANYTRADINGVENDOR = intercompanytradingvendor,",
						"          INTERCOMPANYTRADINGCUSTOMER = intercompanytradingcustomer,",
						"          CUSTOMERPARTY = customerparty,",
						"          NAME = name,",
						"          CUSTOMERPARTYNUMBER = partynumber",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select4",
						"select4, FinalCustomerSelectWithPartyNumber lookup(CUSTOMERPARTYNUMBER == CUSTPARTYNUMBER,",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> GetCustomerDetails",
						"InterCompanyTradingRelationVendor, selectInterCompanyTradingPartner lookup(intercompanytradingvendor == selectInterCompanyTradingPartner@recid,",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> GetVendorParty",
						"GetVendorParty select(mapColumn(",
						"          VENDORPARTY = vendorparty,",
						"          INTERCOMPANYTRADINGVENDOR = intercompanytradingvendor",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectVendorParty",
						"GetCustomerDetails, SelectVendorParty lookup(select4@INTERCOMPANYTRADINGVENDOR == SelectVendorParty@INTERCOMPANYTRADINGVENDOR,",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> GetVendorParty2",
						"GetVendorParty2 select(mapColumn(",
						"          CUSTNAME = NAME,",
						"          CUSTOMERPARTYNUMBER,",
						"          CUSTACCOUNTNUM = ACCOUNTNUM,",
						"          INVENTLOCATION,",
						"          VENDORPARTY,",
						"          CUSTDATAAREA,",
						"          INVENTSITEID,",
						"          CUSTGROUP",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> FinalSelect",
						"derivedColumn1, FinalSelect lookup(VENDPARTY == VENDORPARTY,",
						"     multiple: false,",
						"     pickup: 'any',",
						"     broadcast: 'auto')~> GetVendCustRelation",
						"ConvertVendorPartyToString alterRow(upsertIf(true())) ~> alterRow1",
						"GetVendCustRelation derive(VENDPARTY = toString(VENDPARTY)) ~> ConvertVendorPartyToString",
						"InterCompanyTradingPartner select(mapColumn(",
						"          recid,",
						"          customerparty,",
						"          vendorparty",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectInterCompanyTradingPartner",
						"Party select(mapColumn(",
						"          recid,",
						"          partynumber,",
						"          name",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectParty",
						"alterRow1 sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     deletable:false,",
						"     insertable:false,",
						"     updateable:false,",
						"     upsertable:true,",
						"     alternateKeyName: 'hso_vendorsid',",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     mapColumn(",
						"          hso_site,",
						"          {hso_store@odata.bind} = crd3c_uowarehousesid,",
						"          hso_name,",
						"          hso_company,",
						"          hso_vendorgroup,",
						"          hso_store2 = hso_store,",
						"          hso_customer = CUSTACCOUNTNUM,",
						"          hso_sourcewarehouse = INVENTLOCATION,",
						"          hso_companycustomer = CUSTDATAAREA,",
						"          hso_sitecustomer = INVENTSITEID,",
						"          hso_custgroup = CUSTGROUP,",
						"          hso_customername = CUSTNAME,",
						"          hso_vendorid = VENDPARTY",
						"     )) ~> sink1"
					]
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/SyncVendors_CustWH_SourcingWH_Test')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "ONKR vendors should get customer sourcing WH in Dataverse using this logic: vendor (LE-1)->Intercompany customer (LE-2)->sourcing vendor (LE-2)->intercompany customer(LE-3)->InventLocation for this customer.",
				"folder": {
					"name": "OL/General"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "InterCompanyTradingPartner"
						},
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "Party"
						},
						{
							"linkedService": {
								"referenceName": "D365FOSynapseDelta",
								"type": "LinkedServiceReference"
							},
							"name": "InterCompanyTradingRelationVendor"
						},
						{
							"dataset": {
								"referenceName": "OL_13082025_0914",
								"type": "DatasetReference"
							},
							"name": "myTempFile"
						},
						{
							"dataset": {
								"referenceName": "OL_Tmp_CustTable",
								"type": "DatasetReference"
							},
							"name": "CustTableTmp"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "Vendors",
								"type": "DatasetReference"
							},
							"name": "Vendors"
						}
					],
					"transformations": [
						{
							"name": "SelectKeyVendorColumns"
						},
						{
							"name": "FilterONKRVendors",
							"description": "Filter vendors based on ONKR legal entity"
						},
						{
							"name": "SelectCustomer"
						},
						{
							"name": "SelectIntercompanyRelation"
						},
						{
							"name": "selectInterCompanyTradingPartner"
						},
						{
							"name": "selectParty"
						},
						{
							"name": "L1VendPartner"
						},
						{
							"name": "L2SelectCustPartner"
						},
						{
							"name": "L2GetCustomer"
						},
						{
							"name": "L1SelectVendPartnerRecId"
						},
						{
							"name": "L1VendRelation"
						},
						{
							"name": "L1SelectCustRelation"
						},
						{
							"name": "L2SelectCustAccount"
						},
						{
							"name": "IntercompanyPartner"
						},
						{
							"name": "L3GetVendorBasedOnSourcing"
						},
						{
							"name": "FilterVendorsWithONSourcing",
							"description": "Filter vendors that have ONSourcingVendAccount not NULL"
						},
						{
							"name": "L3SelectVendorPartyAndDataArea"
						},
						{
							"name": "L3GetVendorPartner"
						},
						{
							"name": "L3SelectPartnerRecId"
						},
						{
							"name": "L3RelationCustomerVendor"
						},
						{
							"name": "L4ICCustomer"
						},
						{
							"name": "join1"
						},
						{
							"name": "L4SelectCustPartyAndDataAreaId"
						},
						{
							"name": "L4GetCustomer"
						},
						{
							"name": "FinalSelectCustomer"
						},
						{
							"name": "L1CustPartner"
						},
						{
							"name": "ICCustomer"
						},
						{
							"name": "SelectONSourcingVendors"
						},
						{
							"name": "LowercaseDataArea"
						},
						{
							"name": "join2"
						},
						{
							"name": "Upsert"
						},
						{
							"name": "select1"
						}
					],
					"scriptLines": [
						"parameters{",
						"     Container as string",
						"}",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          tradingpartnertype as long,",
						"          sysdatastatecode as long,",
						"          vendordataareaid as string,",
						"          customerdataareaid as string,",
						"          customerparty as long,",
						"          vendorparty as long,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/intercompanytradingpartner_partitioned',",
						"     manifestType: 'manifest') ~> InterCompanyTradingPartner",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          sysdatastatecode as long,",
						"          instancerelationtype as long,",
						"          knownas as string,",
						"          languageid as string,",
						"          name as string,",
						"          namealias as string,",
						"          partynumber as string,",
						"          primaryaddresslocation as long,",
						"          primarycontactemail as long,",
						"          primarycontactfax as long,",
						"          primarycontactphone as long,",
						"          primarycontacttelex as long,",
						"          primarycontacturl as long,",
						"          primarycontactfacebook as long,",
						"          primarycontacttwitter as long,",
						"          primarycontactlinkedin as long,",
						"          addressbooknames as string,",
						"          legacyinstancerelationtype as long,",
						"          hsoexternalcontactreference as string,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/dirpartytable_partitioned',",
						"     manifestType: 'manifest') ~> Party",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as timestamp,",
						"          SinkModifiedOn as timestamp,",
						"          active as long,",
						"          excludeihbnetting as long,",
						"          sysdatastatecode as long,",
						"          intercompanytradingcustomer as long,",
						"          intercompanytradingvendor as long,",
						"          modifieddatetime as timestamp,",
						"          modifiedby as string,",
						"          modifiedtransactionid as long,",
						"          createddatetime as timestamp,",
						"          createdby as string,",
						"          createdtransactionid as long,",
						"          dataareaid as string,",
						"          recversion as long,",
						"          partition as long,",
						"          sysrowversion as long,",
						"          recid as long,",
						"          tableid as long,",
						"          versionnumber as long,",
						"          createdon as timestamp,",
						"          modifiedon as timestamp,",
						"          IsDelete as boolean,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     format: 'delta',",
						"     fileSystem: ($Container),",
						"     folderPath: 'deltalake/intercompanytradingrelation_partitioned',",
						"     manifestType: 'manifest') ~> InterCompanyTradingRelationVendor",
						"source(output(",
						"          Id as string,",
						"          SinkCreatedOn as string,",
						"          SinkModifiedOn as string,",
						"          bidonly as string,",
						"          blocked as string,",
						"          cashaccountingregime_es as string,",
						"          changerequestallowoverride as string,",
						"          changerequestenabled as string,",
						"          changerequestoverride as string,",
						"          cisstatus as string,",
						"          companytype_mx as string,",
						"          disabledowned as string,",
						"          fatcafilingrequirement as string,",
						"          femaleowned as string,",
						"          foreignentityindicator as string,",
						"          foreignresident_ru as string,",
						"          heir_it as string,",
						"          hubzone as string,",
						"          icmscontributor_br as string,",
						"          incltax as string,",
						"          inventprofiletype_ru as string,",
						"          ispaymfeecovered_jp as string,",
						"          isresident_lv as string,",
						"          locallyowned as string,",
						"          mandatoryvatdate_pl as string,",
						"          matchingpolicy as string,",
						"          minorityowned as string,",
						"          nontaxable_br as string,",
						"          offsetaccounttype as string,",
						"          onetimevendor as string,",
						"          operationtype_mx as string,",
						"          presencetype_br as string,",
						"          purchamountpurchaseorder as string,",
						"          secondtin as string,",
						"          servicecodeondlvaddress_br as string,",
						"          smallbusiness as string,",
						"          tax1099namechoice as string,",
						"          tax1099reports as string,",
						"          taxidtype as string,",
						"          taxwithholdcalculate as string,",
						"          taxwithholdvendortype_th as string,",
						"          unitedvatinvoice_lt as string,",
						"          usecashdisc as string,",
						"          vatpartnerkind_ru as string,",
						"          vattaxagent_ru as string,",
						"          vendconsumption_br as string,",
						"          vendortype_mx as string,",
						"          veteranowned as string,",
						"          w9 as string,",
						"          w9included as string,",
						"          vendvendorcollaborationtype as string,",
						"          withholdingtaxpayertype_mx as string,",
						"          originalvendorinreporting_it as string,",
						"          isselfinvoicevendor_it as string,",
						"          workflowstate as string,",
						"          iscprb_br as string,",
						"          cxmlorderenable as string,",
						"          vatnumtabletype as string,",
						"          overridesalestax as string,",
						"          accruesalestaxtype as string,",
						"          taxvendorchargetaxtolerancevalidation as string,",
						"          revenuetypology_it as string,",
						"          ispublicsector_it as string,",
						"          istaxationoverpayroll_br as string,",
						"          einvoiceregister_it as string,",
						"          isunidentifiedbenef_br as string,",
						"          itmimportcostingvendor as string,",
						"          itmservicesprovider as string,",
						"          itmvendtype as string,",
						"          exf_porequired as string,",
						"          exf_classified as string,",
						"          exf_vendorportalinvoicesmustbeapproved as string,",
						"          exf_istmsfreight as string,",
						"          sunplmsyncwithplm as string,",
						"          hsooscaenabled as string,",
						"          hsogitincludevendorinquery as string,",
						"          oninterface as string,",
						"          onsourcingdeliverytype as string,",
						"          onsourcingupdatechain as string,",
						"          onpoplacementenabled as string,",
						"          sysdatastatecode as string,",
						"          taxwithholdgroup as string,",
						"          residenceforeigncountryregionid as string,",
						"          paymtermid as string,",
						"          linedisc as string,",
						"          accountnum as string,",
						"          bankaccount as string,",
						"          bankcentralbankpurposecode as string,",
						"          bankcentralbankpurposetext as string,",
						"          bankcentralbanktranstypecur_ru as string,",
						"          bankorderofpayment_ru as string,",
						"          birthcountycode_it as string,",
						"          birthplace as string,",
						"          blockedreleasedate as string,",
						"          cashdisc as string,",
						"          ccmnum_br as string,",
						"          ciscompanyregnum as string,",
						"          cisnationalinsurancenum as string,",
						"          cisuniquetaxpayerref as string,",
						"          cisverificationdate as string,",
						"          cisverificationnum as string,",
						"          clearingperiod as string,",
						"          cnae_br as string,",
						"          cnpjcpfnum_br as string,",
						"          commercialregister as string,",
						"          commercialregisterinsetnumber as string,",
						"          commercialregistersection as string,",
						"          companychainid as string,",
						"          companyidsiret as string,",
						"          companynafcode as string,",
						"          consday_jp as string,",
						"          contactpersonid as string,",
						"          creditmax as string,",
						"          creditrating as string,",
						"          curp_mx as string,",
						"          currency as string,",
						"          dba as string,",
						"          defaultdimension as string,",
						"          defaultinventstatusid as string,",
						"          destinationcodeid as string,",
						"          diotcountrycode_mx as string,",
						"          dlvmode as string,",
						"          dlvterm as string,",
						"          enddisc as string,",
						"          enterprisenumber as string,",
						"          ethnicoriginid as string,",
						"          factoringaccount as string,",
						"          finecode_br as string,",
						"          fiscalcode as string,",
						"          foreignerid_br as string,",
						"          foreigntaxregistration_mx as string,",
						"          freightzone as string,",
						"          ienum_br as string,",
						"          insscei_br as string,",
						"          intbank_lv as string,",
						"          interestcode_br as string,",
						"          inventlocation as string,",
						"          inventprofileid_ru as string,",
						"          inventsiteid as string,",
						"          invoiceaccount as string,",
						"          itembuyergroupid as string,",
						"          lineofbusinessid as string,",
						"          lvpaymtranscodes as string,",
						"          maincontactworker as string,",
						"          markupgroup as string,",
						"          memo as string,",
						"          multilinedisc as string,",
						"          namecontrol as string,",
						"          nationality_mx as string,",
						"          nit_br as string,",
						"          numbersequencegroup as string,",
						"          offsetledgerdimension as string,",
						"          organizationnumber as string,",
						"          orgid as string,",
						"          party as string,",
						"          paymdayid as string,",
						"          paymid as string,",
						"          paymmode as string,",
						"          paymsched as string,",
						"          paymspec as string,",
						"          pricegroup as string,",
						"          purchcalendarid as string,",
						"          purchpoolid as string,",
						"          rfc_mx as string,",
						"          segmentid as string,",
						"          separatedivisionid_ru as string,",
						"          stateinscription_mx as string,",
						"          structdepartment_ru as string,",
						"          subsegmentid as string,",
						"          suppitemgroupid as string,",
						"          tamrebategroupid as string,",
						"          tax1099fields as string,",
						"          tax1099regnum as string,",
						"          taxgroup as string,",
						"          taxperiodpaymentcode_pl as string,",
						"          vatnum as string,",
						"          vatoperationcode_ru as string,",
						"          vendexceptiongroup as string,",
						"          vendgroup as string,",
						"          vendincomecode_br as string,",
						"          vendinvoicedeclaration_is as string,",
						"          venditemgroupid as string,",
						"          vendorportaladministratorrecid as string,",
						"          vendpaymfeegroup_jp as string,",
						"          vendpricetolerancegroupid as string,",
						"          youraccountnum as string,",
						"          legalrepresentativecurp_mx as string,",
						"          legalrepresentativename_mx as string,",
						"          legalrepresentativerfc_mx as string,",
						"          withholdingtypecode_mx as string,",
						"          birthdate as string,",
						"          regnum_w as string,",
						"          enterprisecode as string,",
						"          vatnumrecid as string,",
						"          purchaseshipcalendarid as string,",
						"          taxvendorchargetaxtoleranceamount as string,",
						"          taxvendorchargetaxtolerancepercent as string,",
						"          freenotesgroup_it as string,",
						"          coderevenuetypology_it as string,",
						"          itmfromport as string,",
						"          itmoverundertolerancegroupid as string,",
						"          itmagent as string,",
						"          itmvendaccount as string,",
						"          itmcosttypegroupid as string,",
						"          exf_systemapprovalgroupid as string,",
						"          exf_invoicetype as string,",
						"          gupdiscountvendorclaimgroupname as string,",
						"          hsolocalname as string,",
						"          onsourcingvendaccount as string,",
						"          onsource as string,",
						"          onexternalid as string,",
						"          vrmglobalvendor as string,",
						"          modifieddatetime as string,",
						"          modifiedby as string,",
						"          modifiedtransactionid as string,",
						"          createddatetime as string,",
						"          createdby as string,",
						"          createdtransactionid as string,",
						"          dataareaid as string,",
						"          recversion as string,",
						"          partition as string,",
						"          sysrowversion as string,",
						"          recid as string,",
						"          tableid as string,",
						"          versionnumber as string,",
						"          createdon as string,",
						"          modifiedon as string,",
						"          IsDelete as string,",
						"          createdonpartition as string,",
						"          PartitionId as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     partitionBy('hash', 1)) ~> myTempFile",
						"source(output(",
						"          vendorId as string,",
						"          party as long,",
						"          inventlocation as string,",
						"          dataareaid as string",
						"     ),",
						"     allowSchemaDrift: false,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     partitionBy('hash', 1)) ~> CustTableTmp",
						"myTempFile select(mapColumn(",
						"          DATAAREAID = dataareaid,",
						"          VENDACCOUNT = accountnum,",
						"          VENDPARTYORIG = party,",
						"          onsourcingvendaccount",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectKeyVendorColumns",
						"SelectKeyVendorColumns filter(equals(DATAAREAID, 'onkr')) ~> FilterONKRVendors",
						"CustTableTmp select(mapColumn(",
						"          PARTY = party,",
						"          ACCOUNTNUM = vendorId,",
						"          inventlocation,",
						"          dataareaid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectCustomer",
						"InterCompanyTradingRelationVendor select(mapColumn(",
						"          INTERCOMPANYTRADINGVENDOR = intercompanytradingvendor,",
						"          intercompanytradingcustomer",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> SelectIntercompanyRelation",
						"InterCompanyTradingPartner select(mapColumn(",
						"          partnerrecid = recid,",
						"          customerparty,",
						"          vendorparty,",
						"          vendordataareaid,",
						"          customerdataareaid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectInterCompanyTradingPartner",
						"Party select(mapColumn(",
						"          recid,",
						"          name",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> selectParty",
						"FilterONKRVendors, IntercompanyPartner join(VENDPARTYORIG == vendorparty",
						"     && DATAAREAID == vendordataareaid,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> L1VendPartner",
						"L1CustPartner select(mapColumn(",
						"          customerparty,",
						"          VENDACCOUNTORIG,",
						"          customerdataareaid,",
						"          VENDPARTYORIG,",
						"          DATAAREAIDORIG",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> L2SelectCustPartner",
						"L2SelectCustPartner, ICCustomer join(customerparty == PARTY",
						"     && customerdataareaid == dataareaid,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> L2GetCustomer",
						"L1VendPartner select(mapColumn(",
						"          partnerrecid,",
						"          VENDPARTYORIG,",
						"          DATAAREAIDORIG = DATAAREAID,",
						"          VENDACCOUNTORIG = VENDACCOUNT",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> L1SelectVendPartnerRecId",
						"L1SelectVendPartnerRecId, SelectIntercompanyRelation join(partnerrecid == INTERCOMPANYTRADINGVENDOR,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> L1VendRelation",
						"L1VendRelation select(mapColumn(",
						"          intercompanytradingcustomer,",
						"          VENDPARTYORIG,",
						"          DATAAREAIDORIG,",
						"          VENDACCOUNTORIG",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> L1SelectCustRelation",
						"L2GetCustomer select(mapColumn(",
						"          ACCOUNTNUM,",
						"          VENDACCOUNTORIG,",
						"          customerdataareaid,",
						"          VENDPARTYORIG,",
						"          DATAAREAIDORIG",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> L2SelectCustAccount",
						"selectInterCompanyTradingPartner derive(vendordataareaid = lower(vendordataareaid),",
						"          customerdataareaid = lower(customerdataareaid),",
						"          vendorparty = toString(vendorparty)) ~> IntercompanyPartner",
						"L2SelectCustAccount, SelectONSourcingVendors join(ACCOUNTNUM == onsourcingvendaccount",
						"     && customerdataareaid == DATAAREAID,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> L3GetVendorBasedOnSourcing",
						"SelectKeyVendorColumns filter(notEquals(onsourcingvendaccount, 'NULL')) ~> FilterVendorsWithONSourcing",
						"L3GetVendorBasedOnSourcing select(mapColumn(",
						"          DATAAREAID,",
						"          VENDACCOUNTORIG,",
						"          VENDPARTYORIG,",
						"          VENDPARTY,",
						"          DATAAREAIDORIG",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> L3SelectVendorPartyAndDataArea",
						"L3SelectVendorPartyAndDataArea, IntercompanyPartner join(DATAAREAID == vendordataareaid",
						"     && VENDPARTY == vendorparty,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> L3GetVendorPartner",
						"L3GetVendorPartner select(mapColumn(",
						"          partnerrecid,",
						"          VENDACCOUNTORIG,",
						"          VENDPARTYORIG,",
						"          DATAAREAIDORIG",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> L3SelectPartnerRecId",
						"L3SelectPartnerRecId, SelectIntercompanyRelation join(partnerrecid == INTERCOMPANYTRADINGVENDOR,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> L3RelationCustomerVendor",
						"L3RelationCustomerVendor select(mapColumn(",
						"          intercompanytradingcustomer,",
						"          VENDACCOUNTORIG,",
						"          VENDPARTYORIG,",
						"          DATAAREAIDORIG",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> L4ICCustomer",
						"L4ICCustomer, IntercompanyPartner join(intercompanytradingcustomer == partnerrecid,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join1",
						"join1 select(mapColumn(",
						"          customerparty,",
						"          VENDACCOUNTORIG,",
						"          customerdataareaid,",
						"          VENDPARTYORIG,",
						"          DATAAREAIDORIG",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> L4SelectCustPartyAndDataAreaId",
						"L4SelectCustPartyAndDataAreaId, ICCustomer join(customerparty == PARTY",
						"     && customerdataareaid == dataareaid,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> L4GetCustomer",
						"L4GetCustomer select(mapColumn(",
						"          INVENTLOCATION = inventlocation,",
						"          VENDACCOUNTORIG,",
						"          VENDPARTYORIG,",
						"          DATAAREAIDORIG",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> FinalSelectCustomer",
						"L1SelectCustRelation, IntercompanyPartner join(intercompanytradingcustomer == partnerrecid,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> L1CustPartner",
						"join2 select(mapColumn(",
						"          PARTY,",
						"          ACCOUNTNUM,",
						"          inventlocation,",
						"          dataareaid",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> ICCustomer",
						"select1 derive(DATAAREAID = lower(DATAAREAID),",
						"          VENDPARTY = toString(VENDPARTY)) ~> SelectONSourcingVendors",
						"SelectCustomer derive(dataareaid = lower(dataareaid)) ~> LowercaseDataArea",
						"LowercaseDataArea, IntercompanyPartner join(PARTY == customerparty",
						"     && dataareaid == customerdataareaid,",
						"     joinType:'inner',",
						"     matchType:'exact',",
						"     ignoreSpaces: false,",
						"     broadcast: 'auto')~> join2",
						"FinalSelectCustomer alterRow(updateIf(true())) ~> Upsert",
						"FilterVendorsWithONSourcing select(mapColumn(",
						"          DATAAREAID,",
						"          onsourcingvendaccount,",
						"          VENDPARTY = VENDPARTYORIG",
						"     ),",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true) ~> select1",
						"Upsert sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     deletable:false,",
						"     insertable:false,",
						"     updateable:true,",
						"     upsertable:false,",
						"     alternateKeyName: 'hso_vendorsid',",
						"     skipDuplicateMapInputs: true,",
						"     skipDuplicateMapOutputs: true,",
						"     mapColumn(",
						"          hso_sourcewarehouse = INVENTLOCATION,",
						"          hso_vendorid = VENDPARTYORIG,",
						"          hso_company = DATAAREAIDORIG,",
						"          hso_name = VENDACCOUNTORIG",
						"     )) ~> Vendors"
					]
				}
			},
			"dependsOn": []
		}
	]
}